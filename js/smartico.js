!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("sm-tracker-smartico",t):(e="undefined"!=typeof globalThis?globalThis:e||self)._smartico=t()}(this,function(){"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __rest(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function __awaiter(e,s,a,c){return new(a=a||Promise)(function(n,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function i(e){try{o(c.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}o((c=c.apply(e,s||[])).next())})}function __generator(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function __spreadArrays(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function __values(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}}}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}var Event$1=function(e,t){this.target=t,this.type=e},ErrorEvent=(ya=Event$1,__extends(za,ya),za),ya;function za(e,t){t=ya.call(this,"error",t)||this;return t.message=e.message,t.error=e,t}var CloseEvent=(Da=Event$1,__extends(Ea,Da),Ea),Da;function Ea(e,t,n){void 0===e&&(e=1e3),void 0===t&&(t="");n=Da.call(this,"close",n)||this;return n.wasClean=!0,n.code=e,n.reason=t,n}var getGlobalWebSocket=function(){if("undefined"!=typeof WebSocket)return WebSocket},isWebSocket=function(e){return void 0!==e&&!!e&&2===e.CLOSING},DEFAULT={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},ReconnectingWebSocket=(Object.defineProperty(Ka,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(Ka,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(Ka,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Ka,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"CONNECTING",{get:function(){return Ka.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"OPEN",{get:function(){return Ka.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"CLOSING",{get:function(){return Ka.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"CLOSED",{get:function(){return Ka.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce(function(e,t){return"string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e},0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?Ka.CLOSED:Ka.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),Ka.prototype.close=function(e,t){void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(e,t):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},Ka.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED&&this._disconnect(e,t),this._connect()},Ka.prototype.send=function(e){var t;this._ws&&this._ws.readyState===this.OPEN?(this._debug("send",e),this._ws.send(e)):(t=void 0===(t=this._options.maxEnqueuedMessages)?DEFAULT.maxEnqueuedMessages:t,this._messageQueue.length<t&&(this._debug("enqueue",e),this._messageQueue.push(e)))},Ka.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},Ka.prototype.dispatchEvent=function(e){var t,n,r=this._listeners[e.type];if(r)try{for(var i=__values(r),o=i.next();!o.done;o=i.next()){var s=o.value;this._callEventListener(e,s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!0},Ka.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(e){return e!==t}))},Ka.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,__spread(["RWS>"],e))},Ka.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,n=void 0===t?DEFAULT.reconnectionDelayGrowFactor:t,r=e.minReconnectionDelay,t=void 0===r?DEFAULT.minReconnectionDelay:r,r=e.maxReconnectionDelay,e=void 0===r?DEFAULT.maxReconnectionDelay:r,r=0;return 0<this._retryCount&&e<(r=t*Math.pow(n,this._retryCount-1))&&(r=e),this._debug("next delay",r),r},Ka.prototype._wait=function(){var t=this;return new Promise(function(e){setTimeout(e,t._getNextDelay())})},Ka.prototype._getNextUrl=function(e){if("string"==typeof e)return Promise.resolve(e);if("function"==typeof e){e=e();if("string"==typeof e)return Promise.resolve(e);if(e.then)return e}throw Error("Invalid URL")},Ka.prototype._connect=function(){var t=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var e=this._options,n=e.maxRetries,r=void 0===n?DEFAULT.maxRetries:n,n=e.connectionTimeout,i=void 0===n?DEFAULT.connectionTimeout:n,e=e.WebSocket,o=void 0===e?getGlobalWebSocket():e;if(this._retryCount>=r)this._debug("max retries reached",this._retryCount,">=",r);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!isWebSocket(o))throw Error("No valid WebSocket class provided");this._wait().then(function(){return t._getNextUrl(t._url)}).then(function(e){t._closeCalled||(t._debug("connect",{url:e,protocols:t._protocols}),t._ws=t._protocols?new o(e,t._protocols):new o(e),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout(function(){return t._handleTimeout()},i))})}}},Ka.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new ErrorEvent(Error("TIMEOUT"),this))},Ka.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new CloseEvent(e,t,this))}catch(e){}}},Ka.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},Ka.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},Ka.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},Ka.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},Ka.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},Ka),ClassId,Zb,ERRS,$b,Z_INDEX,_b;function Ka(e,t,n){var r=this;void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(t){r._debug("open event");var e=r._options.minUptime,e=void 0===e?DEFAULT.minUptime:e;clearTimeout(r._connectTimeout),r._uptimeTimeout=setTimeout(function(){return r._acceptOpen()},e),r._ws.binaryType=r._binaryType,r._messageQueue.forEach(function(e){return r._ws.send(e)}),r._messageQueue=[],r.onopen&&r.onopen(t),r._listeners.open.forEach(function(e){return r._callEventListener(t,e)})},this._handleMessage=function(t){r._debug("message event"),r.onmessage&&r.onmessage(t),r._listeners.message.forEach(function(e){return r._callEventListener(t,e)})},this._handleError=function(t){r._debug("error event",t.message),r._disconnect(void 0,"TIMEOUT"===t.message?"timeout":void 0),r.onerror&&r.onerror(t),r._debug("exec error listeners"),r._listeners.error.forEach(function(e){return r._callEventListener(t,e)}),r._connect()},this._handleClose=function(t){r._debug("close event"),r._clearTimeouts(),r._shouldReconnect&&r._connect(),r.onclose&&r.onclose(t),r._listeners.close.forEach(function(e){return r._callEventListener(t,e)})},this._url=e,this._protocols=t,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}Zb=ClassId=ClassId||{},Zb[Zb.PING=1]="PING",Zb[Zb.PONG=2]="PONG",Zb[Zb.INIT=3]="INIT",Zb[Zb.INIT_RESPONSE=4]="INIT_RESPONSE",Zb[Zb.IDENTIFY=5]="IDENTIFY",Zb[Zb.IDENTIFY_RESPONSE=6]="IDENTIFY_RESPONSE",Zb[Zb.LOGIN=7]="LOGIN",Zb[Zb.LOGOUT=8]="LOGOUT",Zb[Zb.EVENT=9]="EVENT",Zb[Zb.EVENT_RESPONSE=10]="EVENT_RESPONSE",Zb[Zb.LOGIN_RESPONSE=11]="LOGIN_RESPONSE",Zb[Zb.LOGOUT_RESPONSE=12]="LOGOUT_RESPONSE",Zb[Zb.GET_TRANSLATIONS_REQUEST=13]="GET_TRANSLATIONS_REQUEST",Zb[Zb.GET_TRANSLATIONS_RESPONSE=14]="GET_TRANSLATIONS_RESPONSE",Zb[Zb.CLIENT_ENGAGEMENT_IMPRESSION_REQUEST=103]="CLIENT_ENGAGEMENT_IMPRESSION_REQUEST",Zb[Zb.CLIENT_ENGAGEMENT_ACTION_REQUEST=104]="CLIENT_ENGAGEMENT_ACTION_REQUEST",Zb[Zb.CLIENT_EXECUTE_DEEPLINK_EVENT=105]="CLIENT_EXECUTE_DEEPLINK_EVENT",Zb[Zb.CLIENT_ENGAGEMENT_FAILED_REQUEST=106]="CLIENT_ENGAGEMENT_FAILED_REQUEST",Zb[Zb.CLIENT_EXECUTE_JS_EVENT=107]="CLIENT_EXECUTE_JS_EVENT",Zb[Zb.CLIENT_PUBLIC_PROPERTIES_CHANGED_EVENT=108]="CLIENT_PUBLIC_PROPERTIES_CHANGED_EVENT",Zb[Zb.CLIENT_ENGAGEMENT_EVENT_NEW=110]="CLIENT_ENGAGEMENT_EVENT_NEW",Zb[Zb.CLIENT_SCREEN_RECORD_REQUEST=151]="CLIENT_SCREEN_RECORD_REQUEST",Zb[Zb.CLIENT_SCREEN_RECORD_RESPONSE=152]="CLIENT_SCREEN_RECORD_RESPONSE",Zb[Zb.CLIENT_SCREEN_RECORD_SESSION_INFO_REQUEST=153]="CLIENT_SCREEN_RECORD_SESSION_INFO_REQUEST",Zb[Zb.CLIENT_SCREEN_RECORD_SESSION_INFO_RESPONSE=154]="CLIENT_SCREEN_RECORD_SESSION_INFO_RESPONSE",Zb[Zb.CLIENT_TRACK_ACTIVITY_REQUEST=155]="CLIENT_TRACK_ACTIVITY_REQUEST",Zb[Zb.CLIENT_SET_AVATAR_REQUEST=157]="CLIENT_SET_AVATAR_REQUEST",Zb[Zb.CLIENT_SET_AVATAR_RESPONSE=158]="CLIENT_SET_AVATAR_RESPONSE",Zb[Zb.GET_LEVEL_MAP_REQUEST=500]="GET_LEVEL_MAP_REQUEST",Zb[Zb.GET_LEVEL_MAP_RESPONSE=501]="GET_LEVEL_MAP_RESPONSE",Zb[Zb.GET_ACHIEVEMENT_MAP_REQUEST=502]="GET_ACHIEVEMENT_MAP_REQUEST",Zb[Zb.GET_ACHIEVEMENT_MAP_RESPONSE=503]="GET_ACHIEVEMENT_MAP_RESPONSE",Zb[Zb.RELOAD_ACHIEVEMENTS_EVENT=504]="RELOAD_ACHIEVEMENTS_EVENT",Zb[Zb.GET_LEADERS_BOARD_REQUEST=505]="GET_LEADERS_BOARD_REQUEST",Zb[Zb.GET_LEADERS_BOARD_RESPONSE=506]="GET_LEADERS_BOARD_RESPONSE",Zb[Zb.GET_ACTIVITY_LOG_REQUEST=507]="GET_ACTIVITY_LOG_REQUEST",Zb[Zb.GET_ACTIVITY_LOG_RESPONSE=508]="GET_ACTIVITY_LOG_RESPONSE",Zb[Zb.GET_SHOP_ITEMS_REQUEST=509]="GET_SHOP_ITEMS_REQUEST",Zb[Zb.GET_SHOP_ITEMS_RESPONSE=510]="GET_SHOP_ITEMS_RESPONSE",Zb[Zb.BUY_SHOP_ITEM_REQUEST=511]="BUY_SHOP_ITEM_REQUEST",Zb[Zb.BUY_SHOP_ITEM_RESPONSE=512]="BUY_SHOP_ITEM_RESPONSE",Zb[Zb.GET_INBOX_MESSAGES_REQUEST=513]="GET_INBOX_MESSAGES_REQUEST",Zb[Zb.GET_INBOX_MESSAGES_RESPONSE=514]="GET_INBOX_MESSAGES_RESPONSE",Zb[Zb.GET_SHOP_CATEGORIES_REQUEST=515]="GET_SHOP_CATEGORIES_REQUEST",Zb[Zb.GET_SHOP_CATEGORIES_RESPONSE=516]="GET_SHOP_CATEGORIES_RESPONSE",Zb[Zb.GET_TOURNAMENT_LOBBY_REQUEST=517]="GET_TOURNAMENT_LOBBY_REQUEST",Zb[Zb.GET_TOURNAMENT_LOBBY_RESPONSE=518]="GET_TOURNAMENT_LOBBY_RESPONSE",Zb[Zb.GET_TOURNAMENT_INFO_REQUEST=519]="GET_TOURNAMENT_INFO_REQUEST",Zb[Zb.GET_TOURNAMENT_INFO_RESPONSE=520]="GET_TOURNAMENT_INFO_RESPONSE",Zb[Zb.TOURNAMENT_REGISTER_REQUEST=521]="TOURNAMENT_REGISTER_REQUEST",Zb[Zb.TOURNAMENT_REGISTER_RESPONSE=522]="TOURNAMENT_REGISTER_RESPONSE",Zb[Zb.GET_CUSTOM_SECTIONS_REQUEST=523]="GET_CUSTOM_SECTIONS_REQUEST",Zb[Zb.GET_CUSTOM_SECTIONS_RESPONSE=524]="GET_CUSTOM_SECTIONS_RESPONSE",Zb[Zb.MISSION_OPTIN_REQUEST=525]="MISSION_OPTIN_REQUEST",Zb[Zb.MISSION_OPTIN_RESPONSE=526]="MISSION_OPTIN_RESPONSE",Zb[Zb.GET_BONUSES_REQUEST=600]="GET_BONUSES_REQUEST",Zb[Zb.GET_BONUSES_RESPONSE=601]="GET_BONUSES_RESPONSE",Zb[Zb.CLAIM_BONUS_REQUEST=602]="CLAIM_BONUS_REQUEST",Zb[Zb.CLAIM_BONUS_RESPONSE=603]="CLAIM_BONUS_RESPONSE",Zb[Zb.SAW_GET_SPINS_REQUEST=700]="SAW_GET_SPINS_REQUEST",Zb[Zb.SAW_GET_SPINS_RESPONSE=701]="SAW_GET_SPINS_RESPONSE",Zb[Zb.SAW_DO_SPIN_REQUEST=702]="SAW_DO_SPIN_REQUEST",Zb[Zb.SAW_DO_SPIN_RESPONSE=703]="SAW_DO_SPIN_RESPONSE",Zb[Zb.SAW_AKNOWLEDGE_REQUEST=704]="SAW_AKNOWLEDGE_REQUEST",Zb[Zb.SAW_AKNOWLEDGE_RESPONSE=705]="SAW_AKNOWLEDGE_RESPONSE",Zb[Zb.SAW_SPINS_COUNT_PUSH=706]="SAW_SPINS_COUNT_PUSH",Zb[Zb.SAW_SHOW_SPIN_PUSH=707]="SAW_SHOW_SPIN_PUSH",Zb[Zb.REGISTER_PUSH_NOTIFICATIONS_TOKEN_REQ=1003]="REGISTER_PUSH_NOTIFICATIONS_TOKEN_REQ",Zb[Zb.REGISTER_PUSH_NOTIFICATIONS_TOKEN_RESP=2003]="REGISTER_PUSH_NOTIFICATIONS_TOKEN_RESP",Zb[Zb.CLIENT_DEBUG_REQUEST=77777]="CLIENT_DEBUG_REQUEST",$b=ERRS=ERRS||{},$b[$b.OK=0]="OK",$b[$b.NO_LABEL_FOUND=1]="NO_LABEL_FOUND",$b[$b.INIT_NOT_COMPLETED=2]="INIT_NOT_COMPLETED",$b[$b.FAILED_TO_IDENTIFY_USER=3]="FAILED_TO_IDENTIFY_USER",$b[$b.FAILED_TO_HANDE_EVENT_NO_USER=4]="FAILED_TO_HANDE_EVENT_NO_USER",$b[$b.FAILED_TO_HANDE_EVENT_UNKNOWN_NAME=5]="FAILED_TO_HANDE_EVENT_UNKNOWN_NAME",$b[$b.FAILED_TO_HANDE_EVENT=6]="FAILED_TO_HANDE_EVENT",$b[$b.INIT_FAILED_LABEL_IS_BLOCKED=100]="INIT_FAILED_LABEL_IS_BLOCKED",_b=Z_INDEX=Z_INDEX||{},_b[_b.GAMIFICATION_MAIN=2147483644]="GAMIFICATION_MAIN",_b[_b.GAMIFICATION_INBOX=2147483646]="GAMIFICATION_INBOX",_b[_b.POPUPS=2147483647]="POPUPS",_b[_b.OTHER=2147483640]="OTHER";var CLASS_ID_IGNORE_FOR_SIMULATION=[ClassId.LOGIN,ClassId.LOGOUT,ClassId.EVENT,ClassId.CLIENT_ENGAGEMENT_IMPRESSION_REQUEST,ClassId.CLIENT_ENGAGEMENT_ACTION_REQUEST,ClassId.CLIENT_ENGAGEMENT_FAILED_REQUEST,ClassId.CLIENT_SCREEN_RECORD_REQUEST,ClassId.CLIENT_SCREEN_RECORD_SESSION_INFO_REQUEST,ClassId.CLIENT_TRACK_ACTIVITY_REQUEST,ClassId.REGISTER_PUSH_NOTIFICATIONS_TOKEN_REQ,ClassId.BUY_SHOP_ITEM_REQUEST,ClassId.CLAIM_BONUS_REQUEST,ClassId.SAW_SHOW_SPIN_PUSH,ClassId.CLIENT_SET_AVATAR_REQUEST,ClassId.CLIENT_ENGAGEMENT_EVENT_NEW,ClassId.CLIENT_TRACK_ACTIVITY_REQUEST,ClassId.CLIENT_SET_AVATAR_REQUEST,ClassId.BUY_SHOP_ITEM_REQUEST,ClassId.TOURNAMENT_REGISTER_REQUEST,ClassId.MISSION_OPTIN_REQUEST,ClassId.CLAIM_BONUS_REQUEST,ClassId.SAW_DO_SPIN_REQUEST,ClassId.SAW_AKNOWLEDGE_REQUEST],CLASS_ID_IGNORE_FOR_GAMIFICATION_WRAPPER=[ClassId.LOGIN,ClassId.LOGOUT,ClassId.CLIENT_ENGAGEMENT_EVENT_NEW,ClassId.CLIENT_EXECUTE_DEEPLINK_EVENT,ClassId.CLIENT_EXECUTE_JS_EVENT,ClassId.SAW_SHOW_SPIN_PUSH],SmarticoClearParamsDefaults={keepCallBacks:!1},POPUP_TEMPLATE_ENGINE,ac,ENGAGEMENT_FAIL_REASONS,TrackerInstanceType,cc;ac=POPUP_TEMPLATE_ENGINE=POPUP_TEMPLATE_ENGINE||{},ac[ac.INTERACTION_PLUS=1]="INTERACTION_PLUS",ac[ac.SIMPLE_JS=2]="SIMPLE_JS",(ENGAGEMENT_FAIL_REASONS=ENGAGEMENT_FAIL_REASONS||{}).ANOTHER_ENGAGEMENT_IS_STILL_IN_FOCOUS="ANOTHER_ENGAGEMENT_IS_STILL_IN_FOCOUS",cc=TrackerInstanceType=TrackerInstanceType||{},cc[cc.Master=1]="Master",cc[cc.Shadow=2]="Shadow";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var typescriptMap=createCommonjsModule(function(e,t){var i=commonjsGlobal&&commonjsGlobal.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.TSMap=void 0;var n=(o.prototype.fromJSON=function(t,n){var r=this,i=function(e){return null!==e&&"object"==typeof e&&n?(new o).fromJSON(e,!0):Array.isArray(e)&&n?e.map(function(e){return i(e)}):e};return Object.keys(t).forEach(function(e){t.hasOwnProperty(e)&&r.set(e,i(t[e]))}),r},o.prototype.toJSON=function(){var t={},n=this,r=function(e){return e instanceof o?e.toJSON():Array.isArray(e)?e.map(function(e){return r(e)}):e};return n.keys().forEach(function(e){t[String(e)]=r(n.get(e))}),t},o.prototype.entries=function(){var t=this;return[].slice.call(this.keys().map(function(e){return[e,t.get(e)]}))},o.prototype.keys=function(){return[].slice.call(this._keys)},o.prototype.values=function(){return[].slice.call(this._values)},o.prototype.has=function(e){return-1<this._keys.indexOf(e)},o.prototype.get=function(e){e=this._keys.indexOf(e);return-1<e?this._values[e]:void 0},o.prototype.deepGet=function(e){if(!e||!e.length)return null;var n=function(e,t){return null==e?null:t.length?n(e instanceof o?e.get(t[0]):e[t[0]],t.slice(1)):e};return n(this.get(e[0]),e.slice(1))},o.prototype.set=function(e,t){var n=this,r=this._keys.indexOf(e);return-1<r?n._values[r]=t:(n._keys.push(e),n._values.push(t),n.length=n._values.length),this},o.prototype.sortedSet=function(e,t,n,r){var i=this._keys.length,n=n||0,r=void 0!==r?r:i-1;if(0==i)return this._keys.push(e),this._values.push(t),this;if(e==this._keys[n])return this._values[n]=t,this;if(e==this._keys[r])return this._values[r]=t,this;if(e>this._keys[r])return this._keys.splice(r+1,0,e),this._values.splice(r+1,0,t),this;if(e<this._keys[n])return this._values.splice(n,0,t),this._keys.splice(n,0,e),this;if(r<=n)return this;i=n+Math.floor((r-n)/2);return e<this._keys[i]?this.sortedSet(e,t,n,i-1):e>this._keys[i]?this.sortedSet(e,t,i+1,r):this},o.prototype.size=function(){return this.length},o.prototype.clear=function(){return this._keys.length=this.length=this._values.length=0,this},o.prototype.delete=function(e){var t=this,e=t._keys.indexOf(e);return-1<e&&(t._keys.splice(e,1),t._values.splice(e,1),t.length=t._keys.length,!0)},o.prototype.forEach=function(n){var r=this;this._keys.forEach(function(e,t){n(r.get(e),e,t)})},o.prototype.map=function(n){var r=this;return this.keys().map(function(e,t){return n(r.get(e),e,t)})},o.prototype.filter=function(n){var r=this;return i(r._keys).forEach(function(e,t){!1===n(r.get(e),e,t)&&r.delete(e)}),this},o.prototype.clone=function(){return new o(this.entries())},o);function o(e){var n=this;n._keys=[],n._values=[],n.length=0,e&&e.forEach(function(e,t){n.set(e[0],e[1])})}t.TSMap=n});unwrapExports(typescriptMap);var typescriptMap_1=typescriptMap.TSMap,Util=(ud.isNumber=function(e){return/^\d+$/.test(e)},ud.parseNumber=function(e){if(ud.isNotEmpty(e)){e=parseFloat(e);return isNaN(e)?null:e}return null},ud.parseBoolean=function(e){return"true"===e||!0===e||"false"!==e&&!1!==e&&null},ud.escapeRegExp=function(e){return ud.isNotEmpty(e)?e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):e},ud.nullToEmpty=function(e){return this.isNotEmpty(e)?e:""},ud.nullTo0=function(e){return this.isNotNull(e)?e:0},ud.isNotEmpty=function(e){return null!=e&&0<e.length},ud.isNotNull=function(e){return null!=e},ud.isNull=function(e){return null==e},ud.isArrayNotEmpty=function(e){return null!=e&&0<e.length},ud.isArrayEmpty=function(e){return null==e||0===e.length},ud.isObjectEmpty=function(e){return ud.isNull(e)||0===Object.keys(e).length&&e.constructor===Object},ud.isMapNotEmpty=function(e){return null!=e&&(0<e.size()||0<e.keys().length)},ud.isMapEmpty=function(e){return null==e||0===e.size()||0===e.keys().length},ud.objectToMap=function(t){if(ud.isNotNull(t)){var n=new typescriptMap_1;return Object.keys(t).forEach(function(e){n.set(e,t[e])}),n}return null},ud.keyByValue=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t)return n;return null},ud.greaterThen0=function(e){return this.isNotNull(e)&&0<e},ud.not0=function(e){return this.isNotNull(e)&&0!==e},ud.lessThen0=function(e){return this.isNotNull(e)&&e<0},ud.compareUndefined=function(e,t){return this.isNotNull(e)&&this.isNull(t)?-1:this.isNull(e)&&this.isNotNull(t)?1:0},ud.compareArrayLength=function(e,t){var n=ud.compareUndefined(e,t);return 0===n&&ud.isNotNull(e)&&ud.isNotNull(t)?e.length<t.length?-1:e.length>t.length?1:0:n},ud.compareObject=function(e,t){for(var n in e)if(!(n in t)||e[n]!==t[n])return!1;for(var n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0},ud.compareArrays=function(e,t,n){ud.checkNotNull(n);var r=this.compareArrayLength(e,t);if(0===r&&ud.isNotNull(e)&&ud.isNotNull(t))for(var i=0;i<e.length&&0===(r=n(e[i],t[i]));i++);return r},ud.compareBool=function(e,t){var n=this.compareUndefined(e,t);return 0===n&&this.isNotNull(e)&&this.isNotNull(t)?Boolean(t)-Boolean(e):n},ud.compareNumber=function(e,t){var n=this.compareUndefined(e,t);return 0===n&&this.isNotNull(e)&&this.isNotNull(t)?e===t?0:e<t?-1:1:n},ud.compareString=function(e,t){var n=ud.compareUndefined(e,t);return 0===n&&ud.isNotNull(e)&&ud.isNotNull(t)?e<t?-1:t<e?1:0:n},ud.range=function(n,e){return Array(e-n+1).fill(null).map(function(e,t){return n+t})},ud.has=function(e,t){if(ud.isArrayNotEmpty(e)&&ud.isNotNull(t))for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},ud.isEmpty=function(e){return null==e||0===e.length},ud.checkNotNull=function(e,t){if(ud.isNull(e))throw new ReferenceError(t);return e},ud.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},ud.randomArr=function(e){if(!ud.isArrayEmpty(e))return e[ud.randomInt(0,e.length-1)]},ud.remove=function(e,t){if(ud.isArrayNotEmpty(e)&&t)for(var n=0;n<e.length;n++)if(e[n]===t)return e.splice(n,1),!0;return!1},ud.replaceAll=function(e,t,n){return ud.isNotNull(e)?e.replace(new RegExp(ud.escapeRegExp(t),"g"),n):e},ud.to=function(e,t){return e.then(function(e){return[null,e]}).catch(function(e){return t&&Object.assign(e,t),[e,void 0]})},ud.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},ud.merge=function(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if(!r.length)return e;var o=r.shift();if(this.isObject(e)&&this.isObject(o))for(var s in o)this.isObject(o[s])?(e[s]||Object.assign(e,((t={})[s]={},t)),this.merge(e[s],o[s])):Array.isArray(o[s])?Object.assign(e,((n={})[s]=__spreadArrays(o[s]),n)):void 0!==o[s]&&Object.assign(e,((n={})[s]=o[s],n));return this.merge.apply(this,__spreadArrays([e],r))},ud.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},ud.getStackTrace=function(){return(new Error).stack},ud.shuffleArray=function(e){for(var t=e.length-1;0<t;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}return e},ud.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},ud);function ud(){}var WebUtil=(_e.parentWindow=function(){return window===window.parent&&window!==window.opener?window.opener:window.parent},_e.isFrame=function(){return window!==window.parent||window===window.opener},_e.addEventListener=function(e,t,n,r){var i,o=this;Util.isNotNull(e)&&(Util.isNotNull(e.addEventListener)?(i=this._intervals.get(e),Util.isNotNull(i)&&(this._intervals.delete(e),clearInterval(i)),e.addEventListener(t,n,r)):this._intervals.set(e,setInterval(function(){o.addEventListener(e,t,n,r)},50)))},_e.urlParam=function(e,t){t=new RegExp("[?&]"+e+"=([^&#]*)").exec(t||window.location.href);return t&&0<t.length?decodeURIComponent(t[1]):null},_e.href=function(e){e=new RegExp(/href="(.*?)"/g).exec(e);return e&&0<e.length?e[1]:null},_e.addGetParam=function(e,t,n){return Util.isNotEmpty(e)?e+(0<e.indexOf("?")?"&":"?")+t+"="+n:e},_e.addGetParams=function(e,t){return Util.isNotEmpty(e)&&t?e+(0<e.indexOf("?")?"&":"?")+Object.keys(t).map(function(e){return e+"="+t[e]}).join("&"):e},_e.createFrame=function(e,t){void 0===t&&(t=2147483647);var n=document.getElementsByTagName("body")[0],r="_sm_frame"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),i=document.createElement("style");i.textContent="iframe#"+r+" { all: initial }",n.append(i);i=document.createElement("iframe");return i.id=r,i.style.display="none",i.style.width="1px",i.style.height="1px",i.style.zIndex=t.toString(),i.setAttribute("allow","camera;fullscreen"),i.setAttribute("scrolling","no"),i.setAttribute("src",e),n.appendChild(i),i},_e.removeFrame=function(e){document.getElementsByTagName("body")[0].removeChild(e)},_e.isMobile=function(){return _e.isMobileCached=null===_e.isMobileCached?_e.isMobileClean()||window.location.search.includes(_e.forceMobileParam):_e.isMobileCached},_e.isMobileClean=function(){return navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints||/Mobi/i.test(navigator.userAgent)||/Android/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent)||/iPad/i.test(navigator.userAgent)||/iPod/i.test(navigator.userAgent)||/webOS/i.test(navigator.userAgent)||/BlackBerry/i.test(navigator.userAgent)||/Windows Phone/i.test(navigator.userAgent)||/Opera Mini/i.test(navigator.userAgent)||/IEMobile/i.test(navigator.userAgent)||/WPDesktop/i.test(navigator.userAgent)},_e.winCenter=function(e,t){var n=[];return n.push("width="+e),n.push("height="+t),n.push(this.calculateWinLeft(e)),n.push(this.calculateWinTop(t)),n.join(",")},_e.calculateWinLeft=function(e){var t=Util.isNotNull(window.screenLeft)?window.screenLeft:screen.left,n=window.innerWidth||document.documentElement.clientWidth||screen.width;return"left="+Math.round((n-e)/2+t)},_e.calculateWinTop=function(e){var t=Util.isNotNull(window.screenTop)?window.screenTop:screen.top,n=window.innerHeight||document.documentElement.clientHeight||screen.height;return"top="+Math.round((n-e)/2+t)},_e.Least=function(e,t){return t<e?t:e},_e.Greatest=function(e,t){return e<t?t:e},_e.forceMobileParam="force_mobile",_e.isMobileCached=null,_e._intervals=new typescriptMap_1,_e),CJMActivityType,Nf,PublicLabelSettings,Of,PushNotificationUserStatus,Pf,PushClientPlatform,Qf;function _e(){}Nf=CJMActivityType=CJMActivityType||{},Nf[Nf.Root=0]="Root",Nf[Nf.Journey_Started=1]="Journey_Started",Nf[Nf.Journey_Stopped=2]="Journey_Stopped",Nf[Nf.Journey_Converted=3]="Journey_Converted",Nf[Nf.Delay=6]="Delay",Nf[Nf.Control_Group=7]="Control_Group",Nf[Nf.Do_Nothing=8]="Do_Nothing",Nf[Nf.WaitForEvent=9]="WaitForEvent",Nf[Nf.DeepLink=10]="DeepLink",Nf[Nf.JSCode=11]="JSCode",Nf[Nf.Banner=20]="Banner",Nf[Nf.Popup=30]="Popup",Nf[Nf.Inbox=31]="Inbox",Nf[Nf.Push=40]="Push",Nf[Nf.Email=50]="Email",Nf[Nf.SMS=60]="SMS",Nf[Nf.Slack=70]="Slack",Nf[Nf.Email_To_Customer_Support=80]="Email_To_Customer_Support",Nf[Nf.Email_To_Risk_Operator=90]="Email_To_Risk_Operator",Nf[Nf.Give_Bonus=100]="Give_Bonus",Nf[Nf.WebHook=200]="WebHook",Nf[Nf.UserStateCheck=201]="UserStateCheck",Nf[Nf.Pixel=300]="Pixel",Nf[Nf.WhatsApp_Connect=400]="WhatsApp_Connect",Of=PublicLabelSettings=PublicLabelSettings||{},Of.FCM_SENDER_ID="FCM_SENDER_ID",Of.PUBLIC_API_URL="PUBLIC_API_URL",Of.FCM_SW_URL="FCM_SW_URL",Of.RECORDING_ENABLED_FOR_ALL_USERS="RECORDING_ENABLED_FOR_ALL_USERS",Of.JS_INJECTION="JS_INJECTION",Of.GAMIFICATION_UI_MAIN="GAMIFICATION_UI_MAIN",Of.GAMIFICATION_UI_WIDGET="GAMIFICATION_UI_WIDGET",Of.GAMIFICATION_UI_MINI_GAME="GAMIFICATION_UI_MINI_GAME",Of.GAMIFICATION_UI_SETTINGS="GAMIFICATION_UI_SETTINGS",Of.GAMIFICATION_UI_MAIN_TEST="GAMIFICATION_UI_MAIN_TEST",Of.GAMIFICATION_UI_WIDGET_TEST="GAMIFICATION_UI_WIDGET_TEST",Of.GAMIFICATION_UI_SETTINGS_TEST="GAMIFICATION_UI_SETTINGS_TEST",Of.FRONT_END_ALLOWED_LANGUAGES="FRONT_END_ALLOWED_LANGUAGES",Of.DELAY_ENGAGEMENT_EXECUTION_ON_LOGIN_MS="DELAY_ENGAGEMENT_EXECUTION_ON_LOGIN_MS",Of.SHADOW_LABEL_PUBLIC_KEY="SHADOW_LABEL_PUBLIC_KEY",Of.DYNAMIC_IMAGE_DOMAIN="DYNAMIC_IMAGE_DOMAIN",Of.GAMIFICATION_UI_LEVEL_ENABLED="GAMIFICATION_UI_LEVEL_ENABLED",Of.GAMIFICATION_UI_LEVEL_IMAGE_MOB="GAMIFICATION_UI_LEVEL_IMAGE_MOB",Of.GAMIFICATION_UI_LEVEL_IMAGE_DESK="GAMIFICATION_UI_LEVEL_IMAGE_DESK",Of.AVATAR_CUSTOM_IMAGE_MAX_ID="AVATAR_CUSTOM_IMAGE_MAX_ID",Of.AVATAR_CUSTOM_IMAGE_FOLDER="AVATAR_CUSTOM_IMAGE_FOLDER",Pf=PushNotificationUserStatus=PushNotificationUserStatus||{},Pf[Pf.ALLOWED=0]="ALLOWED",Pf[Pf.ASK=1]="ASK",Pf[Pf.BLOCKED=2]="BLOCKED",Pf[Pf.SUSPENDED=3]="SUSPENDED",Pf[Pf.BROWSER_NOT_SUPPORTED=4]="BROWSER_NOT_SUPPORTED",Qf=PushClientPlatform=PushClientPlatform||{},Qf[Qf.CHROME_DESKTOP=0]="CHROME_DESKTOP",Qf[Qf.FIREFOX_DESKTOP=1]="FIREFOX_DESKTOP",Qf[Qf.EDGE_DESKTOP=2]="EDGE_DESKTOP",Qf[Qf.OPERA_DESKTOP=3]="OPERA_DESKTOP",Qf[Qf.SAFARI_DESKTOP=4]="SAFARI_DESKTOP",Qf[Qf.OTHER=5]="OTHER",Qf[Qf.NATIVE_IOS=6]="NATIVE_IOS",Qf[Qf.NATIVE_ANDROID=7]="NATIVE_ANDROID",Qf[Qf.CHROME_MOBILE=8]="CHROME_MOBILE",Qf[Qf.FIREFOX_MOBILE=9]="FIREFOX_MOBILE",Qf[Qf.SAFARI_MOBILE=10]="SAFARI_MOBILE",Qf[Qf.OPERA_MOBILE=11]="OPERA_MOBILE";var guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},Detector=(Uf.info=function(){return this._info||(this._info={fp:Uf.fingerprint(),agent:window.navigator.userAgent,host:window.location.hostname,device_type:Uf.getDeviceType(),tzoffset:(new Date).getTimezoneOffset(),browser:Uf.browserName(),os:Uf.getOSName()}),this._info},Uf.clear=function(){Uf._info=void 0},Uf.getDeviceType=function(){return-1!==navigator.userAgent.indexOf("SMTO-WRAPPER")?"WRAPPER":WebUtil.isMobile()?"MOBILE":"DESKTOP"},Uf.hasLocalStorage=function(){try{return!!window.localStorage}catch(e){return!0}},Uf.hasSessionStorage=function(){try{return!!window.sessionStorage}catch(e){return!0}},Uf.hash=function(e){var t,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n},Uf.fingerprint=function(){var e=[window.navigator.userAgent,[window.screen.height,window.screen.width,window.screen.colorDepth].join("x"),(new Date).getTimezoneOffset(),Uf.hasLocalStorage(),Uf.hasSessionStorage()],t=[];if(navigator.plugins)for(var n=0;n<navigator.plugins.length;n++)if(navigator.plugins[n]){for(var r=[],i=0;i<navigator.plugins[n].length;i++)r.push([navigator.plugins[n][i].type,navigator.plugins[n][i].suffixes]);t.push([navigator.plugins[n].name+"::"+navigator.plugins[n].description,r.join("~")])}return Uf.hash(e.join("###")+"###"+t.sort().join(";"))},Uf.getOSName=function(){var e=window.navigator.userAgent,t=window.navigator.platform,n="Other";return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?n="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(t)?n="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?n="Windows":/Android/.test(e)?n="Android":!n&&/Linux/.test(t)&&(n="Linux"),n},Uf.browserName=function(){var e=window;return e.chrome&&e.chrome.webstore||-1!=navigator.userAgent.indexOf("Chrome")?"Chrome":void 0!==e.InstallTrigger||-1!=navigator.userAgent.indexOf("Firefox")?"Firefox":e.opr&&e.addons||e.opera||0<=navigator.userAgent.indexOf(" OPR/")?"Opera":!e.isIE&&e.StyleMedia?"Edge":/constructor/i.test(e.HTMLElement)||-1!==navigator.userAgent.toLowerCase().indexOf("safari")&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")||"[object SafariRemoteNotification]"===(!e.safari||e.safari.pushNotification).toString()?"Safari":"Other"},Uf.getClientPlatform=function(){return(WebUtil.isMobile()?{Chrome:PushClientPlatform.CHROME_MOBILE,Firefox:PushClientPlatform.FIREFOX_MOBILE,Safari:PushClientPlatform.SAFARI_MOBILE,Opera:PushClientPlatform.OPERA_MOBILE,Other:PushClientPlatform.OTHER,Edge:PushClientPlatform.OTHER}:{Chrome:PushClientPlatform.CHROME_DESKTOP,Firefox:PushClientPlatform.FIREFOX_DESKTOP,Edge:PushClientPlatform.EDGE_DESKTOP,Opera:PushClientPlatform.OPERA_DESKTOP,Safari:PushClientPlatform.SAFARI_DESKTOP,Other:PushClientPlatform.OTHER})[Uf.browserName()]},Uf);function Uf(){}var __assign$1=function(){return(__assign$1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},extendStatics$1=function(e,t){return(extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends$1(e,t){function n(){this.constructor=e}extendStatics$1(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function deepCopy(e){return deepExtend(void 0,e)}function deepExtend(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=deepExtend(e[n],t[n]));return e}function isNode(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}function isBrowser(){return"object"==typeof self&&self.self===self}var ERROR_NAME="FirebaseError",FirebaseError=(Ig=Error,__extends$1(Jg,Ig),Jg),Ig;function Jg(e,t){t=Ig.call(this,t)||this;return t.code=e,t.name=ERROR_NAME,Object.setPrototypeOf(t,Jg.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,ErrorFactory.prototype.create),t}var ErrorFactory=(Ng.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=t[0]||{},i=this.service+"/"+e,e=this.errors[e],e=e?replaceTemplate(e,r):"Error",e=this.serviceName+": "+e+" ("+i+").",o=new FirebaseError(i,e),s=0,a=Object.keys(r);s<a.length;s++){var c=a[s];"_"!==c.slice(-1)&&(c in o&&console.warn('Overwriting FirebaseError base field "'+c+'" can cause unexpected behavior.'),o[c]=r[c])}return o},Ng);function Ng(e,t,n){this.service=e,this.serviceName=t,this.errors=n}function replaceTemplate(e,r){return e.replace(PATTERN,function(e,t){var n=r[t];return null!=n?n.toString():"<"+t+"?>"})}var PATTERN=/\{\$([^}]+)}/g;function contains(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function createSubscribe(e,t){t=new ObserverProxy(e,t);return t.subscribe.bind(t)}var ObserverProxy=(lh.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},lh.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},lh.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},lh.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=implementsAnyMethods(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=noop),void 0===r.error&&(r.error=noop),void 0===r.complete&&(r.complete=noop);n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),n},lh.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},lh.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},lh.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},lh.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},lh),LogLevel,Qh;function lh(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function implementsAnyMethods(e,t){if("object"==typeof e&&null!==e)for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return 1}}function noop(){}Qh=LogLevel=LogLevel||{},Qh[Qh.DEBUG=0]="DEBUG",Qh[Qh.VERBOSE=1]="VERBOSE",Qh[Qh.INFO=2]="INFO",Qh[Qh.WARN=3]="WARN",Qh[Qh.ERROR=4]="ERROR",Qh[Qh.SILENT=5]="SILENT";var defaultLogLevel=LogLevel.INFO,defaultLogHandler=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString();switch(t){case LogLevel.DEBUG:case LogLevel.VERBOSE:console.log.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case LogLevel.INFO:console.info.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case LogLevel.WARN:console.warn.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case LogLevel.ERROR:console.error.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}}},Logger=(Object.defineProperty(Wh.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in LogLevel))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(Wh.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),Wh.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,LogLevel.DEBUG].concat(e))},Wh.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,LogLevel.VERBOSE].concat(e))},Wh.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,LogLevel.INFO].concat(e))},Wh.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,LogLevel.WARN].concat(e))},Wh.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,LogLevel.ERROR].concat(e))},Wh),_a;function Wh(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler}var ERRORS=(_a={},_a["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",_a["bad-app-name"]="Illegal App name: '{$appName}",_a["duplicate-app"]="Firebase App named '{$appName}' already exists",_a["app-deleted"]="Firebase App named '{$appName}' already deleted",_a["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",_a),ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS),DEFAULT_ENTRY_NAME="[DEFAULT]",tokenListeners=[],FirebaseAppImpl=(Object.defineProperty(ii.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!0,configurable:!0}),Object.defineProperty(ii.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(ii.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),ii.prototype.delete=function(){var a=this;return new Promise(function(e){a.checkDestroyed_(),e()}).then(function(){a.firebase_.INTERNAL.removeApp(a.name_);for(var e=[],t=0,n=Object.keys(a.services_);t<n.length;t++)for(var r=n[t],i=0,o=Object.keys(a.services_[r]);i<o.length;i++){var s=o[i];e.push(a.services_[r][s])}return Promise.all(e.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))}).then(function(){a.isDeleted_=!0,a.services_={}})},ii.prototype._getService=function(e,t){var n;return void 0===t&&(t=DEFAULT_ENTRY_NAME),this.checkDestroyed_(),this.services_[e]||(this.services_[e]={}),this.services_[e][t]||(n=t!==DEFAULT_ENTRY_NAME?t:void 0,n=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),n),this.services_[e][t]=n),this.services_[e][t]},ii.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=DEFAULT_ENTRY_NAME),this.services_[e]&&this.services_[e][t]&&delete this.services_[e][t]},ii.prototype.extendApp=function(e){var t=this;deepExtend(this,e),e.INTERNAL&&e.INTERNAL.addAuthTokenListener&&(tokenListeners.forEach(function(e){t.INTERNAL.addAuthTokenListener(e)}),tokenListeners=[])},ii.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw ERROR_FACTORY.create("app-deleted",{appName:this.name_})},ii);function ii(e,t,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=deepCopy(e),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(e){tokenListeners.push(e),setTimeout(function(){return e(null)},0)},removeAuthTokenListener:function(t){tokenListeners=tokenListeners.filter(function(e){return e!==t})}}}FirebaseAppImpl.prototype.name&&FirebaseAppImpl.prototype.options||FirebaseAppImpl.prototype.delete||console.log("dc");var version="6.6.2",logger=new Logger("@firebase/app"),sdkVersion;function createFirebaseNamespaceCore(s){var r={},a={},c={},u={__esModule:!0,initializeApp:function(e,t){void 0===t&&(t={});"object"==typeof t&&null!==t||(t={name:t});var n=t;void 0===n.name&&(n.name=DEFAULT_ENTRY_NAME);t=n.name;if("string"!=typeof t||!t)throw ERROR_FACTORY.create("bad-app-name",{appName:String(t)});if(contains(r,t))throw ERROR_FACTORY.create("duplicate-app",{appName:t});n=new s(e,n,u);return i(r[t]=n,"create"),n},app:l,apps:null,SDK_VERSION:version,INTERNAL:{registerService:function(n,e,t,r,i){void 0===i&&(i=!1);if(a[n])return logger.debug("There were multiple attempts to register service "+n+"."),u[n];a[n]=e,r&&(c[n]=r,d().forEach(function(e){r("create",e)}));function o(e){if("function"!=typeof(e=void 0===e?l():e)[n])throw ERROR_FACTORY.create("invalid-app-argument",{appName:n});return e[n]()}void 0!==t&&deepExtend(o,t);return u[n]=o,s.prototype[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,n).apply(this,i?e:[])},o},removeApp:function(e){i(r[e],"delete"),delete r[e]},factories:a,useAsService:o}};function l(e){if(!contains(r,e=e||DEFAULT_ENTRY_NAME))throw ERROR_FACTORY.create("no-app",{appName:e});return r[e]}function d(){return Object.keys(r).map(function(e){return r[e]})}function i(e,t){for(var n=0,r=Object.keys(a);n<r.length;n++){var i=o(0,r[n]);if(null===i)return;c[i]&&c[i](t,e)}}function o(e,t){if("serverAuth"===t)return null;return t}return u.default=u,Object.defineProperty(u,"apps",{get:d}),l.App=s,u}function createFirebaseNamespace(){var t=createFirebaseNamespaceCore(FirebaseAppImpl);return t.INTERNAL=__assign$1({},t.INTERNAL,{createFirebaseNamespace:createFirebaseNamespace,extendNamespace:function(e){deepExtend(t,e)},createSubscribe:createSubscribe,ErrorFactory:ErrorFactory,deepExtend:deepExtend}),t}isBrowser()&&void 0!==self.firebase&&(logger.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  "),sdkVersion=self.firebase.SDK_VERSION,sdkVersion&&0<=sdkVersion.indexOf("LITE")&&logger.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    "));var firebaseNamespace=createFirebaseNamespace(),initializeApp=firebaseNamespace.initializeApp;firebaseNamespace.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return isNode()&&logger.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),initializeApp.apply(void 0,e)};var firebase=firebaseNamespace,extendStatics$2=function(e,t){return(extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends$2(e,t){function n(){this.constructor=e}extendStatics$2(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign$2=function(){return(__assign$2=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},_a$1;function __awaiter$1(o,s,a,c){return new(a=a||Promise)(function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,r)}i((c=c.apply(o,s||[])).next())})}function __generator$1(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function __read$1(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function __spread$1(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read$1(arguments[t]));return e}var ERROR_MAP=(_a$1={},_a$1["only-available-in-window"]="This method is available in a Window context.",_a$1["only-available-in-sw"]="This method is available in a service worker context.",_a$1["should-be-overriden"]="This method should be overriden by extended classes.",_a$1["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",_a$1["permission-default"]="The required permissions were not granted and dismissed instead.",_a$1["permission-blocked"]="The required permissions were not granted and blocked instead.",_a$1["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",_a$1["notifications-blocked"]="Notifications have been blocked.",_a$1["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",_a$1["sw-registration-expected"]="A service worker registration was the expected input.",_a$1["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",_a$1["invalid-saved-token"]="Unable to access details of the saved token.",_a$1["sw-reg-redundant"]="The service worker being used for push was made redundant.",_a$1["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",_a$1["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",_a$1["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",_a$1["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",_a$1["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",_a$1["token-update-no-token"]="FCM returned no token when updating the user to push.",_a$1["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",_a$1["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",_a$1["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",_a$1["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",_a$1["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",_a$1["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",_a$1["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",_a$1["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",_a$1["failed-to-delete-token"]="Unable to delete the currently saved token.",_a$1["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",_a$1["bad-scope"]="The service worker scope must be a string with at least one character.",_a$1["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",_a$1["bad-subscription"]="The subscription must be a valid PushSubscription.",_a$1["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",_a$1["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",_a$1["failed-delete-vapid-key"]="The VAPID key could not be deleted.",_a$1["invalid-public-vapid-key"]="The public VAPID key must be a string.",_a$1["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",_a$1["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",_a$1),errorFactory=new ErrorFactory("messaging","Messaging",ERROR_MAP),DEFAULT_PUBLIC_VAPID_KEY=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),ENDPOINT="https://fcm.googleapis.com",MessageParameter,Dk,MessageType,Ek;function isArrayBufferEqual(e,t){if(null==e||null==t)return!1;if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),r=new DataView(t),i=0;i<e.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function toBase64(e){e=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,__spread$1(e)))}function arrayBufferToBase64(e){return toBase64(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}Dk=MessageParameter=MessageParameter||{},Dk.TYPE_OF_MSG="firebase-messaging-msg-type",Dk.DATA="firebase-messaging-msg-data",Ek=MessageType=MessageType||{},Ek.PUSH_MSG_RECEIVED="push-msg-received",Ek.NOTIFICATION_CLICKED="notification-clicked";var IidModel=(Ok.prototype.getToken=function(s,a,c){return __awaiter$1(this,void 0,void 0,function(){var t,n,r,i,o;return __generator$1(this,function(e){switch(e.label){case 0:t=arrayBufferToBase64(a.getKey("p256dh")),r=arrayBufferToBase64(a.getKey("auth")),r="authorized_entity="+s+"&endpoint="+a.endpoint+"&encryption_key="+t+"&encryption_auth="+r,isArrayBufferEqual(c.buffer,DEFAULT_PUBLIC_VAPID_KEY.buffer)||(n=arrayBufferToBase64(c),r+="&application_pub_key="+n),(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:r},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(ENDPOINT+"/fcm/connect/subscribe",r)];case 2:return[4,e.sent().json()];case 3:return i=e.sent(),[3,5];case 4:throw o=e.sent(),errorFactory.create("token-subscribe-failed",{errorInfo:o});case 5:if(i.error)throw o=i.error.message,errorFactory.create("token-subscribe-failed",{errorInfo:o});if(!i.token)throw errorFactory.create("token-subscribe-no-token");if(!i.pushSet)throw errorFactory.create("token-subscribe-no-push-set");return[2,{token:i.token,pushSet:i.pushSet}]}})})},Ok.prototype.updateToken=function(s,a,c,u,l){return __awaiter$1(this,void 0,void 0,function(){var t,n,r,i,o;return __generator$1(this,function(e){switch(e.label){case 0:t=arrayBufferToBase64(u.getKey("p256dh")),r=arrayBufferToBase64(u.getKey("auth")),r="push_set="+c+"&token="+a+"&authorized_entity="+s+"&endpoint="+u.endpoint+"&encryption_key="+t+"&encryption_auth="+r,isArrayBufferEqual(l.buffer,DEFAULT_PUBLIC_VAPID_KEY.buffer)||(n=arrayBufferToBase64(l),r+="&application_pub_key="+n),(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:r},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(ENDPOINT+"/fcm/connect/subscribe",r)];case 2:return[4,e.sent().json()];case 3:return i=e.sent(),[3,5];case 4:throw o=e.sent(),errorFactory.create("token-update-failed",{errorInfo:o});case 5:if(i.error)throw o=i.error.message,errorFactory.create("token-update-failed",{errorInfo:o});if(!i.token)throw errorFactory.create("token-update-no-token");return[2,i.token]}})})},Ok.prototype.deleteToken=function(i,o,s){return __awaiter$1(this,void 0,void 0,function(){var t,n,r;return __generator$1(this,function(e){switch(e.label){case 0:n="authorized_entity="+i+"&token="+o+"&pushSet="+s,(t=new Headers).append("Content-Type","application/x-www-form-urlencoded"),n={method:"POST",headers:t,body:n},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(ENDPOINT+"/fcm/connect/unsubscribe",n)];case 2:return[4,e.sent().json()];case 3:if((n=e.sent()).error)throw r=n.error.message,errorFactory.create("token-unsubscribe-failed",{errorInfo:r});return[3,5];case 4:throw r=e.sent(),errorFactory.create("token-unsubscribe-failed",{errorInfo:r});case 5:return[2]}})})},Ok);function Ok(){}function base64ToArrayBuffer(e){for(var e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}var OLD_DB_NAME="undefined",OLD_OBJECT_STORE_NAME="fcm_token_object_Store";function handleDb(n){var e,r,i;n.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)&&(e=n.transaction(OLD_OBJECT_STORE_NAME).objectStore(OLD_OBJECT_STORE_NAME),r=new IidModel,(i=e.openCursor()).onerror=function(e){console.warn("Unable to cleanup old IDB.",e)},i.onsuccess=function(){var e,t=i.result;t?(e=t.value,r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()):(n.close(),indexedDB.deleteDatabase(OLD_DB_NAME))})}function cleanV1(){var t=indexedDB.open(OLD_DB_NAME);t.onerror=function(e){},t.onsuccess=function(e){handleDb(t.result)}}var DbInterface=(Ul.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},Ul.prototype.getIndex=function(t,n){return this.createTransaction(function(e){return e.index(t).get(n)})},Ul.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},Ul.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},Ul.prototype.closeDatabase=function(){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){switch(e.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:e.sent().close(),this.dbPromise=null,e.label=2;case 2:return[2]}})})},Ul.prototype.createTransaction=function(i,o){return void 0===o&&(o="readonly"),__awaiter$1(this,void 0,void 0,function(){var n,t,r;return __generator$1(this,function(e){switch(e.label){case 0:return[4,this.getDb()];case 1:return t=e.sent(),n=t.transaction(this.objectStoreName,o),t=n.objectStore(this.objectStoreName),[4,promisify(i(t))];case 2:return r=e.sent(),[2,new Promise(function(e,t){n.oncomplete=function(){e(r)},n.onerror=function(){t(n.error)}})]}})})},Ul.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,t){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){e(n.result)},n.onerror=function(){r.dbPromise=null,t(n.error)},n.onupgradeneeded=function(e){return r.onDbUpgrade(n,e)}})),this.dbPromise},Ul);function Ul(){this.dbPromise=null}function promisify(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}var TokenDetailsModel=(xm=DbInterface,__extends$2(ym,xm),ym.prototype.onDbUpgrade=function(e,t){var n=e.result;switch(t.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:cleanV1();case 2:var r,i=(r=e.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var e,t,n=i.result;n&&(e=n.value,t=__assign$2({},e),e.createTime||(t.createTime=Date.now()),"string"==typeof e.vapidKey&&(t.vapidKey=base64ToArrayBuffer(e.vapidKey)),"string"==typeof e.auth&&(t.auth=base64ToArrayBuffer(e.auth).buffer),"string"==typeof e.auth&&(t.p256dh=base64ToArrayBuffer(e.p256dh).buffer),n.update(t),n.continue())}}},ym.prototype.getTokenDetailsFromToken=function(t){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){if(!t)throw errorFactory.create("bad-token");return validateInputs({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},ym.prototype.getTokenDetailsFromSWScope=function(t){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){if(!t)throw errorFactory.create("bad-scope");return validateInputs({swScope:t}),[2,this.get(t)]})})},ym.prototype.saveTokenDetails=function(t){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){if(!t.swScope)throw errorFactory.create("bad-scope");if(!t.vapidKey)throw errorFactory.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw errorFactory.create("bad-subscription");if(!t.fcmSenderId)throw errorFactory.create("bad-sender-id");if(!t.fcmToken)throw errorFactory.create("bad-token");if(!t.fcmPushSet)throw errorFactory.create("bad-push-set");return validateInputs(t),[2,this.put(t)]})})},ym.prototype.deleteToken=function(n){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){switch(e.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(errorFactory.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(t=e.sent()))throw errorFactory.create("delete-token-not-found");return[4,this.delete(t.swScope)];case 2:return e.sent(),[2,t]}})})},ym),xm;function ym(){var e=null!==xm&&xm.apply(this,arguments)||this;return e.dbName="fcm_token_details_db",e.dbVersion=3,e.objectStoreName="fcm_token_object_Store",e}function validateInputs(e){if(e.fcmToken&&("string"!=typeof e.fcmToken||0===e.fcmToken.length))throw errorFactory.create("bad-token");if(e.swScope&&("string"!=typeof e.swScope||0===e.swScope.length))throw errorFactory.create("bad-scope");if(e.vapidKey&&(!(e.vapidKey instanceof Uint8Array)||65!==e.vapidKey.length))throw errorFactory.create("bad-vapid-key");if(e.endpoint&&("string"!=typeof e.endpoint||0===e.endpoint.length))throw errorFactory.create("bad-subscription");if(e.auth&&!(e.auth instanceof ArrayBuffer))throw errorFactory.create("bad-subscription");if(e.p256dh&&!(e.p256dh instanceof ArrayBuffer))throw errorFactory.create("bad-subscription");if(e.fcmSenderId&&("string"!=typeof e.fcmSenderId||0===e.fcmSenderId.length))throw errorFactory.create("bad-sender-id");if(e.fcmPushSet&&("string"!=typeof e.fcmPushSet||0===e.fcmPushSet.length))throw errorFactory.create("bad-push-set")}var UNCOMPRESSED_PUBLIC_KEY_SIZE=65,VapidDetailsModel=(Sm=DbInterface,__extends$2(Tm,Sm),Tm.prototype.onDbUpgrade=function(e){e.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},Tm.prototype.getVapidFromSWScope=function(n){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){switch(e.label){case 0:if("string"!=typeof n||0===n.length)throw errorFactory.create("bad-scope");return[4,this.get(n)];case 1:return[2,(t=e.sent())?t.vapidKey:void 0]}})})},Tm.prototype.saveVapidDetails=function(n,r){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){if("string"!=typeof n||0===n.length)throw errorFactory.create("bad-scope");if(null===r||r.length!==UNCOMPRESSED_PUBLIC_KEY_SIZE)throw errorFactory.create("bad-vapid-key");return t={swScope:n,vapidKey:r},[2,this.put(t)]})})},Tm.prototype.deleteVapidDetails=function(n){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){switch(e.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(t=e.sent()))throw errorFactory.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return e.sent(),[2,t]}})})},Tm),Sm;function Tm(){var e=null!==Sm&&Sm.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}var SENDER_ID_OPTION_NAME="messagingSenderId",TOKEN_EXPIRATION_MILLIS=6048e5,BaseController=(fn.prototype.getToken=function(){return __awaiter$1(this,void 0,void 0,function(){var t,n,r,i;return __generator$1(this,function(e){switch(e.label){case 0:if("denied"===(i=this.getNotificationPermission_()))throw errorFactory.create("notifications-blocked");return"granted"!==i?[2,null]:[4,this.getSWRegistration_()];case 1:return t=e.sent(),[4,this.getPublicVapidKey_()];case 2:return n=e.sent(),[4,this.getPushSubscription(t,n)];case 3:return r=e.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(t.scope)];case 4:return(i=e.sent())?[2,this.manageExistingToken(t,r,n,i)]:[2,this.getNewToken(t,r,n)]}})})},fn.prototype.manageExistingToken=function(t,n,r,i){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){switch(e.label){case 0:return isTokenStillValid(n,r,i)?Date.now()<i.createTime+TOKEN_EXPIRATION_MILLIS?[2,i.fcmToken]:[2,this.updateToken(t,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return e.sent(),[2,this.getNewToken(t,n,r)]}})})},fn.prototype.updateToken=function(i,o,s,a){return __awaiter$1(this,void 0,void 0,function(){var t,n,r;return __generator$1(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,a.fcmToken,a.fcmPushSet,o,s)];case 1:return t=e.sent(),n={swScope:i.scope,vapidKey:s,fcmSenderId:this.messagingSenderId,fcmToken:t,fcmPushSet:a.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,s)];case 3:return e.sent(),[2,t];case 4:return r=e.sent(),[4,this.deleteToken(a.fcmToken)];case 5:throw e.sent(),r;case 6:return[2]}})})},fn.prototype.getNewToken=function(r,i,o){return __awaiter$1(this,void 0,void 0,function(){var t,n;return __generator$1(this,function(e){switch(e.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return t=e.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:t.token,fcmPushSet:t.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return e.sent(),[2,t.token]}})})},fn.prototype.deleteToken=function(n){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){switch(e.label){case 0:return[4,this.deleteTokenFromDB(n)];case 1:return e.sent(),[4,this.getSWRegistration_()];case 2:return(t=e.sent())?[4,t.pushManager.getSubscription()]:[3,4];case 3:if(t=e.sent())return[2,t.unsubscribe()];e.label=4;case 4:return[2,!0]}})})},fn.prototype.deleteTokenFromDB=function(n){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){switch(e.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return t=e.sent(),[4,this.iidModel.deleteToken(t.fcmSenderId,t.fcmToken,t.fcmPushSet)];case 2:return e.sent(),[2]}})})},fn.prototype.getPushSubscription=function(t,n){return t.pushManager.getSubscription().then(function(e){return e||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},fn.prototype.requestPermission=function(){throw errorFactory.create("only-available-in-window")},fn.prototype.useServiceWorker=function(e){throw errorFactory.create("only-available-in-window")},fn.prototype.usePublicVapidKey=function(e){throw errorFactory.create("only-available-in-window")},fn.prototype.onMessage=function(e,t,n){throw errorFactory.create("only-available-in-window")},fn.prototype.onTokenRefresh=function(e,t,n){throw errorFactory.create("only-available-in-window")},fn.prototype.setBackgroundMessageHandler=function(e){throw errorFactory.create("only-available-in-sw")},fn.prototype.delete=function(){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return e.sent(),[2]}})})},fn.prototype.getNotificationPermission_=function(){return Notification.permission},fn.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},fn.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},fn.prototype.getIidModel=function(){return this.iidModel},fn);function fn(e){var t=this;if(!e.options[SENDER_ID_OPTION_NAME]||"string"!=typeof e.options[SENDER_ID_OPTION_NAME])throw errorFactory.create("bad-sender-id");this.messagingSenderId=e.options[SENDER_ID_OPTION_NAME],this.tokenDetailsModel=new TokenDetailsModel,this.vapidDetailsModel=new VapidDetailsModel,this.iidModel=new IidModel,this.app=e,this.INTERNAL={delete:function(){return t.delete()}}}function isTokenStillValid(e,t,n){if(!n.vapidKey||!isArrayBufferEqual(t.buffer,n.vapidKey.buffer))return!1;var r=e.endpoint===n.endpoint,t=isArrayBufferEqual(e.getKey("auth"),n.auth),n=isArrayBufferEqual(e.getKey("p256dh"),n.p256dh);return r&&t&&n}var FCM_MSG="FCM_MSG",SwController=(jo=BaseController,__extends$2(ko,jo),ko.prototype.onPush=function(e){e.waitUntil(this.onPush_(e))},ko.prototype.onSubChange=function(e){e.waitUntil(this.onSubChange_(e))},ko.prototype.onNotificationClick=function(e){e.waitUntil(this.onNotificationClick_(e))},ko.prototype.onPush_=function(a){return __awaiter$1(this,void 0,void 0,function(){var t,n,r,i,o,s;return __generator$1(this,function(e){switch(e.label){case 0:if(!a.data)return[2];try{t=a.data.json()}catch(e){return[2]}return[4,this.hasVisibleClients_()];case 1:return e.sent()?[2,this.sendMessageToWindowClients_(t)]:(n=this.getNotificationData_(t))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=e.sent(),o=n.actions,s=Notification.maxActions,o&&s&&o.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(t)]:[3,5];case 4:return e.sent(),[2];case 5:return[2]}})})},ko.prototype.onSubChange_=function(e){return __awaiter$1(this,void 0,void 0,function(){var t,n,r;return __generator$1(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return r=e.sent(),[3,3];case 2:throw t=e.sent(),errorFactory.create("unable-to-resubscribe",{errorInfo:t});case 3:return e.trys.push([3,5,,8]),[4,r.pushManager.getSubscription()];case 4:return e.sent(),[3,8];case 5:return n=e.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(r.scope)];case 6:if(!(r=e.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw e.sent(),n;case 8:return[2]}})})},ko.prototype.onNotificationClick_=function(i){return __awaiter$1(this,void 0,void 0,function(){var t,n,r;return __generator$1(this,function(e){switch(e.label){case 0:return i.notification&&i.notification.data&&i.notification.data[FCM_MSG]?i.action?[2]:(i.stopImmediatePropagation(),i.notification.close(),(r=i.notification.data[FCM_MSG]).notification&&(t=r.fcmOptions&&r.fcmOptions.link||r.notification.click_action)?[4,this.getWindowClient_(t)]:[2]):[2];case 1:return(n=e.sent())?[3,3]:[4,self.clients.openWindow(t)];case 2:return n=e.sent(),[3,5];case 3:return[4,n.focus()];case 4:n=e.sent(),e.label=5;case 5:return n?(delete r.notification,delete r.fcmOptions,r=createNewMsg(MessageType.NOTIFICATION_CLICKED,r),[2,this.attemptToMessageClient_(n,r)]):[2]}})})},ko.prototype.getNotificationData_=function(e){var t;if(e&&"object"==typeof e.notification){var n=__assign$2({},e.notification);return n.data=__assign$2({},e.notification.data,((t={})[FCM_MSG]=e,t)),n}},ko.prototype.setBackgroundMessageHandler=function(e){if(!e||"function"!=typeof e)throw errorFactory.create("bg-handler-function-expected");this.bgMessageHandler=e},ko.prototype.getWindowClient_=function(o){return __awaiter$1(this,void 0,void 0,function(){var t,n,r,i;return __generator$1(this,function(e){switch(e.label){case 0:return t=new URL(o,self.location.href).href,[4,getClientList()];case 1:for(n=e.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===t){r=n[i];break}return[2,r]}})})},ko.prototype.attemptToMessageClient_=function(t,n){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){if(!t)throw errorFactory.create("no-window-client-to-msg");return t.postMessage(n),[2]})})},ko.prototype.hasVisibleClients_=function(){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){switch(e.label){case 0:return[4,getClientList()];case 1:return[2,e.sent().some(function(e){return"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")})]}})})},ko.prototype.sendMessageToWindowClients_=function(i){return __awaiter$1(this,void 0,void 0,function(){var t,n,r=this;return __generator$1(this,function(e){switch(e.label){case 0:return[4,getClientList()];case 1:return t=e.sent(),n=createNewMsg(MessageType.PUSH_MSG_RECEIVED,i),[4,Promise.all(t.map(function(e){return r.attemptToMessageClient_(e,n)}))];case 2:return e.sent(),[2]}})})},ko.prototype.getSWRegistration_=function(){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){return[2,self.registration]})})},ko.prototype.getPublicVapidKey_=function(){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){switch(e.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=e.sent()))throw errorFactory.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(t=e.sent())?[2,DEFAULT_PUBLIC_VAPID_KEY]:[2,t]}})})},ko),jo;function ko(e){var t=jo.call(this,e)||this;return t.bgMessageHandler=null,self.addEventListener("push",function(e){t.onPush(e)}),self.addEventListener("pushsubscriptionchange",function(e){t.onSubChange(e)}),self.addEventListener("notificationclick",function(e){t.onNotificationClick(e)}),t}function getClientList(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function createNewMsg(e,t){var n={};return n[MessageParameter.TYPE_OF_MSG]=e,n[MessageParameter.DATA]=t,n}var DEFAULT_SW_PATH="/firebase-messaging-sw.js",DEFAULT_SW_SCOPE="/firebase-cloud-messaging-push-scope",WindowController=(sp=BaseController,__extends$2(tp,sp),tp.prototype.requestPermission=function(){return __awaiter$1(this,void 0,void 0,function(){var t;return __generator$1(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?errorFactory.create("permission-blocked"):errorFactory.create("permission-default")}})})},tp.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw errorFactory.create("sw-registration-expected");if(null!=this.registrationToUse)throw errorFactory.create("use-sw-before-get-token");this.registrationToUse=e},tp.prototype.usePublicVapidKey=function(e){if("string"!=typeof e)throw errorFactory.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw errorFactory.create("use-public-key-before-get-token");e=base64ToArrayBuffer(e);if(65!==e.length)throw errorFactory.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},tp.prototype.onMessage=function(e,t,n){return"function"==typeof e?this.onMessageInternal(e,t,n):this.onMessageInternal(e)},tp.prototype.onTokenRefresh=function(e,t,n){return"function"==typeof e?this.onTokenRefreshInternal(e,t,n):this.onTokenRefreshInternal(e)},tp.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(e,t){var n;i?"activated"!==i.state?"redundant"!==i.state?(n=function(){if("activated"===i.state)e(r);else{if("redundant"!==i.state)return;t(errorFactory.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)},i.addEventListener("statechange",n)):t(errorFactory.create("sw-reg-redundant")):e(r):t(errorFactory.create("no-sw-in-reg"))})},tp.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register(DEFAULT_SW_PATH,{scope:DEFAULT_SW_SCOPE}).catch(function(e){throw errorFactory.create("failed-serviceworker-registration",{browserErrorMessage:e.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return(t.registrationToUse=e).update(),e})}))},tp.prototype.getPublicVapidKey_=function(){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(e){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,DEFAULT_PUBLIC_VAPID_KEY]})})},tp.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[MessageParameter.TYPE_OF_MSG]){var t=e.data;switch(t[MessageParameter.TYPE_OF_MSG]){case MessageType.PUSH_MSG_RECEIVED:case MessageType.NOTIFICATION_CLICKED:var n=t[MessageParameter.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},tp),sp;function tp(e){var t=sp.call(this,e)||this;return t.registrationToUse=null,t.publicVapidKeyToUse=null,t.messageObserver=null,t.tokenRefreshObserver=null,t.onMessageInternal=createSubscribe(function(e){t.messageObserver=e}),t.onTokenRefreshInternal=createSubscribe(function(e){t.tokenRefreshObserver=e}),t.setupSWMessageListener_(),t}function registerMessaging(e){var t={isSupported:isSupported};e.INTERNAL.registerService("messaging",function(e){if(!isSupported())throw errorFactory.create("unsupported-browser");return new(self&&"ServiceWorkerGlobalScope"in self?SwController:WindowController)(e)},t)}function isSupported(){return(self&&"ServiceWorkerGlobalScope"in self?isSWControllerSupported:isWindowControllerSupported)()}function isWindowControllerSupported(){return navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function isSWControllerSupported(){return"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}registerMessaging(firebase);var FCMMessaging=(_p.prototype.getPushState=function(){return __awaiter(this,void 0,Promise,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=Notification?{default:PushNotificationUserStatus.ASK,denied:PushNotificationUserStatus.BLOCKED,granted:PushNotificationUserStatus.ALLOWED}[Notification.permission]:PushNotificationUserStatus.BROWSER_NOT_SUPPORTED,this.log("FCM: getPushState = ",PushNotificationUserStatus[t]),r={pushNotificationUserStatus:t},t!==PushNotificationUserStatus.ALLOWED?[3,2]:[4,this.getPermissionAndToken()];case 1:return n=e.sent(),[3,3];case 2:n=null,e.label=3;case 3:return[2,(r.token=n,r.platform=Detector.getClientPlatform(),r)]}})})},_p.prototype.bindToCustomWorker=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.bindToCustomWorkerDone?[3,2]:(this.bindToCustomWorkerDone=!0,t=this.FCM_SW_URL+("&senderId="+this.FCM_SENDER_ID)+"&reporting_url="+encodeURIComponent(this.PUBLIC_API_URL)+(this.brand_key?"&brand_key="+this.brand_key:""),this.log("FCM: registering service worker with url:",t),[4,navigator.serviceWorker.register(t,{scope:this.FCM_SCOPE_PATH+"/firebase-cloud-messaging-push-scope"})]);case 1:t=e.sent(),this.log("FCM: bindToCustomWorker, service worker registered: ",t),this.messaging.useServiceWorker(t),e.label=2;case 2:return[2]}})})},_p.prototype.getPermissionAndToken=function(){return __awaiter(this,void 0,Promise,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,7,,8]),this.log("FCM: getPermissionAndToken, registering service worker.."),[4,this.bindToCustomWorker()];case 1:return e.sent(),this.log("FCM: getPermissionAndToken, requestPermission"),[4,this.messaging.requestPermission()];case 2:e.sent(),e.label=3;case 3:return e.trys.push([3,5,,6]),this.log("FCM: getPermissionAndToken, getToken"),[4,this.messaging.getToken()];case 4:return t=e.sent(),this.log("FCM: Token = ",t),[2,t];case 5:return n=e.sent(),this.log("Unable to get token",n),[2,null];case 6:return[3,8];case 7:return n=e.sent(),this.log("Unable to get permission.",n),[2,null];case 8:return[2]}})})},_p),DpType,vq,ClientEventTypes,wq;function _p(e,t,n,r,i){var o=this;void 0===i&&(i=null),this.bindToCustomWorkerDone=!1,this.log=e,this.FCM_SENDER_ID=t,this.PUBLIC_API_URL=n,this.FCM_SW_URL=r,this.brand_key=i;r=r.split("/");r.pop(),this.FCM_SCOPE_PATH=r.join("/"),this.log("FCM: init FCM with ",this.FCM_SENDER_ID,this.PUBLIC_API_URL,this.FCM_SW_URL,this.brand_key),0===firebase.apps.length&&firebase.initializeApp({messagingSenderId:t.toString()}),this.messaging=firebase.messaging(),this.messaging.onMessage(function(n){return __awaiter(o,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.log("Message received in foregraund",n),[4,navigator.serviceWorker.getRegistration(this.FCM_SCOPE_PATH+"/firebase-cloud-messaging-push-scope")];case 1:return t=e.sent(),this.log("Found ServiceWorker object",t),t.active.postMessage(n),[2]}})})})}vq=DpType=DpType||{},vq.AskPushPermissions="ask_push_permissions",vq.Ok="ok",vq.Cancel="cancel",vq.Close="close",vq.Go="go",vq.GfMain="gf",vq.Activity="gf_activity",vq.Missions="gf_missions",vq.Badges="gf_badges",vq.LeaderBoard="gf_board",vq.Tournaments="gf_tournaments",vq.LeaderBoardPrev="gf_board_previous",vq.LeaderBoardRules="gf_board_rules",vq.Bonuses="gf_bonuses",vq.Levels="gf_levels",vq.Saw="gf_saw",vq.Store="gf_store",vq.Settings="gf_settings",vq.Section="gf_section",vq.GfClose="gf_close",vq.Submit="submit",wq=ClientEventTypes=ClientEventTypes||{},wq.client_action="client_action",wq.update_sensitive_properties="update_sensitive_properties",wq.core_language_changed="core_language_changed",wq.core_cannot_open_gamification="core_cannot_open_gamification";var CUSTOM_DP_HANDLER_F="__smarticoDPCustom",DeepLinks=(xq.doAskPushPermissions=function(e,t){t.requestPushPermissions()},xq.doExecuteGfDp=function(e,t){t.executeGfDp(e)},xq.doNavigateOutside=function(e,t){return e.params.target&&"blank"===e.params.target?window.open(e.params.url):setTimeout(function(){return window.location.href=e.params.url},100),!1},xq.doSubmitForm=function(e,t){t.sendRow(ClassId.EVENT,!0,{eventType:ClientEventTypes.update_sensitive_properties,payload:__assign({},e.params)})},xq.doNothing=function(e,t){},xq.actionHandler=function(e,t,n,r,i,o,s){if(void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),null!==t&&""!==t)if(o)this.log("PromoBuilder: in preview mode, skipping engagement report and DP handling");else{var a=null,c=xq.parse(t);if(this.log("Deeplink parsed:",c),DEEP_LINK_GAMIFICATION.includes(c.action)&&e.getPublicProps&&c.action!==DpType.GfClose)if(e.getPublicProps().ach_gamification_in_control_group)return this.log("Smartico user is in gamification control group, deep link cannot be handled"),void e.sendRow(ClassId.EVENT,!0,{eventType:ClientEventTypes.core_cannot_open_gamification,payload:{dp_action:c.action}});DEEP_LINK_HANDLERS[c.action]?(this.log("Found core DP hander"),a=DEEP_LINK_HANDLERS[c.action]):window[CUSTOM_DP_HANDLER_F]?(this.log("Found custom DP handler registered via labels setting JS_INJECTION"),a=window[CUSTOM_DP_HANDLER_F]):this.log("Unknown deep link client action: ",c),null===n?this.log("Missing engagement uuid in DeepLinks.actionHandler call, skipping report to server"):!i||a?e.reportEngagmentAction({engagement_uid:n,action:c.actionToReport,activityType:r}):e.reportEngagmentFail({engagement_uid:n,action:c.actionToReport,activityType:r}),this.log("Executing DP, with handler: ",a);try{s?e.executeNativeDp(t):a(c,e)}catch(e){this.error("Failed to execute deep link",c,a,e)}}else this.error("Missing dp action value in DeepLinks.actionHandler call")},xq.parse=function(e){var t,n=null,r=null===(i=e&&decodeURI(e))||void 0===i?void 0:i.toLowerCase().trim();if(e.startsWith("https://")||e.startsWith("http://"))n="go",t={url:e};else{var i=e.substring(3).split("&");(n=i.shift())===DpType.Submit&&(r="dp:"+DpType.Submit);e={};if(!i.length)return{action:n,params:__assign({},e),actionToReport:r};t=i.reduce(function(e,t){var n=t.split("="),t=n[0],n=n[1];return void 0===n&&(n="true"),e[t]=decodeURIComponent(n),e},e)}return{action:n,params:t,actionToReport:r}},xq.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,__spreadArrays(["SMARTICO, DPH:"],e))},xq.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,__spreadArrays(["SMARTICO, DPH:"],e))},xq.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,__spreadArrays(["SMARTICO, DPH:"],e))},xq);function xq(){}var DEEP_LINK_GAMIFICATION=[DpType.GfMain,DpType.Activity,DpType.Missions,DpType.Badges,DpType.LeaderBoard,DpType.Tournaments,DpType.LeaderBoardPrev,DpType.LeaderBoardRules,DpType.Bonuses,DpType.Levels,DpType.Saw,DpType.Store,DpType.Settings,DpType.Section,DpType.GfClose],DEEP_LINK_HANDLERS={};DEEP_LINK_HANDLERS[DpType.AskPushPermissions]=DeepLinks.doAskPushPermissions,DEEP_LINK_HANDLERS[DpType.Ok]=DeepLinks.doNothing,DEEP_LINK_HANDLERS[DpType.Cancel]=DeepLinks.doNothing,DEEP_LINK_HANDLERS[DpType.Close]=DeepLinks.doNothing,DEEP_LINK_HANDLERS[DpType.Go]=DeepLinks.doNavigateOutside,DEEP_LINK_HANDLERS[DpType.Submit]=DeepLinks.doSubmitForm,DEEP_LINK_GAMIFICATION.forEach(function(e){DEEP_LINK_HANDLERS[e]=DeepLinks.doExecuteGfDp});var SCRIPTS_LOCATION="https://libs.smartico.ai",PromoBuilderNew=(lr.showPromoMessage=function(t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),lr.hasPopupOnScreen()&&!r)return n.reportEngagmentFail({engagement_uid:t.engagement_uid,activityType:t.activityType,reason:ENGAGEMENT_FAIL_REASONS.ANOTHER_ENGAGEMENT_IS_STILL_IN_FOCOUS}),!1;lr.closePromoMessage(null);var e=t.template_engine===POPUP_TEMPLATE_ENGINE.INTERACTION_PLUS?lr.iframeContentInteractionPlus(t.template_html,t.params):lr.iframeContentFull(t.template_html,t.params);return _add({id:"__btgPromo"+t.engagement_uid,className:"__btgPromoHolder",style:"width:100%;height:100%;position: fixed;z-index: "+Z_INDEX.POPUPS+"; border:0; top: 0; left: 0",srcdoc:e},document.body,"iframe").handleDeepLink=function(e){lr.closePromoMessage(n),DeepLinks.actionHandler(n,e,t.engagement_uid,t.activityType,!1,r,i)},!0},lr.hasPopupOnScreen=function(){return _exists(".__btgPromoHolder")},lr.closePromoMessage=function(e){_remove(".__btgPromoHolder"),e&&e.promoMessageClosed()},lr.iframeContentFull=function(e,t){return'\n            <!DOCTYPE html>\n            <html>\n                <head>\n                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n                    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n                    <meta name="viewport" content="width=device-width, initial-scale=1">\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/tmpl.min.js"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/smtko-dp-common.js"><\/script>\n                    <script>\n                        window.onload = function() {\n                            var params = '+JSON.stringify(t)+";\n                            var __root_centered = document.getElementById('__root_centered')\n                            __root_centered.innerHTML = tmpl('_template', params);\n\n                            // adjust size of popup to fit to the mobile screen\n                            setTimeout( function() {\n                                var widthRatio = 0.9;\n                                if (window.innerWidth * widthRatio < __root_centered.offsetWidth ) {\n                                    __root_centered.style.zoom = window.innerWidth * widthRatio / __root_centered.offsetWidth\n                                }\n                            }, 500)\n                            attachDpHandlers();                      \n                        };\n                    <\/script>\n                    <style>\n                        body {\n                            margin:0; padding:0;\n                        }\n                        div#__root_centered {\n                            position: absolute;\n                            top: 50%;\n                            left: 50%;\n                            transform: translate(-50%, -50%);\n                            -ms-transform: translate(-50%, -50%); /* IE 9 */\n                            -webkit-transform: translate(-50%, -50%); /* Chrome, Safari, Opera */\n                        }\n                        div#__overlay {\n                            background-color:#000;\n                            opacity:0.5;\n                            position: absolute;\n                            width:100%;\n                            height:100%;\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div id='__overlay'></div>\n                    <div id='__root_centered' />\n                    <script type=\"text/x-tmpl\" id=\"_template\">"+e+"<\/script>\n                </body>\n            </html>"},lr.iframeContentInteractionPlus=function(e,t){return'\n            <!DOCTYPE html>\n            <html>\n                <head>\n                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n                    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n                    <meta name="viewport" content="width=device-width, initial-scale=1">\n                    <link href="'+SCRIPTS_LOCATION+'/jsi/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css">\n                    <link href=\'https://fonts.googleapis.com/css?family=Allura&subset=latin\' rel=\'stylesheet\' type=\'text/css\'>\n                    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">\n                    <link href="'+SCRIPTS_LOCATION+'/jsi/arund/css/arund.min.css" rel="stylesheet" type="text/css">\n                    <link href="'+SCRIPTS_LOCATION+'/jsi/arund/css/ao-countdown.css" rel="stylesheet" type="text/css">\n                    <script>\n                        var __template_params = '+JSON.stringify(t)+';\n                    <\/script>\n                </head>\n                <body class="ao-body">\n                    <div class="ao-page ao-font-lato">\n                        '+(-1===e.indexOf("<script data-ao-template")?'<script data-ao-template="x" data-ao-popup-on="init:load" type="text/x-tmpl">'+e+"<\/script>":e)+'\n                    </div>\n                    <div class="ao-window-fake" data-ao-animaze-resize="windowSize:min 100%"></div>\n            \n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/jquery.min.js" type="text/javascript"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/moment/moment.min.js"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/js.cookie.min.js" type="text/javascript"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/tmpl.min.js"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/smtko-dp-common.js"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/smtko-interactive-init.js"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/arund/js/arund.min.js" type="text/javascript"><\/script>\n                    <script src="'+SCRIPTS_LOCATION+'/jsi/js/script.js" type="text/javascript"><\/script>\n                </body>\n            </html>'},lr);function lr(){}function _exists(e,t){return 0<(t=void 0===t?document.body:t).querySelectorAll(e).length}function _add(t,e,n){void 0===t&&(t={}),void 0===e&&(e=document.body),void 0===n&&(n="div");var r=document.createElement(n);return Object.keys(t).map(function(e){return r[e]=t[e]}),e.appendChild(r),r}function _remove(e){document.querySelectorAll(e).forEach(function(e){return e.parentNode.removeChild(e)})}var parseUrl=function(){for(var e=window.location.search,t={},n=("?"===e[0]?e.substr(1):e).split("&"),r=0;r<n.length;r++){var i=n[r].split("=");""!==i[0]&&(t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]||""))}return t},parseUrlHash=function(){for(var e={},t=window.location.hash.substr(1).split(/\?|&/),n=0;n<t.length;n++){var r=t[n].split("=");""!==r[0]&&(e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||""))}return e},LogLevel$1,Sr,Tr;Sr=LogLevel$1=LogLevel$1||{},Sr[Sr.DISABLED=0]="DISABLED",Sr[Sr.ERROR=1]="ERROR",Sr[Sr.WARNING=2]="WARNING",Sr[Sr.INFO=3]="INFO",Sr[Sr.DEBUG=4]="DEBUG",Tr=LogLevel$1=LogLevel$1||{},Tr.deserialize=function(e){if(Util.isNotEmpty(e))switch(e){case"disabled":return Tr.DISABLED;case"error":return Tr.ERROR;case"warn":return Tr.WARNING;case"info":return Tr.INFO;case"debug":return Tr.DEBUG}return null};var LogLevel$2=LogLevel$1,Logger$1=(Wr.Of=function(e){return new Wr(e)},Wr.setLogLevel=function(e){Wr.SetLogLevel(LogLevel$2.deserialize(e))},Wr.SetLogLevel=function(e){Util.isNotNull(e)&&(Wr.LOG_LEVEL=e)},Wr.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Wr.LOG_LEVEL>=LogLevel$2.DEBUG&&(Util.isArrayNotEmpty(t)?console.debug(this.format(" D "),e,JSON.stringify(t)):console.debug(this.format(" D "),e))},Wr.prototype.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Wr.LOG_LEVEL>=LogLevel$2.INFO&&(Util.isArrayNotEmpty(t)?console.info(this.format(" I "),e,JSON.stringify(t)):console.info(this.format(" I "),e))},Wr.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Wr.LOG_LEVEL>=LogLevel$2.WARNING&&(Util.isArrayNotEmpty(t)?console.warn(this.format(" W "),e,JSON.stringify(t)):console.warn(this.format(" W "),e))},Wr.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Wr.LOG_LEVEL>=LogLevel$2.ERROR&&(Util.isArrayNotEmpty(t)?console.error(this.format(" E "),e,JSON.stringify(t)):console.error(this.format(" E "),e))},Wr.prototype.format=function(e){return["SMTKO",e,"[",this.name,"]"," "].join("")},Wr.pad=function(e){return("0"+e).slice(-2)},Wr.formatDate=function(){var e=new Date;return[this.pad(e.getDate()),this.pad(e.getMonth()+1),e.getFullYear()].join("-")+" "+[this.pad(e.getHours()),this.pad(e.getMinutes()),this.pad(e.getSeconds())].join(":")+"."+e.getMilliseconds()},Wr.LOG_LEVEL=LogLevel$2.ERROR,Wr),InteractionBridgeType,os,CacheKey,ps;function Wr(e){this.name=e}os=InteractionBridgeType=InteractionBridgeType||{},os.GamificationWidget="GamificationWidget",os.GamificationMain="GamificationMain",os.MiniGame="MiniGame",os.DepositCloseMe="DepositCloseMe",ps=CacheKey=CacheKey||{},ps.UserInfo="UserInfo",ps.Levels="Levels";var Cache=(qs.clear=function(){qs._cache=new typescriptMap_1},qs.set=function(e,t){this._cache.set(e,t)},qs.get=function(e){return this._cache.get(e)},qs.has=function(e){return this._cache.has(e)},qs._cache=new typescriptMap_1,qs),InteractionMessageId,vs;function qs(){}vs=InteractionMessageId=InteractionMessageId||{},vs[vs.Sys=-1]="Sys",vs[vs.IamReady=1]="IamReady",vs[vs.PleaseInit=2]="PleaseInit",vs[vs.IamInitialized=3]="IamInitialized",vs[vs.PleaseCloseMe=4]="PleaseCloseMe",vs[vs.SetMyStyle=5]="SetMyStyle",vs[vs.CreateFrame=6]="CreateFrame",vs[vs.SetUserInfo=7]="SetUserInfo",vs[vs.Levels=8]="Levels",vs[vs.ProtocolRequest=9]="ProtocolRequest",vs[vs.ProtocolResponse=10]="ProtocolResponse",vs[vs.ProtocolEvent=11]="ProtocolEvent",vs[vs.VerifyDp=12]="VerifyDp",vs[vs.ExecuteDp=13]="ExecuteDp",vs[vs.RecordScreen=14]="RecordScreen",vs[vs.SetConnectionStatus=15]="SetConnectionStatus",vs[vs.OnUrlChanged=16]="OnUrlChanged",vs[vs.InjectCss=17]="InjectCss",vs[vs.EditorStartInspect=101]="EditorStartInspect",vs[vs.EditorStopInspect=102]="EditorStopInspect",vs[vs.EditorHtmlElementHighlight=103]="EditorHtmlElementHighlight",vs[vs.EditorHtmlRemoveHighlight=104]="EditorHtmlRemoveHighlight",vs[vs.EditorHtmlElementSelected=105]="EditorHtmlElementSelected",vs[vs.EditorHtmlElementApply=106]="EditorHtmlElementApply",vs[vs.EditorHtmlApplyDomModification=107]="EditorHtmlApplyDomModification",vs[vs.EditorHtmlSetProps=108]="EditorHtmlSetProps",vs[vs.EditorHtmlHandleProps=109]="EditorHtmlHandleProps";var InteractionMessageBuilder=(ws.IamReady=function(){return{id:InteractionMessageId.IamReady}},ws.IamInitialized=function(){return{id:InteractionMessageId.IamInitialized}},ws.PleaseInit=function(e){return{id:InteractionMessageId.PleaseInit,settings:e}},ws.PleaseCloseMe=function(){return{id:InteractionMessageId.PleaseCloseMe}},ws.SetMyStyle=function(e){return Util.checkNotNull(e),{id:InteractionMessageId.SetMyStyle,style:e}},ws.InjectCss=function(e){return Util.checkNotNull(e),{id:InteractionMessageId.InjectCss,css:e}},ws.CreateFrame=function(e,t){return Util.checkNotNull(e),{id:InteractionMessageId.CreateFrame,bridgeType:e,style:t}},ws.SetUserInfo=function(e){return{id:InteractionMessageId.SetUserInfo,userInfo:e}},ws.SetLevels=function(e){return{id:InteractionMessageId.Levels,levels:e}},ws.ProtocolRequest=function(e,t){return void 0===t&&(t=!1),Util.checkNotNull(e),{id:InteractionMessageId.ProtocolRequest,request:e,identified:t}},ws.ProtocolResponse=function(e){return{id:InteractionMessageId.ProtocolResponse,response:e}},ws.ProtocolEvent=function(e){return{id:InteractionMessageId.ProtocolEvent,event:e}},ws.VerifyDp=function(e,t,n){return Util.checkNotNull(e),{id:InteractionMessageId.VerifyDp,dp:e,engagementUid:t,activityType:n}},ws.ExecuteDp=function(e){return{id:InteractionMessageId.ExecuteDp,dp:e}},ws.RecordScreen=function(e,t,n){return{id:InteractionMessageId.RecordScreen,e:e,page_session_uuid:t,tags:n}},ws.SetConnectionStatus=function(e){return{id:InteractionMessageId.SetConnectionStatus,status:e}},ws.OnUrlChanged=function(e){return{id:InteractionMessageId.OnUrlChanged,newUrl:e}},ws.EditorStartInspect=function(){return{id:InteractionMessageId.EditorStartInspect}},ws.EditorStopInspect=function(){return{id:InteractionMessageId.EditorStopInspect}},ws.EditorHtmlElementHighlight=function(e){return{id:InteractionMessageId.EditorHtmlElementHighlight,selector:e}},ws.EditorHtmlRemoveHighlight=function(){return{id:InteractionMessageId.EditorHtmlRemoveHighlight}},ws.EditorHtmlElementSelected=function(e,t){return{id:InteractionMessageId.EditorHtmlElementSelected,selector:e,props:t}},ws.EditorHtmlElementApply=function(e){return{id:InteractionMessageId.EditorHtmlElementApply,modificationContent:e}},ws.EditorHtmlApplyDomModification=function(e){return{id:InteractionMessageId.EditorHtmlApplyDomModification,domModification:e}},ws.EditorHtmlSetProps=function(e){return{id:InteractionMessageId.EditorHtmlSetProps,elements:e}},ws.EditorHtmlHandleProps=function(e){return{id:InteractionMessageId.EditorHtmlHandleProps,elements:e}},ws);function ws(){}var InteractionBridgeImpl=(Ys.prototype.close=function(){window.removeEventListener("message",this.handleMessage)},Ys),InteractionBridgePhase,gt,BridgeStatus,ht;function Ys(e){var r=this;this.sendMessage=function(e){var t;Util.checkNotNull(e),e.bridgeId=r._props.bridgeId;var n=JSON.stringify(e);try{e.id!==InteractionMessageId.RecordScreen&&r._logger.debug("<-- Send message: "+e.id+" bridgeId: "+r._props.bridgeId+", cid: "+(null===(t=e.response)||void 0===t?void 0:t.cid)),r._props.frame.contentWindow.postMessage(n,"*")}catch(e){r._logger.debug("Error send post message: "+n+" Error: "+JSON.stringify(e))}},this.handleMessage=function(e){var t;try{if(t=JSON.parse(e.data),Util.isNotNull(t.id)&&Util.isNotEmpty(t.bridgeId)&&t.bridgeId===r._props.bridgeId)switch(r._logger.debug("--\x3e On message: "+t.id+" bridgeId: "+t.bridgeId),t.id){case InteractionMessageId.IamReady:r._handleReady||(r._logger.debug("Page ready for bridge: "+r._props.bridgeId),r._handleReady=!0,r._props.lifeCycleListener(InteractionBridgePhase.PageReady),r.sendMessage(InteractionMessageBuilder.PleaseInit(r._props.settings)));break;case InteractionMessageId.IamInitialized:r._logger.debug("Bridge initialized: "+r._props.bridgeId),r._handleReady=!1,r._props.lifeCycleListener(InteractionBridgePhase.PageInitialized);break;case InteractionMessageId.PleaseCloseMe:r._props.lifeCycleListener(InteractionBridgePhase.BeforeClose),document.getElementsByTagName("body")[0].removeChild(r._props.frame);break;default:Util.isNotNull(r._props.consumer)&&r._props.consumer(t,r)}}catch(e){}},Util.checkNotNull(e),Util.checkNotNull(e.bridgeId),Util.checkNotNull(e.frame),Util.checkNotNull(e.consumer),Util.checkNotNull(e.lifeCycleListener),this._props=e,this._logger=Logger$1.Of(this.constructor.toString().match(/\w+/g)[1]+"-"+e.bridgeId),WebUtil.addEventListener(window,"message",this.handleMessage)}gt=InteractionBridgePhase=InteractionBridgePhase||{},gt[gt.PageReady=0]="PageReady",gt[gt.PageInitialized=1]="PageInitialized",gt[gt.BeforeClose=2]="BeforeClose",ht=BridgeStatus=BridgeStatus||{},ht[ht.NotReady=0]="NotReady",ht[ht.Initialized=1]="Initialized";var InteractionMaster=(it.create=function(t){var n=this;Util.checkNotNull(t),this.hasBridge(t.bridgeId)&&(this._logger.warn("Already has Bridge with id: "+t.bridgeId+" Closing it!!"),this.close(t.bridgeId)),this._logger.debug("Create bridge with id: "+t.bridgeId);var e={frame:t.frame,bridge:new InteractionBridgeImpl(Object.assign({},t,{lifeCycleListener:function(e){it.updateBridgeStatus(t.bridgeId,e),Util.isNotNull(t.lifeCycleListener)&&t.lifeCycleListener(e),e===InteractionBridgePhase.BeforeClose&&n.close(t.bridgeId)}})),status:BridgeStatus.NotReady,consumer:t.consumer};this._bridges.set(t.bridgeId,e)},it.close=function(e){var t=this._bridges.get(e);Util.isNotNull(t)&&(this._logger.debug("Closing bridge with id: "+e),t.bridge.close(),WebUtil.removeFrame(t.frame),this._bridges.delete(e))},it.sendMessage=function(e,t){e=this._bridges.get(e);Util.isNotNull(e)&&e.bridge.sendMessage(t)},it.sendToAll=function(n,r){var i=this;void 0===r&&(r=0),this._bridges.forEach(function(e,t){it.bridgeStatus(t)===BridgeStatus.Initialized?e.bridge.sendMessage(n):r<10&&(i._logger.warn("Bridge is not ready, try to resend message in 10 ms for bridge "+t+", cid "+n.id),setTimeout(function(){return it.sendToAll(n,r+1)},100))})},it._logger=Logger$1.Of("InteractionMaster"),it._bridges=new typescriptMap_1,it.updateBridgeStatus=function(e,t){e=it._bridges.get(e);Util.isNotNull(e)&&t===InteractionBridgePhase.PageInitialized&&(e.status=BridgeStatus.Initialized)},it.hasBridge=function(e){return it._bridges.has(e)},it.bridgeStatus=function(e){e=it._bridges.get(e);return Util.isNotNull(e)?e.status:null},it);function it(){}var Gamification=(Dt.start=function(e){return this._instance||(this._instance=new this(e))},Dt.clear=function(){this._instance=void 0},Dt),ProductType,yu;function Dt(e){var c=this;this._logger=Logger$1.Of("Gamification"),this._messageQueue=new typescriptMap_1,this.executeDp=function(e){if(Util.isNotNull(e)&&Util.isNotNull(e.action))switch(c._logger.debug("Execute dp: "+e.action),e.action){case DpType.GfMain:case DpType.Activity:case DpType.Missions:case DpType.Badges:case DpType.LeaderBoard:case DpType.Tournaments:case DpType.LeaderBoardPrev:case DpType.LeaderBoardRules:case DpType.Bonuses:case DpType.Levels:case DpType.Saw:case DpType.Store:case DpType.Settings:case DpType.Section:if(e.action===DpType.Saw&&"true"===e.params.standalone)return c._tracker.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.SAW_STARTING),void c.openSaw(e.params.id);var t,n=InteractionBridgeType.GamificationMain,r=InteractionMessageBuilder.ExecuteDp(e);InteractionMaster.hasBridge(n)?InteractionMaster.sendMessage(n,r):(c._logger.debug("Bridge: "+n+" Not ready. Queuing message and create frame."),t=c._messageQueue.get(n),Util.isNull(t)&&c._messageQueue.set(n,t=[]),t.push(r),r=Cache.get(CacheKey.UserInfo).core_is_test_account&&c._props.settingsTest?c._props.settingsTest:c._props.settings,c.createFrame(c._props,r,n),c._tracker.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.GF_STARTING));break;case DpType.GfClose:n=InteractionBridgeType.GamificationMain;InteractionMaster.hasBridge(n)&&InteractionMaster.close(n)}else c._logger.warn("Can't execute DP without DpType.")},this.openSaw=function(e){c.createFrame(c._props,c._props.settings,InteractionBridgeType.MiniGame,{saw_template_id:e})},this.onIdentifyResponse=function(e){c._logger.debug("Handle identify response"),0===e.errCode&&c.handlePublicProps({userId:e.user_id,extUserId:e.ext_user_id,public_username:e.public_username,avatar_id:e.avatar_id},e.props)},this.onPublicPropertiesChanged=function(e){0===e.errCode&&Util.isNotNull(e.props)&&c.handlePublicProps(Cache.get(CacheKey.UserInfo),e.props)},this.handleAvatarChange=function(e){0===e.errCode&&c.handlePublicProps(Cache.get(CacheKey.UserInfo),{avatar_id:e.avatar_id})},this.onEngagement=function(e){var t;e.activityType===CJMActivityType.Inbox&&(c._tracker.reportEngagmentImpression({engagement_uid:e.engagement_uid,activityType:e.activityType}),c.dispatchProtocolEvent(e),InteractionMaster.hasBridge(InteractionBridgeType.GamificationWidget)||(t=c._messageQueue.get(InteractionBridgeType.GamificationWidget),Util.isNull(t)&&c._messageQueue.set(InteractionBridgeType.GamificationWidget,t=[]),t.push(InteractionMessageBuilder.ProtocolEvent(e)),c._logger.debug("Loading UI widget ..."),e=Cache.get(CacheKey.UserInfo).core_is_test_account&&c._props.settingsTest?c._props.settingsTest:c._props.settings,c.createFrame(c._props,e,InteractionBridgeType.GamificationWidget)))},this.handlePublicProps=function(e,t){Util.checkNotNull(e),Cache.set(CacheKey.UserInfo,Object.assign({},e,t)),c.pushUserInfo(),Util.isNotNull(e.core_user_language)&&Util.isNotNull(t.core_user_language)&&e.core_user_language!==t.core_user_language&&c._tracker.sendRow(ClassId.GET_LEVEL_MAP_REQUEST,!0)},this.pushUserInfo=function(){InteractionMaster.sendToAll(InteractionMessageBuilder.SetUserInfo(Cache.get(CacheKey.UserInfo)))},this.onGetLevelMap=function(e){c._logger.debug("Received levels configuration. Levels size: "+e.levels.length),Cache.set(CacheKey.Levels,e.levels),InteractionMaster.sendToAll(InteractionMessageBuilder.SetLevels(e.levels))},this.dispatchProtocolResponse=function(e){c._logger.debug("dispatchProtocolResponse: "+e.cid),InteractionMaster.sendToAll(InteractionMessageBuilder.ProtocolResponse(e))},this.dispatchProtocolEvent=function(e){InteractionMaster.sendToAll(InteractionMessageBuilder.ProtocolEvent(e))},this.createFrame=function(i,o,s,e){Cache.has(CacheKey.Levels)||c._tracker.sendRow(ClassId.GET_LEVEL_MAP_REQUEST,!0);e=c.url(i,s,e);Util.checkNotNull(e);e=WebUtil.addGetParam(e,"bridgeId",s);WebUtil.urlParam(WebUtil.forceMobileParam)&&(e=WebUtil.addGetParam(e,WebUtil.forceMobileParam,WebUtil.urlParam(WebUtil.forceMobileParam))),null!=o&&o.sidebarMode&&(e=WebUtil.addGetParam(e,WebUtil.forceMobileParam,"true"));var t=0;switch(s){case InteractionBridgeType.GamificationMain:t=Z_INDEX.GAMIFICATION_MAIN;break;case InteractionBridgeType.GamificationWidget:t=Z_INDEX.GAMIFICATION_INBOX;break;default:t=Z_INDEX.OTHER}var a=WebUtil.createFrame(e,t);InteractionMaster.create({bridgeId:s,frame:a,consumer:function(e){switch(e.id){case InteractionMessageId.SetMyStyle:var t=e;Object.keys(t.style).forEach(function(e){a.style[e]=t.style[e]});var n=window.getComputedStyle(window.document.body).zoom;n&&parseFloat(n)&&(a.style.zoom=(1/parseFloat(n)).toString()),s===InteractionBridgeType.GamificationMain&&null!=o&&o.sidebarMode&&(window.document.body.style.width="calc(100% - 360px)");break;case InteractionMessageId.CreateFrame:n=e;Util.checkNotNull(n.bridgeType),c.createFrame(i,o,n.bridgeType);break;case InteractionMessageId.ProtocolRequest:var r=e;Util.checkNotNull(r.request),c._tracker.sendRow(r.request.cid,r.identified,r.request);break;case InteractionMessageId.VerifyDp:r=e;c._logger.debug("Ask execute dp: ",r),c._tracker.executeManualDP(r.dp,r.engagementUid,r.activityType)}},lifeCycleListener:c.lifeCycleListener(s),settings:o})},this.url=function(e,t,n){Util.checkNotNull(t);var r,i=Cache.get(CacheKey.UserInfo).core_is_test_account;switch(t){case InteractionBridgeType.GamificationWidget:r=i&&e.widgetUrlTest?e.widgetUrlTest:e.widgetUrl;break;case InteractionBridgeType.GamificationMain:r=i&&e.mainUrlTest?e.mainUrlTest:e.mainUrl;break;case InteractionBridgeType.MiniGame:r=e.miniGameUrl}return WebUtil.addGetParams(r,n)},this.lifeCycleListener=function(r){return function(e){switch(e){case InteractionBridgePhase.PageInitialized:InteractionMaster.sendMessage(r,InteractionMessageBuilder.SetConnectionStatus(c._tracker.connectionStatus)),Cache.has(CacheKey.UserInfo)&&InteractionMaster.sendMessage(r,InteractionMessageBuilder.SetUserInfo(Cache.get(CacheKey.UserInfo))),Cache.has(CacheKey.Levels)&&InteractionMaster.sendMessage(r,InteractionMessageBuilder.SetLevels(Cache.get(CacheKey.Levels)));var t=c._messageQueue.get(r);c._messageQueue.delete(r);var n=Util.isArrayNotEmpty(t);c._logger.debug("Life circle: bridge "+r+" initialized. Has queued messages: "+n),n&&t.forEach(function(e){InteractionMaster.sendMessage(r,e)});break;case InteractionBridgePhase.BeforeClose:c._tracker.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.GF_CLOSING)}}},Util.checkNotNull(e),this._props=e,this._tracker=e.tracker,Util.checkNotNull(this._tracker),Util.isNotEmpty(e.widgetUrl)?(this._logger.debug("Start Gamification module."),this._tracker.registerHandler(ClassId.IDENTIFY_RESPONSE,this.onIdentifyResponse),this._tracker.registerHandler(ClassId.CLIENT_PUBLIC_PROPERTIES_CHANGED_EVENT,this.onPublicPropertiesChanged),this._tracker.registerHandler(ClassId.CLIENT_SET_AVATAR_RESPONSE,this.handleAvatarChange),this._tracker.registerHandler(ClassId.CLIENT_ENGAGEMENT_EVENT_NEW,this.onEngagement),this._tracker.registerHandler(ClassId.GET_LEVEL_MAP_RESPONSE,this.onGetLevelMap),this._tracker.registerHandler(ClassId.GET_TRANSLATIONS_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_ACHIEVEMENT_MAP_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.RELOAD_ACHIEVEMENTS_EVENT,this.dispatchProtocolEvent),this._tracker.registerHandler(ClassId.GET_LEADERS_BOARD_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_ACTIVITY_LOG_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_INBOX_MESSAGES_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_BONUSES_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.CLAIM_BONUS_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_SHOP_ITEMS_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.BUY_SHOP_ITEM_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_SHOP_CATEGORIES_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_TOURNAMENT_LOBBY_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_TOURNAMENT_INFO_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.TOURNAMENT_REGISTER_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.GET_CUSTOM_SECTIONS_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.CLIENT_SET_AVATAR_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.SAW_GET_SPINS_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.SAW_DO_SPIN_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.SAW_AKNOWLEDGE_RESPONSE,this.dispatchProtocolResponse),this._tracker.registerHandler(ClassId.SAW_SPINS_COUNT_PUSH,this.dispatchProtocolEvent),this._tracker.registerHandler(ClassId.MISSION_OPTIN_RESPONSE,this.dispatchProtocolResponse)):this._logger.warn("Trying to init Gamification module with empty UI script url")}yu=ProductType=ProductType||{},yu[yu.GAMIFICATION=100]="GAMIFICATION";var js_cookie=createCommonjsModule(function(e,t){var n;n=function(){function a(){for(var e=0,t={};e<arguments.length;e++){var n,r=arguments[e];for(n in r)t[n]=r[n]}return t}function u(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(c){function s(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=a({path:"/"},s.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var r=JSON.stringify(t);/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=c.write?c.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var i,o="";for(i in n)n[i]&&(o+="; "+i,!0!==n[i]&&(o+="="+n[i].split(";")[0]));return document.cookie=e+"="+t+o}}function t(e,t){if("undefined"!=typeof document){for(var n={},r=document.cookie?document.cookie.split("; "):[],i=0;i<r.length;i++){var o=r[i].split("="),s=o.slice(1).join("=");t||'"'!==s.charAt(0)||(s=s.slice(1,-1));try{var a=u(o[0]),s=(c.read||c)(s,a)||u(s);if(t)try{s=JSON.parse(s)}catch(e){}if(n[a]=s,e===a)break}catch(e){}}return e?n[e]:n}}return s.set=n,s.get=function(e){return t(e,!1)},s.getJSON=function(e){return t(e,!0)},s.remove=function(e,t){n(e,"",a(t,{expires:-1}))},s.defaults={},s.withConverter=e,s}(function(){})},e.exports=n()}),ClientActivityRequestId,kv;kv=ClientActivityRequestId=ClientActivityRequestId||{},kv[kv.MINI_WIDGET_SHOWN=1]="MINI_WIDGET_SHOWN",kv[kv.MINI_WIDGET_HIDDEN=2]="MINI_WIDGET_HIDDEN",kv[kv.MINI_WIDGET_CLICKED=3]="MINI_WIDGET_CLICKED",kv[kv.INBOX_MESSAGE_SHOWN=4]="INBOX_MESSAGE_SHOWN",kv[kv.INBOX_MESSAGE_HIDDEN=5]="INBOX_MESSAGE_HIDDEN",kv[kv.INBOX_CLICKED=6]="INBOX_CLICKED",kv[kv.BIG_WIDGET_SHOWN=7]="BIG_WIDGET_SHOWN",kv[kv.BIG_WIDGET_HIDDEN=8]="BIG_WIDGET_HIDDEN",kv[kv.MISSIONS_SHOWN=9]="MISSIONS_SHOWN",kv[kv.BOARD_SHOWN=10]="BOARD_SHOWN",kv[kv.LEVELS_SHOWN=11]="LEVELS_SHOWN",kv[kv.BONUSES_SHOWN=12]="BONUSES_SHOWN",kv[kv.STORE_SHOWN=13]="STORE_SHOWN",kv[kv.ACTIVITY_LOG_SHOWN=14]="ACTIVITY_LOG_SHOWN",kv[kv.LOGOUT=20]="LOGOUT",kv[kv.LOGIN=21]="LOGIN",kv[kv.ENGAGEMENT_FAILED=30]="ENGAGEMENT_FAILED",kv[kv.ENGAGEMENT_ACTION=31]="ENGAGEMENT_ACTION",kv[kv.ENGAGEMENT_IMPRESSION=32]="ENGAGEMENT_IMPRESSION",kv[kv.MISSIONS_CLICK=201]="MISSIONS_CLICK";var PostMessage=(lv.prototype.destroy=function(){this._handler&&(this._logger.debug("Destroy"),window.removeEventListener("message",this._handler),this._handler=null)},lv.prototype.send=function(e){if(Util.isNotNull(this._w)){e.bridgeId=this._id;var t=JSON.stringify(e);try{e.id!==InteractionMessageId.RecordScreen&&this._logger.debug("<-- Send message: "+e.id),this._w.postMessage(t,"*")}catch(e){this._logger.debug("Error send post message: "+t+" Error: "+JSON.stringify(e))}}},lv);function lv(n,e,r){var i=this;Util.checkNotNull(n),this._id=n,this._w=e,this._logger=Logger$1.Of(this.constructor.toString().match(/\w+/g)[1]+"-"+n),WebUtil.addEventListener(window,"message",this._handler=function(e){if(Util.isNotNull(r)){var t;try{t=JSON.parse(e.data),Util.isNotNull(t.id)&&Util.isNotEmpty(t.bridgeId)&&t.bridgeId===n&&(i._logger.debug("--\x3e On message: "+e.data),r(t))}catch(e){}}})}var REMOTE_INTEGRATION_ID="Smartico",Integration=(wv.start=function(e){return this._instance||(this._instance=new this(e))},wv.clear=function(){this._instance=void 0},wv.prototype.send=function(e){Util.isNotNull(this._connection)&&this._connection.send(e)},wv),ConnectionStatus,Dv;function wv(e){var t=this;this._logger=Logger$1.Of(this.constructor.toString().match(/\w+/g)[1]),Util.checkNotNull(e),this._tracker=e,this._connection=new PostMessage(REMOTE_INTEGRATION_ID,window,function(e){e.id===InteractionMessageId.VerifyDp&&(e=e,t._logger.debug("Verify execute dp: ",e),t._tracker.executeManualDP(e.dp,e.engagementUid,e.activityType))}),this._logger.info("Started")}Dv=ConnectionStatus=ConnectionStatus||{},Dv[Dv.OPEN=0]="OPEN",Dv[Dv.CLOSED=1]="CLOSED";var DummyStorage=(Ev.instance=function(){return this._instance||(this._instance=new this)},Ev.prototype.supported=function(){return!1},Ev.prototype.setItem=function(e,t){},Ev.prototype.getItem=function(e){return null},Ev.prototype.removeItem=function(e){},Ev.prototype.key=function(e){return null},Ev.prototype.clear=function(){},Ev.prototype.length=function(){return 0},Ev),LSKey,Kv;function Ev(){}Kv=LSKey=LSKey||{},Kv.LangCode="lang",Kv.AcceptCookie="cookie",Kv.Translations="tr",Kv.TrHash="tr_hash";var LStorage=function(){try{if(window.localStorage)return{supported:function(){return!0},setItem:function(e,t){try{window.localStorage.setItem(e,t)}catch(e){}},getItem:function(e){return window.localStorage.getItem(e)},removeItem:function(e){window.localStorage.removeItem(e)},key:function(e){return window.localStorage.key(e)},clear:function(){window.localStorage.clear()},length:function(){return window.localStorage.length}}}catch(e){}return DummyStorage.instance()},extendStatics$3=function(e,t){return(extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends$3(e,t){function n(){this.constructor=e}extendStatics$3(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign$3=function(){return(__assign$3=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Severity,sw;function __values$1(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$2(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}sw=Severity=Severity||{},sw.Fatal="fatal",sw.Error="error",sw.Warning="warning",sw.Log="log",sw.Info="info",sw.Debug="debug",sw.Critical="critical";var __assign$4=function(){return(__assign$4=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __read$3(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function __spread$2(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read$3(arguments[t]));return e}function forget(e){e.then(null,function(e){console.error(e)})}function isDebugBuild(){return"undefined"!=typeof __SENTRY_NO_DEBUG__&&!__SENTRY_BROWSER_BUNDLE__}function isBrowserBundle(){return"undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&__SENTRY_BROWSER_BUNDLE__}function isNodeEnv(){return!isBrowserBundle()&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function dynamicRequire(e,t){return e.require(t)}var fallbackGlobalObject={};function getGlobalObject(){return isNodeEnv()?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:fallbackGlobalObject}var objectToString=Object.prototype.toString;function isError(e){switch(objectToString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return 1;default:return isInstanceOf(e,Error)}}function isBuiltin(e,t){return objectToString.call(e)==="[object "+t+"]"}function isErrorEvent(e){return isBuiltin(e,"ErrorEvent")}function isDOMError(e){return isBuiltin(e,"DOMError")}function isDOMException(e){return isBuiltin(e,"DOMException")}function isString(e){return isBuiltin(e,"String")}function isPrimitive(e){return null===e||"object"!=typeof e&&"function"!=typeof e}function isPlainObject(e){return isBuiltin(e,"Object")}function isEvent(e){return"undefined"!=typeof Event&&isInstanceOf(e,Event)}function isElement(e){return"undefined"!=typeof Element&&isInstanceOf(e,Element)}function isThenable(e){return Boolean(e&&e.then&&"function"==typeof e.then)}function isSyntheticEvent(e){return isPlainObject(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function isInstanceOf(e,t){try{return e instanceof t}catch(e){return!1}}function htmlTreeAsString(e,t){try{for(var n,r=e,i=[],o=0,s=0,a=" > ".length;r&&o++<5&&!("html"===(n=_htmlElementAsString(r,t))||1<o&&80<=s+i.length*a+n.length);)i.push(n),s+=n.length,r=r.parentNode;return i.reverse().join(" > ")}catch(e){return"<unknown>"}}function _htmlElementAsString(e,t){var n,r,i,o=e,s=[];if(!o||!o.tagName)return"";s.push(o.tagName.toLowerCase());var t=t&&t.length?t.filter(function(e){return o.getAttribute(e)}).map(function(e){return[e,o.getAttribute(e)]}):null;if(t&&t.length)t.forEach(function(e){s.push("["+e[0]+'="'+e[1]+'"]')});else if(o.id&&s.push("#"+o.id),(t=o.className)&&isString(t))for(n=t.split(/\s+/),c=0;c<n.length;c++)s.push("."+n[c]);for(var a=["type","name","title","alt"],c=0;c<a.length;c++)r=a[c],(i=o.getAttribute(r))&&s.push("["+r+'="'+i+'"]');return s.join("")}var extendStatics$4=function(e,t){return(extendStatics$4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends$4(e,t){function n(){this.constructor=e}extendStatics$4(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign$5=function(){return(__assign$5=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __values$2(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$4(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}var setPrototypeOf=Object.setPrototypeOf||({__proto__:[]}instanceof Array?setProtoOf:mixinProperties);function setProtoOf(e,t){return e.__proto__=t,e}function mixinProperties(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n]);return e}var SentryError=(gy=Error,__extends$4(hy,gy),hy),gy;function hy(e){var t=this.constructor,n=gy.call(this,e)||this;return n.message=e,n.name=t.prototype.constructor.name,setPrototypeOf(n,t.prototype),n}var DSN_REGEX=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function isValidProtocol(e){return"http"===e||"https"===e}function dsnToString(e,t){void 0===t&&(t=!1);var n=e.host,r=e.path,i=e.pass,o=e.port,s=e.projectId;return e.protocol+"://"+e.publicKey+(t&&i?":"+i:"")+"@"+n+(o?":"+o:"")+"/"+(r&&r+"/")+s}function dsnFromString(e){var t=DSN_REGEX.exec(e);if(!t)throw new SentryError("Invalid Sentry Dsn: "+e);var n=__read$4(t.slice(1),6),r=n[0],i=n[1],o=n[2],s=void 0===o?"":o,a=n[3],e=n[4],t=void 0===e?"":e,o="",e=n[5],n=e.split("/");return 1<n.length&&(o=n.slice(0,-1).join("/"),e=n.pop()),!e||(n=e.match(/^\d+/))&&(e=n[0]),dsnFromComponents({host:a,pass:s,path:o,projectId:e,port:t,protocol:r,publicKey:i})}function dsnFromComponents(e){return"user"in e&&!("publicKey"in e)&&(e.publicKey=e.user),{user:e.publicKey||"",protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function validateDsn(t){if(isDebugBuild()){var e=t.port,n=t.projectId,r=t.protocol;if(["protocol","publicKey","host","projectId"].forEach(function(e){if(!t[e])throw new SentryError("Invalid Sentry Dsn: "+e+" missing")}),!n.match(/^\d+$/))throw new SentryError("Invalid Sentry Dsn: Invalid projectId "+n);if(!isValidProtocol(r))throw new SentryError("Invalid Sentry Dsn: Invalid protocol "+r);if(e&&isNaN(parseInt(e,10)))throw new SentryError("Invalid Sentry Dsn: Invalid port "+e);return 1}}function makeDsn(e){e=("string"==typeof e?dsnFromString:dsnFromComponents)(e);return validateDsn(e),e}var SeverityLevels=["fatal","error","warning","log","info","debug","critical"],global$1=getGlobalObject(),PREFIX="Sentry Logger ";function consoleSandbox(e){var t=getGlobalObject();if(!("console"in t))return e();var n=t.console,r={};["debug","info","warn","error","log","assert"].forEach(function(e){e in t.console&&n[e].__sentry_original__&&(r[e]=n[e],n[e]=n[e].__sentry_original__)});e=e();return Object.keys(r).forEach(function(e){n[e]=r[e]}),e}var Logger$2=(_y.prototype.disable=function(){this._enabled=!1},_y.prototype.enable=function(){this._enabled=!0},_y.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&consoleSandbox(function(){global$1.console.log(PREFIX+"[Log]: "+e.join(" "))})},_y.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&consoleSandbox(function(){global$1.console.warn(PREFIX+"[Warn]: "+e.join(" "))})},_y.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&consoleSandbox(function(){global$1.console.error(PREFIX+"[Error]: "+e.join(" "))})},_y);function _y(){this._enabled=!1}global$1.__SENTRY__=global$1.__SENTRY__||{};var logger$1=global$1.__SENTRY__.logger||(global$1.__SENTRY__.logger=new Logger$2);function memoBuilder(){var n="function"==typeof WeakSet,r=n?new WeakSet:[];return[function(e){if(n)return!!r.has(e)||(r.add(e),!1);for(var t=0;t<r.length;t++)if(r[t]===e)return!0;return r.push(e),!1},function(e){if(n)r.delete(e);else for(var t=0;t<r.length;t++)if(r[t]===e){r.splice(t,1);break}}]}var STACKTRACE_LIMIT=50;function createStackParser(){for(var p=[],e=0;e<arguments.length;e++)p[e]=arguments[e];return function(e,t){var n,r,i,o;void 0===t&&(t=0);var s=[];try{for(var a=__values$2(e.split("\n").slice(t)),c=a.next();!c.done;c=a.next()){var u=c.value;try{for(var l=(i=void 0,__values$2(p)),d=l.next();!d.done;d=l.next()){var _=(0,d.value)(u);if(_){s.push(_);break}}}catch(e){i={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return stripSentryFramesAndReverse(s)}}function stripSentryFramesAndReverse(e){if(!e.length)return[];var t=e,n=t[0].function||"",e=t[t.length-1].function||"";return-1===n.indexOf("captureMessage")&&-1===n.indexOf("captureException")||(t=t.slice(1)),(t=-1!==e.indexOf("sentryWrapped")?t.slice(0,-1):t).slice(0,STACKTRACE_LIMIT).map(function(e){return __assign$5(__assign$5({},e),{filename:e.filename||t[0].filename,function:e.function||"?"})}).reverse()}var defaultFunctionName="<anonymous>";function getFunctionName(e){try{return e&&"function"==typeof e?e.name||defaultFunctionName:defaultFunctionName}catch(e){return defaultFunctionName}}function truncate(e,t){return void 0===t&&(t=0),"string"!=typeof e||0===t||e.length<=t?e:e.substr(0,t)+"..."}function safeJoin(e,t){if(!Array.isArray(e))return"";for(var n=[],r=0;r<e.length;r++){var i=e[r];try{n.push(String(i))}catch(e){n.push("[value cannot be serialized]")}}return n.join(t)}function fill(e,t,n){if(t in e){var r=e[t],i=n(r);if("function"==typeof i)try{markFunctionWrapped(i,r)}catch(e){}e[t]=i}}function addNonEnumerableProperty(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}function markFunctionWrapped(e,t){var n=t.prototype||{};e.prototype=t.prototype=n,addNonEnumerableProperty(e,"__sentry_original__",t)}function urlEncode(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function getWalkSource(e){if(isError(e)){var t,n=e,r={message:n.message,name:n.name,stack:n.stack};for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t]);return r}if(isEvent(e)){var i,o=e,s={};s.type=o.type;try{s.target=isElement(o.target)?htmlTreeAsString(o.target):Object.prototype.toString.call(o.target)}catch(e){s.target="<unknown>"}try{s.currentTarget=isElement(o.currentTarget)?htmlTreeAsString(o.currentTarget):Object.prototype.toString.call(o.currentTarget)}catch(e){s.currentTarget="<unknown>"}for(i in"undefined"!=typeof CustomEvent&&isInstanceOf(e,CustomEvent)&&(s.detail=o.detail),o)Object.prototype.hasOwnProperty.call(o,i)&&(s[i]=o[i]);return s}return e}function utf8Length(e){return~-encodeURI(e).split(/%..|./).length}function jsonSize(e){return utf8Length(JSON.stringify(e))}function normalizeToSize(e,t,n){void 0===n&&(n=102400);var r=normalize(e,t=void 0===t?3:t);return jsonSize(r)>n?normalizeToSize(e,t-1,n):r}function serializeValue(e){if("string"==typeof e)return e;var t=Object.prototype.toString.call(e);if("[object Object]"===t)return"[Object]";if("[object Array]"===t)return"[Array]";e=normalizeValue(e);return isPrimitive(e)?e:t}function normalizeValue(e,t){return"domain"===t&&e&&"object"==typeof e&&e._events?"[Domain]":"domainEmitter"===t?"[DomainEmitter]":"undefined"!=typeof global&&e===global?"[Global]":"undefined"!=typeof window&&e===window?"[Window]":"undefined"!=typeof document&&e===document?"[Document]":isSyntheticEvent(e)?"[SyntheticEvent]":"number"==typeof e&&e!=e?"[NaN]":void 0===e?"[undefined]":"function"==typeof e?"[Function: "+getFunctionName(e)+"]":"symbol"==typeof e?"["+String(e)+"]":"bigint"==typeof e?"[BigInt: "+String(e)+"]":e}function walk(e,t,n,r){if(void 0===n&&(n=1/0),void 0===r&&(r=memoBuilder()),0===n)return serializeValue(t);if(null!=t&&"function"==typeof t.toJSON)return t.toJSON();e=normalizeValue(t,e);if(isPrimitive(e))return e;var i,o=getWalkSource(t),s=Array.isArray(t)?[]:{};if(r[0](t))return"[Circular ~]";for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(s[i]=walk(i,o[i],n-1,r));return r[1](t),s}function normalize(e,n){try{return JSON.parse(JSON.stringify(e,function(e,t){return walk(e,t,n)}))}catch(e){return"**non-serializable**"}}function extractExceptionKeysForMessage(e,t){void 0===t&&(t=40);var n=Object.keys(getWalkSource(e));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=t)return truncate(n[0],t);for(var r=n.length;0<r;r--){var i=n.slice(0,r).join(", ");if(!(i.length>t))return r===n.length?i:truncate(i,t)}return""}function dropUndefinedKeys(e){var t,n;if(isPlainObject(e)){var r=e,i={};try{for(var o=__values$2(Object.keys(r)),s=o.next();!s.done;s=o.next()){var a=s.value;void 0!==r[a]&&(i[a]=dropUndefinedKeys(r[a]))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}return Array.isArray(e)?e.map(dropUndefinedKeys):e}function supportsFetch(){if("fetch"in getGlobalObject())try{return new Headers,new Request(""),new Response,1}catch(e){return}}function isNativeFetch(e){return e&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function supportsNativeFetch(){if(supportsFetch()){var e=getGlobalObject();if(isNativeFetch(e.fetch))return 1;var t=!1,n=e.document;if(n&&"function"==typeof n.createElement)try{var r=n.createElement("iframe");r.hidden=!0,n.head.appendChild(r),r.contentWindow&&r.contentWindow.fetch&&(t=isNativeFetch(r.contentWindow.fetch)),n.head.removeChild(r)}catch(e){isDebugBuild()&&logger$1.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return t}}function supportsReferrerPolicy(){if(supportsFetch())try{return new Request("_",{referrerPolicy:"origin"}),1}catch(e){return}}function supportsHistory(){var e=getGlobalObject(),t=e.chrome,t=t&&t.app&&t.app.runtime,e="history"in e&&!!e.history.pushState&&!!e.history.replaceState;return!t&&e}var global$2=getGlobalObject(),handlers={},instrumented={},lastHref;function instrument(e){if(!instrumented[e])switch(instrumented[e]=!0,e){case"console":instrumentConsole();break;case"dom":instrumentDOM();break;case"xhr":instrumentXHR();break;case"fetch":instrumentFetch();break;case"history":instrumentHistory();break;case"error":instrumentError();break;case"unhandledrejection":instrumentUnhandledRejection();break;default:logger$1.warn("unknown instrumentation type:",e)}}function addInstrumentationHandler(e,t){handlers[e]=handlers[e]||[],handlers[e].push(t),instrument(e)}function triggerHandlers(t,e){var n,r;if(t&&handlers[t])try{for(var i=__values$2(handlers[t]||[]),o=i.next();!o.done;o=i.next()){var s=o.value;try{s(e)}catch(e){isDebugBuild()&&logger$1.error("Error while triggering instrumentation handler.\nType: "+t+"\nName: "+getFunctionName(s)+"\nError: "+e)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}function instrumentConsole(){"console"in global$2&&["debug","info","warn","error","log","assert"].forEach(function(r){r in global$2.console&&fill(global$2.console,r,function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];triggerHandlers("console",{args:e,level:r}),n&&n.apply(global$2.console,e)}})})}function instrumentFetch(){supportsNativeFetch()&&fill(global$2,"fetch",function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={args:e,fetchData:{method:getFetchMethod(e),url:getFetchUrl(e)},startTimestamp:Date.now()};return triggerHandlers("fetch",__assign$5({},n)),r.apply(global$2,e).then(function(e){return triggerHandlers("fetch",__assign$5(__assign$5({},n),{endTimestamp:Date.now(),response:e})),e},function(e){throw triggerHandlers("fetch",__assign$5(__assign$5({},n),{endTimestamp:Date.now(),error:e})),e})}})}function getFetchMethod(e){return void 0===e&&(e=[]),"Request"in global$2&&isInstanceOf(e[0],Request)&&e[0].method?String(e[0].method).toUpperCase():e[1]&&e[1].method?String(e[1].method).toUpperCase():"GET"}function getFetchUrl(e){return"string"==typeof(e=void 0===e?[]:e)[0]?e[0]:"Request"in global$2&&isInstanceOf(e[0],Request)?e[0].url:String(e[0])}function instrumentXHR(){var e;"XMLHttpRequest"in global$2&&(fill(e=XMLHttpRequest.prototype,"open",function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this,n=e[1],i=r.__sentry_xhr__={method:isString(e[0])?e[0].toUpperCase():e[0],url:e[1]};isString(n)&&"POST"===i.method&&n.match(/sentry_key/)&&(r.__sentry_own_request__=!0);function o(){if(4===r.readyState){try{i.status_code=r.status}catch(e){}triggerHandlers("xhr",{args:e,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:r})}}return"onreadystatechange"in r&&"function"==typeof r.onreadystatechange?fill(r,"onreadystatechange",function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o(),n.apply(r,e)}}):r.addEventListener("readystatechange",o),s.apply(r,e)}}),fill(e,"send",function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.__sentry_xhr__&&void 0!==e[0]&&(this.__sentry_xhr__.body=e[0]),triggerHandlers("xhr",{args:e,startTimestamp:Date.now(),xhr:this}),n.apply(this,e)}}))}function instrumentHistory(){var r;function e(i){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r=2<e.length?e[2]:void 0;return r&&(n=lastHref,r=String(r),triggerHandlers("history",{from:n,to:lastHref=r})),i.apply(this,e)}}supportsHistory()&&(r=global$2.onpopstate,global$2.onpopstate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=global$2.location.href;if(triggerHandlers("history",{from:lastHref,to:lastHref=n}),r)try{return r.apply(this,e)}catch(e){}},fill(global$2.history,"pushState",e),fill(global$2.history,"replaceState",e))}var debounceDuration=1e3,debounceTimerID,lastCapturedEvent;function shouldShortcircuitPreviousDebounce(e,t){if(!e)return 1;if(e.type!==t.type)return 1;try{if(e.target!==t.target)return 1}catch(e){}}function shouldSkipDOMEvent(e){if("keypress"===e.type){try{var t=e.target;if(!t||!t.tagName)return 1;if("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)return}catch(e){}return 1}}function makeDOMEventHandler(n,r){return void 0===r&&(r=!1),function(e){var t;e&&lastCapturedEvent!==e&&(shouldSkipDOMEvent(e)||(t="keypress"===e.type?"input":e.type,void 0!==debounceTimerID&&!shouldShortcircuitPreviousDebounce(lastCapturedEvent,e)||(n({event:e,name:t,global:r}),lastCapturedEvent=e),clearTimeout(debounceTimerID),debounceTimerID=global$2.setTimeout(function(){debounceTimerID=void 0},debounceDuration)))}}function instrumentDOM(){var s,e;"document"in global$2&&(e=makeDOMEventHandler(s=triggerHandlers.bind(null,"dom"),!0),global$2.document.addEventListener("click",e,!1),global$2.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(function(e){e=global$2[e]&&global$2[e].prototype;e&&e.hasOwnProperty&&e.hasOwnProperty("addEventListener")&&(fill(e,"addEventListener",function(o){return function(e,t,n){if("click"===e||"keypress"==e)try{var r=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},i=r[e]=r[e]||{refCount:0};i.handler||(r=makeDOMEventHandler(s),i.handler=r,o.call(this,e,r,n)),i.refCount+=1}catch(e){}return o.call(this,e,t,n)}}),fill(e,"removeEventListener",function(o){return function(e,t,n){if("click"===e||"keypress"==e)try{var r=this.__sentry_instrumentation_handlers__||{},i=r[e];i&&(--i.refCount,i.refCount<=0&&(o.call(this,e,i.handler,n),i.handler=void 0,delete r[e]),0===Object.keys(r).length&&delete this.__sentry_instrumentation_handlers__)}catch(e){}return o.call(this,e,t,n)}}))}))}var _oldOnErrorHandler=null;function instrumentError(){_oldOnErrorHandler=global$2.onerror,global$2.onerror=function(e,t,n,r,i){return triggerHandlers("error",{column:r,error:i,line:n,msg:e,url:t}),!!_oldOnErrorHandler&&_oldOnErrorHandler.apply(this,arguments)}}var _oldOnUnhandledRejectionHandler=null;function instrumentUnhandledRejection(){_oldOnUnhandledRejectionHandler=global$2.onunhandledrejection,global$2.onunhandledrejection=function(e){return triggerHandlers("unhandledrejection",e),!_oldOnUnhandledRejectionHandler||_oldOnUnhandledRejectionHandler.apply(this,arguments)}}function uuid4(){var e=getGlobalObject(),t=e.crypto||e.msCrypto;if(void 0!==t&&t.getRandomValues){e=new Uint16Array(8);t.getRandomValues(e),e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;t=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return t(e[0])+t(e[1])+t(e[2])+t(e[3])+t(e[4])+t(e[5])+t(e[6])+t(e[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function parseUrl$1(e){if(!e)return{};var t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",e=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+e}}function getFirstException(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function getEventDescription(e){var t=e.message,n=e.event_id;if(t)return t;e=getFirstException(e);return e?e.type&&e.value?e.type+": "+e.value:e.type||e.value||n||"<unknown>":n||"<unknown>"}function addExceptionTypeValue(e,t,n){e=e.exception=e.exception||{},e=e.values=e.values||[],e=e[0]=e[0]||{};e.value||(e.value=t||""),e.type||(e.type=n||"Error")}function addExceptionMechanism(e,t){var n=getFirstException(e);n&&(e=n.mechanism,n.mechanism=__assign$5(__assign$5(__assign$5({},{type:"generic",handled:!0}),e),t),t&&"data"in t&&(t=__assign$5(__assign$5({},e&&e.data),t.data),n.mechanism.data=t))}var defaultRetryAfter=6e4;function parseRetryAfterHeader(e,t){if(!t)return defaultRetryAfter;var n=parseInt(""+t,10);if(!isNaN(n))return 1e3*n;t=Date.parse(""+t);return isNaN(t)?defaultRetryAfter:t-e}function checkOrSetAlreadyCaught(e){if(e&&e.__sentry_captured__)return 1;try{addNonEnumerableProperty(e,"__sentry_captured__",!0)}catch(e){}}function resolvedSyncPromise(t){return new SyncPromise(function(e){e(t)})}function rejectedSyncPromise(n){return new SyncPromise(function(e,t){t(n)})}var SyncPromise=(JD.prototype.then=function(r,i){var e=this;return new JD(function(t,n){e._handlers.push([!1,function(e){if(r)try{t(r(e))}catch(e){n(e)}else t(e)},function(e){if(i)try{t(i(e))}catch(e){n(e)}else n(e)}]),e._executeHandlers()})},JD.prototype.catch=function(e){return this.then(function(e){return e},e)},JD.prototype.finally=function(i){var o=this;return new JD(function(e,t){var n,r;return o.then(function(e){r=!1,n=e,i&&i()},function(e){r=!0,n=e,i&&i()}).then(function(){(r?t:e)(n)})})},JD);function JD(e){var n=this;this._state=0,this._handlers=[],this._resolve=function(e){n._setResult(1,e)},this._reject=function(e){n._setResult(2,e)},this._setResult=function(e,t){0===n._state&&(isThenable(t)?t.then(n._resolve,n._reject):(n._state=e,n._value=t,n._executeHandlers()))},this._executeHandlers=function(){var e;0!==n._state&&(e=n._handlers.slice(),n._handlers=[],e.forEach(function(e){e[0]||(1===n._state&&e[1](n._value),2===n._state&&e[2](n._value),e[0]=!0)}))};try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}function makePromiseBuffer(n){var o=[];function r(e){return o.splice(o.indexOf(e),1)[0]}return{$:o,add:function(e){if(!(void 0===n||o.length<n))return rejectedSyncPromise(new SentryError("Not adding Promise due to buffer limit reached."));var t=e();return-1===o.indexOf(t)&&o.push(t),t.then(function(){return r(t)}).then(null,function(){return r(t).then(null,function(){})}),t},drain:function(e){return new SyncPromise(function(t,n){var r=o.length;if(!r)return t(!0);var i=setTimeout(function(){e&&0<e&&t(!1)},e);o.forEach(function(e){resolvedSyncPromise(e).then(function(){--r||(clearTimeout(i),t(!0))},n)})})}}}function isSupportedSeverity(e){return-1!==SeverityLevels.indexOf(e)}function severityFromString(e){return"warn"===e?Severity.Warning:isSupportedSeverity(e)?e:Severity.Log}function eventStatusFromHttpCode(e){return 200<=e&&e<300?"success":429===e?"rate_limit":400<=e&&e<500?"invalid":500<=e?"failed":"unknown"}var dateTimestampSource={nowSeconds:function(){return Date.now()/1e3}};function getBrowserPerformance(){var e=getGlobalObject().performance;if(e&&e.now)return{now:function(){return e.now()},timeOrigin:Date.now()-e.now()}}function getNodePerformance(){try{return dynamicRequire(module,"perf_hooks").performance}catch(e){return}}var platformPerformance=(isNodeEnv()?getNodePerformance:getBrowserPerformance)(),timestampSource=void 0===platformPerformance?dateTimestampSource:{nowSeconds:function(){return(platformPerformance.timeOrigin+platformPerformance.now())/1e3}},dateTimestampInSeconds=dateTimestampSource.nowSeconds.bind(dateTimestampSource),timestampInSeconds=timestampSource.nowSeconds.bind(timestampSource),browserPerformanceTimeOrigin=function(){var e=getGlobalObject().performance;if(e&&e.now){var t=e.now(),n=Date.now(),r=e.timeOrigin?Math.abs(e.timeOrigin+t-n):36e5,i=r<36e5,o=e.timing&&e.timing.navigationStart,t="number"==typeof o?Math.abs(o+t-n):36e5;return i||t<36e5?r<=t?e.timeOrigin:o:n}}(),MAX_BREADCRUMBS=100,Scope=(QE.clone=function(e){var t=new QE;return e&&(t._breadcrumbs=__spread$2(e._breadcrumbs),t._tags=__assign$4({},e._tags),t._extra=__assign$4({},e._extra),t._contexts=__assign$4({},e._contexts),t._user=e._user,t._level=e._level,t._span=e._span,t._session=e._session,t._transactionName=e._transactionName,t._fingerprint=e._fingerprint,t._eventProcessors=__spread$2(e._eventProcessors),t._requestSession=e._requestSession),t},QE.prototype.addScopeListener=function(e){this._scopeListeners.push(e)},QE.prototype.addEventProcessor=function(e){return this._eventProcessors.push(e),this},QE.prototype.setUser=function(e){return this._user=e||{},this._session&&this._session.update({user:e}),this._notifyScopeListeners(),this},QE.prototype.getUser=function(){return this._user},QE.prototype.getRequestSession=function(){return this._requestSession},QE.prototype.setRequestSession=function(e){return this._requestSession=e,this},QE.prototype.setTags=function(e){return this._tags=__assign$4(__assign$4({},this._tags),e),this._notifyScopeListeners(),this},QE.prototype.setTag=function(e,t){var n;return this._tags=__assign$4(__assign$4({},this._tags),((n={})[e]=t,n)),this._notifyScopeListeners(),this},QE.prototype.setExtras=function(e){return this._extra=__assign$4(__assign$4({},this._extra),e),this._notifyScopeListeners(),this},QE.prototype.setExtra=function(e,t){var n;return this._extra=__assign$4(__assign$4({},this._extra),((n={})[e]=t,n)),this._notifyScopeListeners(),this},QE.prototype.setFingerprint=function(e){return this._fingerprint=e,this._notifyScopeListeners(),this},QE.prototype.setLevel=function(e){return this._level=e,this._notifyScopeListeners(),this},QE.prototype.setTransactionName=function(e){return this._transactionName=e,this._notifyScopeListeners(),this},QE.prototype.setTransaction=function(e){return this.setTransactionName(e)},QE.prototype.setContext=function(e,t){var n;return null===t?delete this._contexts[e]:this._contexts=__assign$4(__assign$4({},this._contexts),((n={})[e]=t,n)),this._notifyScopeListeners(),this},QE.prototype.setSpan=function(e){return this._span=e,this._notifyScopeListeners(),this},QE.prototype.getSpan=function(){return this._span},QE.prototype.getTransaction=function(){var e=this.getSpan();return e&&e.transaction},QE.prototype.setSession=function(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this},QE.prototype.getSession=function(){return this._session},QE.prototype.update=function(e){if(!e)return this;if("function"!=typeof e)return e instanceof QE?(this._tags=__assign$4(__assign$4({},this._tags),e._tags),this._extra=__assign$4(__assign$4({},this._extra),e._extra),this._contexts=__assign$4(__assign$4({},this._contexts),e._contexts),e._user&&Object.keys(e._user).length&&(this._user=e._user),e._level&&(this._level=e._level),e._fingerprint&&(this._fingerprint=e._fingerprint),e._requestSession&&(this._requestSession=e._requestSession)):isPlainObject(e)&&(this._tags=__assign$4(__assign$4({},this._tags),e.tags),this._extra=__assign$4(__assign$4({},this._extra),e.extra),this._contexts=__assign$4(__assign$4({},this._contexts),e.contexts),e.user&&(this._user=e.user),e.level&&(this._level=e.level),e.fingerprint&&(this._fingerprint=e.fingerprint),e.requestSession&&(this._requestSession=e.requestSession)),this;e=e(this);return e instanceof QE?e:this},QE.prototype.clear=function(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this},QE.prototype.addBreadcrumb=function(e,t){t="number"==typeof t?Math.min(t,MAX_BREADCRUMBS):MAX_BREADCRUMBS;if(t<=0)return this;e=__assign$4({timestamp:dateTimestampInSeconds()},e);return this._breadcrumbs=__spread$2(this._breadcrumbs,[e]).slice(-t),this._notifyScopeListeners(),this},QE.prototype.clearBreadcrumbs=function(){return this._breadcrumbs=[],this._notifyScopeListeners(),this},QE.prototype.applyToEvent=function(e,t){var n;return this._extra&&Object.keys(this._extra).length&&(e.extra=__assign$4(__assign$4({},this._extra),e.extra)),this._tags&&Object.keys(this._tags).length&&(e.tags=__assign$4(__assign$4({},this._tags),e.tags)),this._user&&Object.keys(this._user).length&&(e.user=__assign$4(__assign$4({},this._user),e.user)),this._contexts&&Object.keys(this._contexts).length&&(e.contexts=__assign$4(__assign$4({},this._contexts),e.contexts)),this._level&&(e.level=this._level),this._transactionName&&(e.transaction=this._transactionName),this._span&&(e.contexts=__assign$4({trace:this._span.getTraceContext()},e.contexts),(n=this._span.transaction&&this._span.transaction.name)&&(e.tags=__assign$4({transaction:n},e.tags))),this._applyFingerprint(e),e.breadcrumbs=__spread$2(e.breadcrumbs||[],this._breadcrumbs),e.breadcrumbs=0<e.breadcrumbs.length?e.breadcrumbs:void 0,e.sdkProcessingMetadata=this._sdkProcessingMetadata,this._notifyEventProcessors(__spread$2(getGlobalEventProcessors(),this._eventProcessors),e,t)},QE.prototype.setSDKProcessingMetadata=function(e){return this._sdkProcessingMetadata=__assign$4(__assign$4({},this._sdkProcessingMetadata),e),this},QE.prototype._notifyEventProcessors=function(r,i,o,s){var a=this;return void 0===s&&(s=0),new SyncPromise(function(t,e){var n=r[s];null===i||"function"!=typeof n?t(i):(isThenable(n=n(__assign$4({},i),o))?n.then(function(e){return a._notifyEventProcessors(r,e,o,s+1).then(t)}):a._notifyEventProcessors(r,n,o,s+1).then(t)).then(null,e)})},QE.prototype._notifyScopeListeners=function(){var t=this;this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(function(e){e(t)}),this._notifyingListeners=!1)},QE.prototype._applyFingerprint=function(e){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],this._fingerprint&&(e.fingerprint=e.fingerprint.concat(this._fingerprint)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint},QE);function QE(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={}}function getGlobalEventProcessors(){var e=getGlobalObject();return e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.globalEventProcessors=e.__SENTRY__.globalEventProcessors||[],e.__SENTRY__.globalEventProcessors}function addGlobalEventProcessor(e){getGlobalEventProcessors().push(e)}var Session=(MF.prototype.update=function(e){var t;(e=void 0===e?{}:e).user&&(!this.ipAddress&&e.user.ip_address&&(this.ipAddress=e.user.ip_address),this.did||e.did||(this.did=e.user.id||e.user.email||e.user.username)),this.timestamp=e.timestamp||timestampInSeconds(),e.ignoreDuration&&(this.ignoreDuration=e.ignoreDuration),e.sid&&(this.sid=32===e.sid.length?e.sid:uuid4()),void 0!==e.init&&(this.init=e.init),!this.did&&e.did&&(this.did=""+e.did),"number"==typeof e.started&&(this.started=e.started),this.ignoreDuration?this.duration=void 0:"number"==typeof e.duration?this.duration=e.duration:(t=this.timestamp-this.started,this.duration=0<=t?t:0),e.release&&(this.release=e.release),e.environment&&(this.environment=e.environment),!this.ipAddress&&e.ipAddress&&(this.ipAddress=e.ipAddress),!this.userAgent&&e.userAgent&&(this.userAgent=e.userAgent),"number"==typeof e.errors&&(this.errors=e.errors),e.status&&(this.status=e.status)},MF.prototype.close=function(e){e?this.update({status:e}):"ok"===this.status?this.update({status:"exited"}):this.update()},MF.prototype.toJSON=function(){return dropUndefinedKeys({sid:""+this.sid,init:this.init,started:new Date(1e3*this.started).toISOString(),timestamp:new Date(1e3*this.timestamp).toISOString(),status:this.status,errors:this.errors,did:"number"==typeof this.did||"string"==typeof this.did?""+this.did:void 0,duration:this.duration,attrs:{release:this.release,environment:this.environment,ip_address:this.ipAddress,user_agent:this.userAgent}})},MF);function MF(e){this.errors=0,this.sid=uuid4(),this.duration=0,this.status="ok",this.init=!0,this.ignoreDuration=!1;var t=timestampInSeconds();this.timestamp=t,this.started=t,e&&this.update(e)}var API_VERSION=4,DEFAULT_BREADCRUMBS=100,Hub=(SF.prototype.isOlderThan=function(e){return this._version<e},SF.prototype.bindClient=function(e){(this.getStackTop().client=e)&&e.setupIntegrations&&e.setupIntegrations()},SF.prototype.pushScope=function(){var e=Scope.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:e}),e},SF.prototype.popScope=function(){return!(this.getStack().length<=1)&&!!this.getStack().pop()},SF.prototype.withScope=function(e){var t=this.pushScope();try{e(t)}finally{this.popScope()}},SF.prototype.getClient=function(){return this.getStackTop().client},SF.prototype.getScope=function(){return this.getStackTop().scope},SF.prototype.getStack=function(){return this._stack},SF.prototype.getStackTop=function(){return this._stack[this._stack.length-1]},SF.prototype.captureException=function(e,t){var n=this._lastEventId=uuid4(),r=t;if(!t){t=void 0;try{throw new Error("Sentry syntheticException")}catch(e){t=e}r={originalException:e,syntheticException:t}}return this._invokeClient("captureException",e,__assign$4(__assign$4({},r),{event_id:n})),n},SF.prototype.captureMessage=function(e,t,n){var r=this._lastEventId=uuid4(),i=n;if(!n){n=void 0;try{throw new Error(e)}catch(e){n=e}i={originalException:e,syntheticException:n}}return this._invokeClient("captureMessage",e,t,__assign$4(__assign$4({},i),{event_id:r})),r},SF.prototype.captureEvent=function(e,t){var n=uuid4();return"transaction"!==e.type&&(this._lastEventId=n),this._invokeClient("captureEvent",e,__assign$4(__assign$4({},t),{event_id:n})),n},SF.prototype.lastEventId=function(){return this._lastEventId},SF.prototype.addBreadcrumb=function(e,t){var n,r,i=this.getStackTop(),o=i.scope,s=i.client;o&&s&&(i=s.getOptions&&s.getOptions()||{},n=void 0===(s=i.beforeBreadcrumb)?null:s,(i=void 0===(s=i.maxBreadcrumbs)?DEFAULT_BREADCRUMBS:s)<=0||(s=dateTimestampInSeconds(),r=__assign$4({timestamp:s},e),null!==(e=n?consoleSandbox(function(){return n(r,t)}):r)&&o.addBreadcrumb(e,i)))},SF.prototype.setUser=function(e){var t=this.getScope();t&&t.setUser(e)},SF.prototype.setTags=function(e){var t=this.getScope();t&&t.setTags(e)},SF.prototype.setExtras=function(e){var t=this.getScope();t&&t.setExtras(e)},SF.prototype.setTag=function(e,t){var n=this.getScope();n&&n.setTag(e,t)},SF.prototype.setExtra=function(e,t){var n=this.getScope();n&&n.setExtra(e,t)},SF.prototype.setContext=function(e,t){var n=this.getScope();n&&n.setContext(e,t)},SF.prototype.configureScope=function(e){var t=this.getStackTop(),n=t.scope,t=t.client;n&&t&&e(n)},SF.prototype.run=function(e){var t=makeMain(this);try{e(this)}finally{makeMain(t)}},SF.prototype.getIntegration=function(t){var e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch(e){return logger$1.warn("Cannot retrieve integration "+t.id+" from the current Hub"),null}},SF.prototype.startSpan=function(e){return this._callExtensionMethod("startSpan",e)},SF.prototype.startTransaction=function(e,t){return this._callExtensionMethod("startTransaction",e,t)},SF.prototype.traceHeaders=function(){return this._callExtensionMethod("traceHeaders")},SF.prototype.captureSession=function(e){if(e=void 0===e?!1:e)return this.endSession();this._sendSessionUpdate()},SF.prototype.endSession=function(){var e=this.getStackTop(),t=e&&e.scope,e=t&&t.getSession();e&&e.close(),this._sendSessionUpdate(),t&&t.setSession()},SF.prototype.startSession=function(e){var t=this.getStackTop(),n=t.scope,r=t.client,i=r&&r.getOptions()||{},t=i.release,r=i.environment,i=(getGlobalObject().navigator||{}).userAgent,i=new Session(__assign$4(__assign$4(__assign$4({release:t,environment:r},n&&{user:n.getUser()}),i&&{userAgent:i}),e));return n&&((e=n.getSession&&n.getSession())&&"ok"===e.status&&e.update({status:"exited"}),this.endSession(),n.setSession(i)),i},SF.prototype._sendSessionUpdate=function(){var e=this.getStackTop(),t=e.scope,e=e.client;!t||(t=t.getSession&&t.getSession())&&e&&e.captureSession&&e.captureSession(t)},SF.prototype._invokeClient=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.getStackTop(),i=r.scope,r=r.client;r&&r[e]&&r[e].apply(r,__spread$2(t,[i]))},SF.prototype._callExtensionMethod=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=getMainCarrier().__SENTRY__;if(r&&r.extensions&&"function"==typeof r.extensions[e])return r.extensions[e].apply(this,t);logger$1.warn("Extension method "+e+" couldn't be found, doing nothing.")},SF);function SF(e,t,n){void 0===t&&(t=new Scope),void 0===n&&(n=API_VERSION),this._version=n,this._stack=[{}],this.getStackTop().scope=t,e&&this.bindClient(e)}function getMainCarrier(){var e=getGlobalObject();return e.__SENTRY__=e.__SENTRY__||{extensions:{},hub:void 0},e}function makeMain(e){var t=getMainCarrier(),n=getHubFromCarrier(t);return setHubOnCarrier(t,e),n}function getCurrentHub(){var e=getMainCarrier();return hasHubOnCarrier(e)&&!getHubFromCarrier(e).isOlderThan(API_VERSION)||setHubOnCarrier(e,new Hub),(isNodeEnv()?getHubFromActiveDomain:getHubFromCarrier)(e)}function getHubFromActiveDomain(t){try{var e=getMainCarrier().__SENTRY__,n=e&&e.extensions&&e.extensions.domain&&e.extensions.domain.active;return n?(hasHubOnCarrier(n)&&!getHubFromCarrier(n).isOlderThan(API_VERSION)||(e=getHubFromCarrier(t).getStackTop(),setHubOnCarrier(n,new Hub(e.client,Scope.clone(e.scope)))),getHubFromCarrier(n)):getHubFromCarrier(t)}catch(e){return getHubFromCarrier(t)}}function hasHubOnCarrier(e){return e&&e.__SENTRY__&&e.__SENTRY__.hub}function getHubFromCarrier(e){return e&&e.__SENTRY__&&e.__SENTRY__.hub||(e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.hub=new Hub),e.__SENTRY__.hub}function setHubOnCarrier(e,t){return e&&(e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.hub=t,1)}var SENTRY_API_VERSION="7";function initAPIDetails(e,t,n){return{initDsn:e,metadata:t||{},dsn:makeDsn(e),tunnel:n}}function getBaseApiEndpoint(e){var t=e.protocol?e.protocol+":":"",n=e.port?":"+e.port:"";return t+"//"+e.host+n+(e.path?"/"+e.path:"")+"/api/"}function _getIngestEndpoint(e,t){return""+getBaseApiEndpoint(e)+e.projectId+"/"+t+"/"}function _encodedAuth(e){return urlEncode({sentry_key:e.publicKey,sentry_version:SENTRY_API_VERSION})}function getStoreEndpoint(e){return _getIngestEndpoint(e,"store")}function getStoreEndpointWithUrlEncodedAuth(e){return getStoreEndpoint(e)+"?"+_encodedAuth(e)}function _getEnvelopeEndpoint(e){return _getIngestEndpoint(e,"envelope")}function getEnvelopeEndpointWithUrlEncodedAuth(e,t){return t||_getEnvelopeEndpoint(e)+"?"+_encodedAuth(e)}function getReportDialogEndpoint(e,t){var n,r=makeDsn(e),e=getBaseApiEndpoint(r)+"embed/error-page/",i="dsn="+dsnToString(r);for(n in t)"dsn"!==n&&("user"===n?t.user&&(t.user.name&&(i+="&name="+encodeURIComponent(t.user.name)),t.user.email&&(i+="&email="+encodeURIComponent(t.user.email))):i+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e+"?"+i}var __assign$6=function(){return(__assign$6=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __values$3(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$5(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function __spread$3(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read$5(arguments[t]));return e}var installedIntegrations=[];function filterDuplicates(e){return e.reduce(function(e,t){return e.every(function(e){return t.name!==e.name})&&e.push(t),e},[])}function getIntegrationsToSetup(e){var t=e.defaultIntegrations&&__spread$3(e.defaultIntegrations)||[],n=e.integrations,e=__spread$3(filterDuplicates(t));Array.isArray(n)?e=__spread$3(e.filter(function(t){return n.every(function(e){return e.name!==t.name})}),filterDuplicates(n)):"function"==typeof n&&(e=n(e),e=Array.isArray(e)?e:[e]);t=e.map(function(e){return e.name});return-1!==t.indexOf("Debug")&&e.push.apply(e,__spread$3(e.splice(t.indexOf("Debug"),1))),e}function setupIntegration(e){-1===installedIntegrations.indexOf(e.name)&&(e.setupOnce(addGlobalEventProcessor,getCurrentHub),installedIntegrations.push(e.name),logger$1.log("Integration installed: "+e.name))}function setupIntegrations(e){var t={};return getIntegrationsToSetup(e).forEach(function(e){setupIntegration(t[e.name]=e)}),addNonEnumerableProperty(t,"initialized",!0),t}var ALREADY_SEEN_ERROR="Not capturing exception because it's already been captured.",BaseClient=(XI.prototype.captureException=function(e,t,n){var r=this;if(!checkOrSetAlreadyCaught(e)){var i=t&&t.event_id;return this._process(this._getBackend().eventFromException(e,t).then(function(e){return r._captureEvent(e,t,n)}).then(function(e){i=e})),i}logger$1.log(ALREADY_SEEN_ERROR)},XI.prototype.captureMessage=function(e,t,n,r){var i=this,o=n&&n.event_id,e=isPrimitive(e)?this._getBackend().eventFromMessage(String(e),t,n):this._getBackend().eventFromException(e,n);return this._process(e.then(function(e){return i._captureEvent(e,n,r)}).then(function(e){o=e})),o},XI.prototype.captureEvent=function(e,t,n){if(!(t&&t.originalException&&checkOrSetAlreadyCaught(t.originalException))){var r=t&&t.event_id;return this._process(this._captureEvent(e,t,n).then(function(e){r=e})),r}logger$1.log(ALREADY_SEEN_ERROR)},XI.prototype.captureSession=function(e){this._isEnabled()?"string"!=typeof e.release?isDebugBuild()&&logger$1.warn("Discarded session because of missing or non-string release"):(this._sendSession(e),e.update({init:!1})):isDebugBuild()&&logger$1.warn("SDK not enabled, will not capture session.")},XI.prototype.getDsn=function(){return this._dsn},XI.prototype.getOptions=function(){return this._options},XI.prototype.getTransport=function(){return this._getBackend().getTransport()},XI.prototype.flush=function(e){var n=this;return this._isClientDoneProcessing(e).then(function(t){return n.getTransport().close(e).then(function(e){return t&&e})})},XI.prototype.close=function(e){var t=this;return this.flush(e).then(function(e){return t.getOptions().enabled=!1,e})},XI.prototype.setupIntegrations=function(){this._isEnabled()&&!this._integrations.initialized&&(this._integrations=setupIntegrations(this._options))},XI.prototype.getIntegration=function(t){try{return this._integrations[t.id]||null}catch(e){return logger$1.warn("Cannot retrieve integration "+t.id+" from the current Client"),null}},XI.prototype._updateSessionFromEvent=function(e,t){var n,r,i=!1,o=!1,s=t.exception&&t.exception.values;if(s){o=!0;try{for(var a=__values$3(s),c=a.next();!c.done;c=a.next()){var u=c.value.mechanism;if(u&&!1===u.handled){i=!0;break}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}t="ok"===e.status;(t&&0===e.errors||t&&i)&&(e.update(__assign$6(__assign$6({},i&&{status:"crashed"}),{errors:e.errors||Number(o||i)})),this.captureSession(e))},XI.prototype._sendSession=function(e){this._getBackend().sendSession(e)},XI.prototype._isClientDoneProcessing=function(r){var i=this;return new SyncPromise(function(e){var t=0,n=setInterval(function(){0==i._numProcessing?(clearInterval(n),e(!0)):(t+=1,r&&r<=t&&(clearInterval(n),e(!1)))},1)})},XI.prototype._getBackend=function(){return this._backend},XI.prototype._isEnabled=function(){return!1!==this.getOptions().enabled&&void 0!==this._dsn},XI.prototype._prepareEvent=function(e,t,n){var r=this,i=this.getOptions().normalizeDepth,o=void 0===i?3:i,i=__assign$6(__assign$6({},e),{event_id:e.event_id||(n&&n.event_id?n.event_id:uuid4()),timestamp:e.timestamp||dateTimestampInSeconds()});this._applyClientOptions(i),this._applyIntegrationsMetadata(i);e=t;n&&n.captureContext&&(e=Scope.clone(e).update(n.captureContext));t=resolvedSyncPromise(i);return(t=e?e.applyToEvent(i,n):t).then(function(e){return e&&(e.sdkProcessingMetadata=__assign$6(__assign$6({},e.sdkProcessingMetadata),{normalizeDepth:normalize(o)})),"number"==typeof o&&0<o?r._normalizeEvent(e,o):e})},XI.prototype._normalizeEvent=function(e,t){if(!e)return null;var n=__assign$6(__assign$6(__assign$6(__assign$6(__assign$6({},e),e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(function(e){return __assign$6(__assign$6({},e),e.data&&{data:normalize(e.data,t)})})}),e.user&&{user:normalize(e.user,t)}),e.contexts&&{contexts:normalize(e.contexts,t)}),e.extra&&{extra:normalize(e.extra,t)});return e.contexts&&e.contexts.trace&&(n.contexts.trace=e.contexts.trace),e.sdkProcessingMetadata=__assign$6(__assign$6({},e.sdkProcessingMetadata),{baseClientNormalized:!0}),n},XI.prototype._applyClientOptions=function(e){var t=this.getOptions(),n=t.environment,r=t.release,i=t.dist,o=t.maxValueLength,o=void 0===o?250:o;"environment"in e||(e.environment="environment"in t?n:"production"),void 0===e.release&&void 0!==r&&(e.release=r),void 0===e.dist&&void 0!==i&&(e.dist=i),e.message&&(e.message=truncate(e.message,o));i=e.exception&&e.exception.values&&e.exception.values[0];i&&i.value&&(i.value=truncate(i.value,o));e=e.request;e&&e.url&&(e.url=truncate(e.url,o))},XI.prototype._applyIntegrationsMetadata=function(e){var t=Object.keys(this._integrations);0<t.length&&(e.sdk=e.sdk||{},e.sdk.integrations=__spread$3(e.sdk.integrations||[],t))},XI.prototype._sendEvent=function(e){this._getBackend().sendEvent(e)},XI.prototype._captureEvent=function(e,t,n){return this._processEvent(e,t,n).then(function(e){return e.event_id},function(e){logger$1.error(e)})},XI.prototype._processEvent=function(n,t,r){var i=this,e=this.getOptions(),o=e.beforeSend,e=e.sampleRate,s=this.getTransport();function a(e,t){s.recordLostEvent&&s.recordLostEvent(e,t)}if(!this._isEnabled())return rejectedSyncPromise(new SentryError("SDK not enabled, will not capture event."));var c="transaction"===n.type;return!c&&"number"==typeof e&&Math.random()>e?(a("sample_rate","event"),rejectedSyncPromise(new SentryError("Discarding event because it's not included in the random sample (sampling rate = "+e+")"))):this._prepareEvent(n,r,t).then(function(e){if(null===e)throw a("event_processor",n.type||"event"),new SentryError("An event processor returned null, will not send event.");return t&&t.data&&!0===t.data.__sentry__||c||!o?e:_ensureBeforeSendRv(o(e,t))}).then(function(e){if(null===e)throw a("before_send",n.type||"event"),new SentryError("`beforeSend` returned `null`, will not send event.");var t=r&&r.getSession&&r.getSession();return!c&&t&&i._updateSessionFromEvent(t,e),i._sendEvent(e),e}).then(null,function(e){if(e instanceof SentryError)throw e;throw i.captureException(e,{data:{__sentry__:!0},originalException:e}),new SentryError("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+e)})},XI.prototype._process=function(e){var t=this;this._numProcessing+=1,e.then(function(e){return--t._numProcessing,e},function(e){return--t._numProcessing,e})},XI);function XI(e,t){this._integrations={},this._numProcessing=0,this._backend=new e(t),(this._options=t).dsn&&(this._dsn=makeDsn(t.dsn))}function _ensureBeforeSendRv(e){var t="`beforeSend` method has to return `null` or a valid event.";if(isThenable(e))return e.then(function(e){if(!isPlainObject(e)&&null!==e)throw new SentryError(t);return e},function(e){throw new SentryError("beforeSend rejected with "+e)});if(!isPlainObject(e)&&null!==e)throw new SentryError(t);return e}var NoopTransport=(_K.prototype.sendEvent=function(e){return resolvedSyncPromise({reason:"NoopTransport: Event has been skipped because no Dsn is configured.",status:"skipped"})},_K.prototype.close=function(e){return resolvedSyncPromise(!0)},_K);function _K(){}var BaseBackend=(cL.prototype.eventFromException=function(e,t){throw new SentryError("Backend has to implement `eventFromException` method")},cL.prototype.eventFromMessage=function(e,t,n){throw new SentryError("Backend has to implement `eventFromMessage` method")},cL.prototype.sendEvent=function(e){this._transport.sendEvent(e).then(null,function(e){isDebugBuild()&&logger$1.error("Error while sending event: "+e)})},cL.prototype.sendSession=function(e){this._transport.sendSession?this._transport.sendSession(e).then(null,function(e){isDebugBuild()&&logger$1.error("Error while sending session: "+e)}):isDebugBuild()&&logger$1.warn("Dropping session because custom transport doesn't implement sendSession")},cL.prototype.getTransport=function(){return this._transport},cL.prototype._setupTransport=function(){return new NoopTransport},cL);function cL(e){this._options=e,this._options.dsn||logger$1.warn("No DSN provided, backend will not do anything."),this._transport=this._setupTransport()}function getSdkMetadataForEnvelopeHeader(e){if(e.metadata&&e.metadata.sdk){e=e.metadata.sdk;return{name:e.name,version:e.version}}}function enhanceEventWithSdkInfo(e,t){return t&&(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=__spread$3(e.sdk.integrations||[],t.integrations||[]),e.sdk.packages=__spread$3(e.sdk.packages||[],t.packages||[])),e}function sessionToSentryRequest(e,t){var n=getSdkMetadataForEnvelopeHeader(t),r=JSON.stringify(__assign$6(__assign$6({sent_at:(new Date).toISOString()},n&&{sdk:n}),!!t.tunnel&&{dsn:dsnToString(t.dsn)})),n="aggregates"in e?"sessions":"session";return{body:r+"\n"+JSON.stringify({type:n})+"\n"+JSON.stringify(e),type:n,url:getEnvelopeEndpointWithUrlEncodedAuth(t.dsn,t.tunnel)}}function eventToSentryRequest(t,e){var n=getSdkMetadataForEnvelopeHeader(e),r=t.type||"event",i="transaction"===r||!!e.tunnel,o=(t.sdkProcessingMetadata||{}).transactionSampling||{},s=o.method,a=o.rate;enhanceEventWithSdkInfo(t,e.metadata.sdk),t.tags=t.tags||{},t.extra=t.extra||{},t.sdkProcessingMetadata&&t.sdkProcessingMetadata.baseClientNormalized||(t.tags.skippedNormalization=!0,t.extra.normalizeDepth=t.sdkProcessingMetadata?t.sdkProcessingMetadata.normalizeDepth:"unset"),delete t.sdkProcessingMetadata;try{c=JSON.stringify(t)}catch(e){t.tags.JSONStringifyError=!0,t.extra.JSONStringifyError=e;try{c=JSON.stringify(normalize(t))}catch(e){var c=JSON.stringify({message:"JSON.stringify error after renormalization",extra:{message:e.message,stack:e.stack}})}}o={body:c,type:r,url:i?getEnvelopeEndpointWithUrlEncodedAuth(e.dsn,e.tunnel):getStoreEndpointWithUrlEncodedAuth(e.dsn)};return i&&(a=JSON.stringify(__assign$6(__assign$6({event_id:t.event_id,sent_at:(new Date).toISOString()},n&&{sdk:n}),!!e.tunnel&&{dsn:dsnToString(e.dsn)}))+"\n"+JSON.stringify({type:r,sample_rates:[{id:s,rate:a}]})+"\n"+o.body,o.body=a),o}var SDK_VERSION="6.17.9",UNKNOWN_FUNCTION="?";function createFrame(e,t,n,r){t={filename:e,function:t,in_app:!0};return void 0!==n&&(t.lineno=n),void 0!==r&&(t.colno=r),t}var chromeRegex=/^\s*at (?:(.*?) ?\((?:address at )?)?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,chromeEvalRegex=/\((\S*)(?::(\d+))(?::(\d+))\)/,chrome=function(e){var t=chromeRegex.exec(e);if(t){!(t[2]&&0===t[2].indexOf("eval"))||(n=chromeEvalRegex.exec(t[2]))&&(t[2]=n[1],t[3]=n[2],t[4]=n[3]);var e=__read$2(extractSafariExtensionDetails(t[1]||UNKNOWN_FUNCTION,t[2]),2),n=e[0];return createFrame(e[1],n,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}},geckoREgex=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|capacitor).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,geckoEvalRegex=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,gecko=function(e){var t=geckoREgex.exec(e);if(t){!(t[3]&&-1<t[3].indexOf(" > eval"))||(n=geckoEvalRegex.exec(t[3]))&&(t[1]=t[1]||"eval",t[3]=n[1],t[4]=n[2],t[5]="");var n,r=t[3],e=t[1]||UNKNOWN_FUNCTION,e=(n=__read$2(extractSafariExtensionDetails(e,r),2))[0];return createFrame(r=n[1],e,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},winjsRegex=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,winjs=function(e){e=winjsRegex.exec(e);return e?createFrame(e[2],e[1]||UNKNOWN_FUNCTION,+e[3],e[4]?+e[4]:void 0):void 0},opera10Regex=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,opera10=function(e){e=opera10Regex.exec(e);return e?createFrame(e[2],e[3]||UNKNOWN_FUNCTION,+e[1]):void 0},opera11Regex=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\(.*\))? in (.*):\s*$/i,opera11=function(e){e=opera11Regex.exec(e);return e?createFrame(e[5],e[3]||e[4]||UNKNOWN_FUNCTION,+e[1],+e[2]):void 0},extractSafariExtensionDetails=function(e,t){var n=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return n||r?[-1!==e.indexOf("@")?e.split("@")[0]:UNKNOWN_FUNCTION,n?"safari-extension:"+t:"safari-web-extension:"+t]:[e,t]};function exceptionFromError(e){var t=parseStackFrames(e),e={type:e&&e.name,value:extractMessage(e)};return t&&t.length&&(e.stacktrace={frames:t}),void 0===e.type&&""===e.value&&(e.value="Unrecoverable error caught"),e}function eventFromPlainObject(e,t,n){e={exception:{values:[{type:isEvent(e)?e.constructor.name:n?"UnhandledRejection":"Error",value:"Non-Error "+(n?"promise rejection":"exception")+" captured with keys: "+extractExceptionKeysForMessage(e)}]},extra:{__serialized__:normalizeToSize(e)}};return t&&(e.stacktrace={frames:parseStackFrames(t)}),e}function eventFromError(e){return{exception:{values:[exceptionFromError(e)]}}}function parseStackFrames(e){var t=e.stacktrace||e.stack||"",n=getPopSize(e);try{return createStackParser(opera10,opera11,chrome,winjs,gecko)(t,n)}catch(e){}return[]}var reactMinifiedRegexp=/Minified React error #\d+;/i;function getPopSize(e){if(e){if("number"==typeof e.framesToPop)return e.framesToPop;if(reactMinifiedRegexp.test(e.message))return 1}return 0}function extractMessage(e){e=e&&e.message;return e?e.error&&"string"==typeof e.error.message?e.error.message:e:"No error message"}function eventFromException(e,t,n){e=eventFromUnknownInput(t,n&&n.syntheticException||void 0,{attachStacktrace:e.attachStacktrace});return addExceptionMechanism(e),e.level=Severity.Error,n&&n.event_id&&(e.event_id=n.event_id),resolvedSyncPromise(e)}function eventFromMessage(e,t,n,r){void 0===n&&(n=Severity.Info);e=eventFromString(t,r&&r.syntheticException||void 0,{attachStacktrace:e.attachStacktrace});return e.level=n,r&&r.event_id&&(e.event_id=r.event_id),resolvedSyncPromise(e)}function eventFromUnknownInput(e,t,n){if(void 0===n&&(n={}),isErrorEvent(e)&&e.error)return eventFromError(e.error);if(isDOMError(e)||isDOMException(e)){var r,i,o=e;return"stack"in e?i=eventFromError(e):(r=o.name||(isDOMError(o)?"DOMError":"DOMException"),addExceptionTypeValue(i=eventFromString(r=o.message?r+": "+o.message:r,t,n),r)),"code"in o&&(i.tags=__assign$3(__assign$3({},i.tags),{"DOMException.code":""+o.code})),i}return isError(e)?eventFromError(e):(isPlainObject(e)||isEvent(e)?addExceptionMechanism(i=eventFromPlainObject(e,t,n.isRejection),{synthetic:!0}):(addExceptionTypeValue(i=eventFromString(e,t,n),""+e,void 0),addExceptionMechanism(i,{synthetic:!0})),i)}function eventFromString(e,t,n){e={message:e};return(n=void 0===n?{}:n).attachStacktrace&&t&&(e.stacktrace={frames:parseStackFrames(t)}),e}var global$3=getGlobalObject(),cachedFetchImpl;function getNativeFetchImplementation(){if(cachedFetchImpl)return cachedFetchImpl;if(isNativeFetch(global$3.fetch))return cachedFetchImpl=global$3.fetch.bind(global$3);var e=global$3.document,t=global$3.fetch;if(e&&"function"==typeof e.createElement)try{var n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n);var r=n.contentWindow;r&&r.fetch&&(t=r.fetch),e.head.removeChild(n)}catch(e){isDebugBuild()&&logger$1.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return cachedFetchImpl=t.bind(global$3)}function sendReport(e,t){return"[object Navigator]"===Object.prototype.toString.call(global$3&&global$3.navigator)&&"function"==typeof global$3.navigator.sendBeacon?global$3.navigator.sendBeacon.bind(global$3.navigator)(e,t):supportsFetch()&&forget(getNativeFetchImplementation()(e,{body:t,method:"POST",credentials:"omit",keepalive:!0}))}function requestTypeToCategory(e){return"event"===e?"error":e}var global$4=getGlobalObject(),BaseTransport=(pN.prototype.sendEvent=function(e){return this._sendRequest(eventToSentryRequest(e,this._api),e)},pN.prototype.sendSession=function(e){return this._sendRequest(sessionToSentryRequest(e,this._api),e)},pN.prototype.close=function(e){return this._buffer.drain(e)},pN.prototype.recordLostEvent=function(e,t){this.options.sendClientReports&&(e=requestTypeToCategory(t)+":"+e,logger$1.log("Adding outcome: "+e),this._outcomes[e]=(null!=(e=this._outcomes[e])?e:0)+1)},pN.prototype._flushOutcomes=function(){if(this.options.sendClientReports){var r=this._outcomes;if(this._outcomes={},Object.keys(r).length){logger$1.log("Flushing outcomes:\n"+JSON.stringify(r,null,2));var e=getEnvelopeEndpointWithUrlEncodedAuth(this._api.dsn,this._api.tunnel),t=JSON.stringify(__assign$3({},this._api.tunnel&&{dsn:dsnToString(this._api.dsn)}))+"\n"+JSON.stringify({type:"client_report"})+"\n"+JSON.stringify({timestamp:dateTimestampInSeconds(),discarded_events:Object.keys(r).map(function(e){var t=__read$2(e.split(":"),2),n=t[0];return{reason:t[1],category:n,quantity:r[e]}})});try{sendReport(e,t)}catch(e){logger$1.error(e)}}else logger$1.log("No outcomes to flush")}},pN.prototype._handleResponse=function(e){var t=e.requestType,n=e.response,r=e.headers,i=e.resolve,o=e.reject,e=eventStatusFromHttpCode(n.status);this._handleRateLimit(r)&&isDebugBuild()&&logger$1.warn("Too many "+t+" requests, backing off until: "+this._disabledUntil(t)),"success"!==e?o(n):i({status:e})},pN.prototype._disabledUntil=function(e){e=requestTypeToCategory(e);return this._rateLimits[e]||this._rateLimits.all},pN.prototype._isRateLimited=function(e){return this._disabledUntil(e)>new Date(Date.now())},pN.prototype._handleRateLimit=function(e){var t,n,r,i,o=Date.now(),s=e["x-sentry-rate-limits"],e=e["retry-after"];if(s){try{for(var a=__values$1(s.trim().split(",")),c=a.next();!c.done;c=a.next()){var u=c.value.split(":",2),l=parseInt(u[0],10),d=1e3*(isNaN(l)?60:l);try{for(var _=(r=void 0,__values$1(u[1].split(";"))),p=_.next();!p.done;p=_.next()){var h=p.value;this._rateLimits[h||"all"]=new Date(o+d)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=_.return)&&i.call(_)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!0}return!!e&&(this._rateLimits.all=new Date(o+parseRetryAfterHeader(o,e)),!0)},pN);function pN(e){var t=this;this.options=e,this._buffer=makePromiseBuffer(30),this._rateLimits={},this._outcomes={},this._api=initAPIDetails(e.dsn,e._metadata,e.tunnel),this.url=getStoreEndpointWithUrlEncodedAuth(this._api.dsn),this.options.sendClientReports&&global$4.document&&global$4.document.addEventListener("visibilitychange",function(){"hidden"===global$4.document.visibilityState&&t._flushOutcomes()})}var FetchTransport=(mO=BaseTransport,__extends$3(nO,mO),nO.prototype._sendRequest=function(i,e){var o=this;if(this._isRateLimited(i.type))return this.recordLostEvent("ratelimit_backoff",i.type),Promise.reject({event:e,type:i.type,reason:"Transport for "+i.type+" requests locked till "+this._disabledUntil(i.type)+" due to too many requests.",status:429});var t={body:i.body,method:"POST",referrerPolicy:supportsReferrerPolicy()?"origin":""};return void 0!==this.options.fetchParameters&&Object.assign(t,this.options.fetchParameters),void 0!==this.options.headers&&(t.headers=this.options.headers),this._buffer.add(function(){return new SyncPromise(function(n,r){o._fetch(i.url,t).then(function(e){var t={"x-sentry-rate-limits":e.headers.get("X-Sentry-Rate-Limits"),"retry-after":e.headers.get("Retry-After")};o._handleResponse({requestType:i.type,response:e,headers:t,resolve:n,reject:r})}).catch(r)})}).then(void 0,function(e){throw e instanceof SentryError?o.recordLostEvent("queue_overflow",i.type):o.recordLostEvent("network_error",i.type),e})},nO),mO;function nO(e,t){void 0===t&&(t=getNativeFetchImplementation());e=mO.call(this,e)||this;return e._fetch=t,e}var XHRTransport=(AO=BaseTransport,__extends$3(BO,AO),BO.prototype._sendRequest=function(i,e){var o=this;return this._isRateLimited(i.type)?(this.recordLostEvent("ratelimit_backoff",i.type),Promise.reject({event:e,type:i.type,reason:"Transport for "+i.type+" requests locked till "+this._disabledUntil(i.type)+" due to too many requests.",status:429})):this._buffer.add(function(){return new SyncPromise(function(t,n){var e,r=new XMLHttpRequest;for(e in r.onreadystatechange=function(){var e;4===r.readyState&&(e={"x-sentry-rate-limits":r.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":r.getResponseHeader("Retry-After")},o._handleResponse({requestType:i.type,response:r,headers:e,resolve:t,reject:n}))},r.open("POST",i.url),o.options.headers)Object.prototype.hasOwnProperty.call(o.options.headers,e)&&r.setRequestHeader(e,o.options.headers[e]);r.send(i.body)})}).then(void 0,function(e){throw e instanceof SentryError?o.recordLostEvent("queue_overflow",i.type):o.recordLostEvent("network_error",i.type),e})},BO),AO;function BO(){return null!==AO&&AO.apply(this,arguments)||this}var BrowserBackend=(LO=BaseBackend,__extends$3(MO,LO),MO.prototype.eventFromException=function(e,t){return eventFromException(this._options,e,t)},MO.prototype.eventFromMessage=function(e,t,n){return void 0===t&&(t=Severity.Info),eventFromMessage(this._options,e,t,n)},MO.prototype._setupTransport=function(){if(!this._options.dsn)return LO.prototype._setupTransport.call(this);var e=__assign$3(__assign$3({},this._options.transportOptions),{dsn:this._options.dsn,tunnel:this._options.tunnel,sendClientReports:this._options.sendClientReports,_metadata:this._options._metadata});return new(this._options.transport||(supportsFetch()?FetchTransport:XHRTransport))(e)},MO),LO;function MO(){return null!==LO&&LO.apply(this,arguments)||this}var global$5=getGlobalObject();function injectReportDialog(e){var t;void 0===e&&(e={}),global$5.document&&(e.eventId?e.dsn?((t=global$5.document.createElement("script")).async=!0,t.src=getReportDialogEndpoint(e.dsn,e),e.onLoad&&(t.onload=e.onLoad),(e=global$5.document.head||global$5.document.body)&&e.appendChild(t)):isDebugBuild()&&logger$1.error("Missing dsn option in showReportDialog call"):isDebugBuild()&&logger$1.error("Missing eventId option in showReportDialog call"))}var Breadcrumbs=(WO.prototype.addSentryBreadcrumb=function(e){this._options.sentry&&getCurrentHub().addBreadcrumb({category:"sentry."+("transaction"===e.type?"transaction":"event"),event_id:e.event_id,level:e.level,message:getEventDescription(e)},{event:e})},WO.prototype.setupOnce=function(){this._options.console&&addInstrumentationHandler("console",_consoleBreadcrumb),this._options.dom&&addInstrumentationHandler("dom",_domBreadcrumb(this._options.dom)),this._options.xhr&&addInstrumentationHandler("xhr",_xhrBreadcrumb),this._options.fetch&&addInstrumentationHandler("fetch",_fetchBreadcrumb),this._options.history&&addInstrumentationHandler("history",_historyBreadcrumb)},WO.id="Breadcrumbs",WO);function WO(e){this.name=WO.id,this._options=__assign$3({console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0},e)}function _domBreadcrumb(r){return function(e){var t,n="object"==typeof r?r.serializeAttribute:void 0;"string"==typeof n&&(n=[n]);try{t=e.event.target?htmlTreeAsString(e.event.target,n):htmlTreeAsString(e.event,n)}catch(e){t="<unknown>"}0!==t.length&&getCurrentHub().addBreadcrumb({category:"ui."+e.name,message:t},{event:e.event,name:e.name,global:e.global})}}function _consoleBreadcrumb(e){var t={category:"console",data:{arguments:e.args,logger:"console"},level:severityFromString(e.level),message:safeJoin(e.args," ")};if("assert"===e.level){if(!1!==e.args[0])return;t.message="Assertion failed: "+(safeJoin(e.args.slice(1)," ")||"console.assert"),t.data.arguments=e.args.slice(1)}getCurrentHub().addBreadcrumb(t,{input:e.args,level:e.level})}function _xhrBreadcrumb(e){var t,n,r,i;e.endTimestamp&&(e.xhr.__sentry_own_request__||(t=(i=e.xhr.__sentry_xhr__||{}).method,n=i.url,r=i.status_code,i=i.body,getCurrentHub().addBreadcrumb({category:"xhr",data:{method:t,url:n,status_code:r},type:"http"},{xhr:e.xhr,input:i})))}function _fetchBreadcrumb(e){e.endTimestamp&&(e.fetchData.url.match(/sentry_key/)&&"POST"===e.fetchData.method||(e.error?getCurrentHub().addBreadcrumb({category:"fetch",data:e.fetchData,level:Severity.Error,type:"http"},{data:e.error,input:e.args}):getCurrentHub().addBreadcrumb({category:"fetch",data:__assign$3(__assign$3({},e.fetchData),{status_code:e.response.status}),type:"http"},{input:e.args,response:e.response})))}function _historyBreadcrumb(e){var t=getGlobalObject(),n=e.from,r=e.to,i=parseUrl$1(t.location.href),e=parseUrl$1(n),t=parseUrl$1(r);e.path||(e=i),i.protocol===t.protocol&&i.host===t.host&&(r=t.relative),i.protocol===e.protocol&&i.host===e.host&&(n=e.relative),getCurrentHub().addBreadcrumb({category:"navigation",data:{from:n,to:r}})}var BrowserClient=(tP=BaseClient,__extends$3(uP,tP),uP.prototype.showReportDialog=function(e){void 0===e&&(e={}),getGlobalObject().document&&(this._isEnabled()?injectReportDialog(__assign$3(__assign$3({},e),{dsn:e.dsn||this.getDsn()})):logger$1.error("Trying to call showReportDialog with Sentry Client disabled"))},uP.prototype._prepareEvent=function(e,t,n){return e.platform=e.platform||"javascript",tP.prototype._prepareEvent.call(this,e,t,n)},uP.prototype._sendEvent=function(e){var t=this.getIntegration(Breadcrumbs);t&&t.addSentryBreadcrumb(e),tP.prototype._sendEvent.call(this,e)},uP),tP,DpType$1,EP;function uP(e){return(e=void 0===e?{}:e)._metadata=e._metadata||{},e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:"npm:@sentry/browser",version:SDK_VERSION}],version:SDK_VERSION},tP.call(this,BrowserBackend,e)||this}EP=DpType$1=DpType$1||{},EP.AskPushPermissions="ask_push_permissions",EP.Ok="ok",EP.Cancel="cancel",EP.Go="go",EP.GfMain="gf",EP.Activity="gf_activity",EP.Missions="gf_missions",EP.Badges="gf_badges",EP.LeaderBoard="gf_board",EP.Tournaments="gf_tournaments",EP.LeaderBoardPrev="gf_board_previous",EP.LeaderBoardRules="gf_board_rules",EP.Bonuses="gf_bonuses",EP.Levels="gf_levels",EP.Saw="gf_saw",EP.Store="gf_store",EP.Settings="gf_settings",EP.Section="gf_section",EP.GfClose="gf_close",EP.Submit="submit";var NO_MESSAGE_TIMER=29e3,C_SOCKET_PROD="wss://api.smartico.ai/websocket/services",DP_URL_IN_HASH="_smartico_dp",DP_SESSION_STORAGE_KEY="_smartico_dp",FCM_DEFAULT_SW_URL="/smartico-messaging-sw.js?version=1.1&public_api_key=",__lsDeviceIdKey="__smartico_device_id",LOGIN_SESSION_MS=18e5,wait=function(n){return new Promise(function(e,t){return setTimeout(e,n)})},SERVER_REQUEST_STATE,IP,EXTERNAL_CALLBACK_KEY,JP;IP=SERVER_REQUEST_STATE=SERVER_REQUEST_STATE||{},IP[IP.NOT_SENT=0]="NOT_SENT",IP[IP.SENT=1]="SENT",IP[IP.LABEL_IS_BLOCKED=2]="LABEL_IS_BLOCKED",JP=EXTERNAL_CALLBACK_KEY=EXTERNAL_CALLBACK_KEY||{},JP.INIT="init",JP.IDENTIFY="identify",JP.LOGIN="login",JP.LOGOUT="logout",JP.USER_PROPS_CHANGE="props_change",JP.SESSION_BASED_DP_DETECTED="session_based_dp_detected",JP.GF_CLOSING="gf_closing",JP.GF_STARTING="gf_starting",JP.SAW_STARTING="saw_starting";var TrackerParams={brand_key:null,debug:!1,server:C_SOCKET_PROD,simulation_mode:!1,gamification_wrapper_mode:!1},sentryClient=new BrowserClient({dsn:"https://1fbce2bb08464b11bded9708cfa299d4@o230566.ingest.sentry.io/6214573",release:"smartico@1.2.17"}),sentryHub=new Hub(sentryClient),Tracker=function(){function Tracker(e,t,n,r){var i=this;this.handlers=[],this.initStatus=SERVER_REQUEST_STATE.NOT_SENT,this.identifyStatus=SERVER_REQUEST_STATE.NOT_SENT,this._connectionStatus=ConnectionStatus.CLOSED,this.hadSuccessInit=!1,this.hadSuccessIdentify=!1,this.labelSettings={},this.ext_user_id=null,this.hash=null,this.identifyPayload={},this.label_api_key=null,this.queue=[],this.noMessageTimer=null,this.browserInfo=Detector.info(),this.queueInterval=null,this.identifyResponseTS=null,this.DELAY_ENGAGEMENT_EXECUTION_ON_LOGIN_MS=0,this.DELAY_ENGAGEMENT_EXECUTION_DURING_UNLOAD_MS=1e4,this.inPageUnloadPhase=!1,this.__lsDelayedLoginPayload="__smartico_delayed_login_payload",this.__lsLoginTracker="__smartico_login_tracker",this.loginIsSent=!1,this.userPublicProps={},this.bSuspendPopups=!1,this.executeGfDp=function(e){i.gamification&&i.gamification.executeDp(e)},this.executeNativeDp=function(e){throw new Error("executeNativeDp is not implemented for the web presentation")},this.promoMessageClosed=function(){},this.miniGame=function(e){i.gamification&&i.gamification.openSaw(e)},this.sendAnalytics=function(e,t,n,r){void 0===n&&(n=0),i.sendRow(ClassId.CLIENT_TRACK_ACTIVITY_REQUEST,!0,{activity_id:e,view_time_sec:n})},this.initShadowLabel=r,this.trackerInstanceType=n,this.__lsDelayedLoginPayload=this.__lsDelayedLoginPayload+n,this.__lsLoginTracker=this.__lsLoginTracker+n,this.deviceId=this.getDeviceId(),this.ws=new ReconnectingWebSocket(t.server+"?"+(n===TrackerInstanceType.Master?"master":"shadow")+"&domain="+window.location.hostname+"&version=1.2.17",[],{minReconnectionDelay:1,connectionTimeout:1e4}),this.params=t,window.addEventListener("beforeunload",function(){i.inPageUnloadPhase=!0}),Integration.start(this),this.queueInterval=setInterval(this.processQueue.bind(this),1),this.saveLocationBasedDP(),this.registerHandler(ClassId.INIT_RESPONSE,function(e){return i.initResponse(e)}),this.registerHandler(ClassId.IDENTIFY_RESPONSE,function(e){return i.identifyResponse(e)}),this.registerHandler(ClassId.CLIENT_ENGAGEMENT_EVENT_NEW,function(e){return i.engagementEventHandlerNew(e)}),this.registerHandler(ClassId.CLIENT_EXECUTE_DEEPLINK_EVENT,function(e){return i.serverTriggeredDPHandler(e)}),this.registerHandler(ClassId.CLIENT_EXECUTE_JS_EVENT,function(e){return i.executeJSCode(e)}),this.registerHandler(ClassId.CLIENT_PUBLIC_PROPERTIES_CHANGED_EVENT,function(e){return i.handlePublicPropsChange(e)}),this.registerHandler(ClassId.CLIENT_SET_AVATAR_RESPONSE,function(e){return i.handleAvatarChange(e)}),this.registerHandler(ClassId.LOGOUT_RESPONSE,function(e){return i.handleLogout(e)}),this.registerHandler(ClassId.LOGIN_RESPONSE,function(e){return i.handleLogin(e)}),this.registerHandler(ClassId.SAW_SHOW_SPIN_PUSH,function(e){return i.handleSawPushEvent(e)}),this.label_api_key=e,this.log("Init label "+e),this.init(this.label_api_key),this.ws.onclose=function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(e){return this.log("Connection lost. Has messages in the queue: ",this.queue.length),this.log("Queue content:",this.queue),this.log("Resetting queue.."),this.queue=[],this.hadSuccessIdentify=!1,this.noMessageTimer&&(this.log("Stopping proactive client initiated ping.."),clearTimeout(this.noMessageTimer)),this.hadSuccessInit=!1,this.initStatus!==SERVER_REQUEST_STATE.LABEL_IS_BLOCKED&&(this.initStatus=SERVER_REQUEST_STATE.NOT_SENT,this.identifyStatus=SERVER_REQUEST_STATE.NOT_SENT,this.init(this.label_api_key)),this._connectionStatus===ConnectionStatus.OPEN&&(this._connectionStatus=ConnectionStatus.CLOSED,InteractionMaster.sendToAll(InteractionMessageBuilder.SetConnectionStatus(this._connectionStatus))),[2]})})},this.ws.onerror=function(e){i.log("WebSocket error: ",e)},this.ws.onopen=function(){i.log("Connection setup. Has messages in the queue: ",i.queue.length),i._connectionStatus===ConnectionStatus.CLOSED&&(i._connectionStatus=ConnectionStatus.OPEN,InteractionMaster.sendToAll(InteractionMessageBuilder.SetConnectionStatus(i._connectionStatus)))},this.ws.onmessage=function(e){var n=e.data;try{var t=JSON.parse(n);if(t.cid===ClassId.PING&&i.sendRow(ClassId.PONG,!1),t.cid!==ClassId.PONG&&i.scheduledProactiveClientPing(),t.cid!==ClassId.PING&&t.cid!==ClassId.PONG&&i.log("IN",t),i.params.simulation_mode&&CLASS_ID_IGNORE_FOR_SIMULATION.includes(t.cid))return void i.log("Simulation mode, skipping incomming "+t.cid);if(i.params.gamification_wrapper_mode&&CLASS_ID_IGNORE_FOR_GAMIFICATION_WRAPPER.includes(t.cid))return void i.log("Gamification wrapper mode, skipping incomming "+t.cid);try{i.handlers.filter(function(e){return e.cid===t.cid}).map(function(e){return e.handler(t)})}catch(e){throw i.error("Failed to process incoming socket message, message",e),e}i.triggerExternalCallBack(t.cid,t)}catch(t){var r=JSON.parse(n);i.sendServerError("Failed to process server message "+r.cid+" / "+r.uuid+" / stack: "+t.stack+" / error: "+t.message+" / domain: "+window.location.hostname),i.error("IN-ERR",t),sentryHub.withScope(function(e){e.setTag("cid",r.cid),e.setExtra("message",n),sentryHub.captureException(t)})}}}return Tracker.prototype.fakeIncomingMessage=function(t,n){this.handlers.filter(function(e){return e.cid===t}).map(function(e){return e.handler(n)})},Object.defineProperty(Tracker.prototype,"connectionStatus",{get:function(){return this._connectionStatus},enumerable:!1,configurable:!0}),Tracker.prototype.clear=function(e){e=__assign(__assign({},SmarticoClearParamsDefaults),e);this.ws&&this.ws&&this.ws.close(),!(Tracker.fcmMessaging=null)!==e.keepCallBacks&&(Tracker.externalCallbacks=[]),this.executeManualDP("dp:"+DpType$1.GfClose),Gamification.clear(),Integration.clear(),Cache.clear(),Detector.clear(),this.noMessageTimer&&clearTimeout(this.noMessageTimer),this.queueInterval&&clearInterval(this.queueInterval)},Tracker.prototype.getDeviceId=function(){function t(){null===(e=js_cookie.get(__lsDeviceIdKey))&&(e=guid(),js_cookie.set(__lsDeviceIdKey,e,{expires:9999}))}var e="";try{LStorage().supported()?null===(e=LStorage().getItem(__lsDeviceIdKey))&&(e=guid(),LStorage().setItem(__lsDeviceIdKey,e)):t()}catch(e){t()}return e},Tracker.getLogicSessionUUID=function(){var e="__smartico_ls_id",t="__smartico_ls_create_t",n="__smartico_ls_use_t",r=js_cookie.get(e)?js_cookie.get(e):null,i=js_cookie.get(t)?new Date(parseInt(js_cookie.get(t),10)):null,o=js_cookie.get(n)?new Date(parseInt(js_cookie.get(t),10)):null;return null!==i&&(i=(new Date).getTime()-i.getTime(),o=(new Date).getTime()-o.getTime(),864e5<i||36e5<o?(js_cookie.remove(e),js_cookie.remove(t),r=null):js_cookie.set(n,(new Date).getTime().toString())),null===r&&(r=guid(),js_cookie.set(e,r,{expires:9999}),js_cookie.set(t,(new Date).getTime().toString()),js_cookie.set(n,(new Date).getTime().toString())),r},Tracker.prototype.scheduledProactiveClientPing=function(){this.noMessageTimer&&clearTimeout(this.noMessageTimer),this.noMessageTimer=setTimeout(this.sendClientProactivePing.bind(this),NO_MESSAGE_TIMER)},Tracker.prototype.sendClientProactivePing=function(){this.sendRow(ClassId.PING,!1),this.scheduledProactiveClientPing()},Tracker.prototype.init=function(t){var e,n=this.params,r=n.brand_key,i=n.simulation_mode;sentryHub.configureScope(function(e){e.setExtra("label_api_key",t),e.setExtra("brand_key",r),e.setExtra("tracker_version","1.2.17")}),this.initStatus===SERVER_REQUEST_STATE.NOT_SENT?(e={page:window.location.href,tracker_version:"1.2.17",session_id:Tracker.getLogicSessionUUID()},null==t&&this.sendServerError("Init called with empty label_api_key"),n=null!=r&&""!==r.trim()?r:null,this.sendRow(ClassId.INIT,!1,__assign({label_name:t,brand_key:n,simulation_mode:i,device_id:this.deviceId},e)),this.initStatus=SERVER_REQUEST_STATE.SENT):(this.sendServerError("Call to _smartico.init for already initialised session. Skipped"),this.warn("Call to _smartico.init for already initialised session. Skipped"))},Tracker.prototype.initResponse=function(e){if(e.errCode===ERRS.OK){if(this.hadSuccessInit=!0,this.labelSettings=e.settings,this.labelSettings[PublicLabelSettings.SHADOW_LABEL_PUBLIC_KEY]&&this.initShadowLabel({label_api_key:this.labelSettings[PublicLabelSettings.SHADOW_LABEL_PUBLIC_KEY]}),void 0!==this.labelSettings[PublicLabelSettings.DELAY_ENGAGEMENT_EXECUTION_ON_LOGIN_MS]&&(this.DELAY_ENGAGEMENT_EXECUTION_ON_LOGIN_MS=parseInt(this.labelSettings[PublicLabelSettings.DELAY_ENGAGEMENT_EXECUTION_ON_LOGIN_MS],10)),void 0!==this.labelSettings[PublicLabelSettings.JS_INJECTION]){this.log("About to init label specific JS_INJECTION");var t=window;if(void 0===t.__smarticoJSInjected){t.__smarticoJSInjected=!0;try{t.eval(this.labelSettings[PublicLabelSettings.JS_INJECTION])}catch(e){this.sendServerError("Failed to inject JS_INJECTION: "+JSON.stringify(e)),this.warn("Failed to inject JS_INJECTION",e),sentryHub.captureException(e)}}}if(null===Tracker.fcmMessaging)try{var n=this.labelSettings[PublicLabelSettings.FCM_SW_URL];null!=n&&""!==n.trim()||(n=FCM_DEFAULT_SW_URL+this.label_api_key),Tracker.fcmMessaging=new FCMMessaging(this.log.bind(this),this.labelSettings[PublicLabelSettings.FCM_SENDER_ID],this.labelSettings[PublicLabelSettings.PUBLIC_API_URL],n,this.params.brand_key)}catch(e){this.warn("Failed to init push messaging service",e),Tracker.fcmMessaging=null}if(null!=this.ext_user_id&&this.identifyDelayed(this.ext_user_id,this.hash,this.identifyPayload),Util.isArrayNotEmpty(e.products)&&-1<e.products.indexOf(ProductType.GAMIFICATION)){var r=LStorage().getItem("override_widget_widgetUrl"),i=LStorage().getItem("override_widget_mainUrl"),o=LStorage().getItem("override_widget_miniGameUrl"),s={},a=r,c=i,u=null;if(Util.isNotNull(this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_SETTINGS]))try{s=JSON.parse(this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_SETTINGS])}catch(e){this.error("Failed parse UI settings"),sentryHub.captureException(e)}if(s.avatar_domain=this.labelSettings[PublicLabelSettings.DYNAMIC_IMAGE_DOMAIN]+"avatar/",s.levelsMapEnabled=this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_LEVEL_ENABLED],s.levelsBackgroundDeskUrl=this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_LEVEL_IMAGE_DESK],s.levelsBackgroundMobUrl=this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_LEVEL_IMAGE_MOB],s.AVATAR_CUSTOM_IMAGE_MAX_ID=this.labelSettings[PublicLabelSettings.AVATAR_CUSTOM_IMAGE_MAX_ID],s.AVATAR_CUSTOM_IMAGE_FOLDER=this.labelSettings[PublicLabelSettings.AVATAR_CUSTOM_IMAGE_FOLDER],s.theme_style_desktop=e.theme_style_desktop,Util.isNotNull(this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_SETTINGS_TEST]))try{(u=JSON.parse(this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_SETTINGS_TEST])).avatar_domain=this.labelSettings[PublicLabelSettings.DYNAMIC_IMAGE_DOMAIN]+"avatar/",u.levelsMapEnabled=this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_LEVEL_ENABLED],u.levelsBackgroundDeskUrl=this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_LEVEL_IMAGE_DESK],u.levelsBackgroundMobUrl=this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_LEVEL_IMAGE_MOB],u.theme_style_desktop=e.theme_style_desktop}catch(e){this.error("Failed parse UI settings for test users"),sentryHub.captureException(e)}"local"==="prod".toString()?this.gamification=Gamification.start({widgetUrl:r||"http://localhost:12345/ShortInfoWidget2.html",mainUrl:i||"http://localhost:12345/Achievements3.html",miniGameUrl:o||"http://localhost:12345/Saw.html",settings:s,tracker:this,widgetUrlTest:a,mainUrlTest:c,settingsTest:u}):(r=r||this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_WIDGET],i=i||this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_MAIN],o=o||this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_MINI_GAME],a=a||this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_WIDGET_TEST],c=c||this.labelSettings[PublicLabelSettings.GAMIFICATION_UI_MAIN_TEST],this.gamification=Gamification.start({widgetUrl:r,mainUrl:i,miniGameUrl:o,settings:s,tracker:this,widgetUrlTest:a,mainUrlTest:c,settingsTest:u}))}this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.INIT,e.errCode)}else this.sendServerError("Failed to init label, error code from server "+e.errCode+"/"+e.errMsg),e.errCode===ERRS.INIT_FAILED_LABEL_IS_BLOCKED?this.initStatus=SERVER_REQUEST_STATE.LABEL_IS_BLOCKED:this.initStatus=SERVER_REQUEST_STATE.NOT_SENT,this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.INIT,e.errCode);this.scheduledProactiveClientPing()},Tracker.prototype.identify=function(t,n,r){return void 0===r&&(r={}),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return null!==this.ext_user_id?[3,3]:(this.ext_user_id=t,this.hash=n,this.identifyPayload=r,this.hadSuccessInit?[4,this.identifyDelayed(t,n,r)]:[3,2]);case 1:e.sent(),e.label=2;case 2:return[3,4];case 3:this.warn("double identify for "+t+" skipped"),e.label=4;case 4:return[2]}})})},Tracker.prototype.identifyDelayed=function(r,i,o){return void 0===o&&(o={}),__awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return(sentryHub.configureScope(function(e){e.setUser(__assign(__assign({},e.getUser()),{username:r}))}),this.identifyStatus!==SERVER_REQUEST_STATE.NOT_SENT)?[3,6]:(t=void 0,o.platform!==PushClientPlatform.NATIVE_ANDROID?[3,1]:(delete(t=o).platform,delete o.token,delete o.pushNotificationUserStatus,[3,5]));case 1:return null!==Tracker.fcmMessaging?[3,2]:(n={token:null,pushNotificationUserStatus:PushNotificationUserStatus.BROWSER_NOT_SUPPORTED,platform:Detector.getClientPlatform()},[3,4]);case 2:return[4,Tracker.fcmMessaging.getPushState()];case 3:n=e.sent(),e.label=4;case 4:t=n,e.label=5;case 5:return this.sendRow(ClassId.IDENTIFY,!1,__assign(__assign({ext_user_id:r,hash:i,ua:this.browserInfo,page:window.location.href},t),{payload:o})),this.identifyStatus=SERVER_REQUEST_STATE.SENT,[3,7];case 6:this.warn("Call to _smartico.identify for already identified session. Skipped"),e.label=7;case 7:return[2]}})})},Tracker.prototype.identifyResponse=function(t){var e,n;t.errCode===ERRS.OK?(sentryHub.configureScope(function(e){e.setUser(__assign(__assign({},e.getUser()),{id:t.user_id}))}),this.identifyResponseTS=(new Date).getTime(),this.hadSuccessIdentify=!0,(null===(e=LStorage().getItem(this.__lsLoginTracker))||(n=JSON.parse(e)).dt<(new Date).getTime()-LOGIN_SESSION_MS||n.ext_user_id!==this.ext_user_id)&&this.login(),LStorage().setItem(this.__lsLoginTracker,JSON.stringify({dt:(new Date).getTime(),ext_user_id:this.ext_user_id})),this.userPublicProps=t.props||{},this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.IDENTIFY,t.errCode,t.props,t),this.executeLocationBasedDP()):(this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.IDENTIFY,t.errCode,{}),this.forgetUser())},Tracker.prototype.forgetUser=function(){this.ext_user_id=null,this.hash=null,this.identifyPayload={},this.identifyStatus=SERVER_REQUEST_STATE.NOT_SENT,this.loginIsSent=!1,this.userPublicProps={},this.bSuspendPopups=!1},Tracker.prototype.changeLanguage=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return null!=n&&n.trim&&(void 0===(t=(this.userPublicProps||{}).core_user_language)||t&&t.toLowerCase&&t.toLowerCase()!==n.toLowerCase())&&this.sendRow(ClassId.EVENT,!0,{eventType:ClientEventTypes.core_language_changed,payload:{language:n}}),[2]})})},Tracker.prototype.handlePublicPropsChange=function(e){Object.assign(this.userPublicProps,e.props),this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.USER_PROPS_CHANGE,e.props)},Tracker.prototype.handleAvatarChange=function(e){Object.assign(this.userPublicProps,{avatar_id:e.avatar_id}),this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.USER_PROPS_CHANGE,{avatar_id:e.avatar_id})},Tracker.prototype.getPublicProps=function(){return this.userPublicProps},Tracker.prototype.handleLogout=function(e){e.errCode===ERRS.OK&&(this.log("Handling logout, going to forget user and start reconnect"),this.forgetUser(),this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.LOGOUT),this.ws.reconnect())},Tracker.prototype.handleLogin=function(e){LStorage().getItem(this.__lsDelayedLoginPayload)&&LStorage().removeItem(this.__lsDelayedLoginPayload),e.errCode===ERRS.OK&&this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.LOGIN)},Tracker.prototype.serverTriggeredDPHandler=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.delayEngagementAfterLogin()];case 1:return e.sent(),this.reportEngagmentImpression({engagement_uid:t.engagement_uid,activityType:CJMActivityType.DeepLink}),[2,DeepLinks.actionHandler(this,t.payload.dp,t.engagement_uid,CJMActivityType.DeepLink,!0)]}})})},Tracker.prototype.executeJSCode=function(inMessage){return __awaiter(this,void 0,void 0,function(){var outMessage;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.delayEngagementAfterLogin()];case 1:_a.sent(),outMessage={engagement_uid:inMessage.engagement_uid,activityType:CJMActivityType.JSCode},this.reportEngagmentImpression(outMessage);try{eval(inMessage.script),this.reportEngagmentAction(outMessage)}catch(e){this.sendServerError("Failed to execute server side triggered script: "+JSON.stringify(inMessage)+" / "+JSON.stringify(e)),this.error("Failed to execute server side triggered script",inMessage,e),this.reportEngagmentFail(outMessage)}return[2]}})})},Tracker.prototype.handleSawPushEvent=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.miniGame(t.saw_template_id),[2]})})},Tracker.prototype.delayEngagementAfterLogin=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=(new Date).getTime(),n=this.inPageUnloadPhase?this.DELAY_ENGAGEMENT_EXECUTION_DURING_UNLOAD_MS:this.DELAY_ENGAGEMENT_EXECUTION_ON_LOGIN_MS,t-this.identifyResponseTS<n?[4,wait(n-(t-this.identifyResponseTS))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Tracker.prototype.engagementEventHandlerNew=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.bSuspendPopups?[2]:[4,this.delayEngagementAfterLogin()];case 1:return e.sent(),t.activityType===CJMActivityType.Popup&&PromoBuilderNew.showPromoMessage(t,this)&&this.reportEngagmentImpression({engagement_uid:t.engagement_uid,activityType:t.activityType}),[2]}})})},Tracker.prototype.reportEngagmentAction=function(e){null!==e.engagement_uid&&this.sendRow(ClassId.CLIENT_ENGAGEMENT_ACTION_REQUEST,!0,e)},Tracker.prototype.reportEngagmentFail=function(e){null!==e.engagement_uid&&this.sendRow(ClassId.CLIENT_ENGAGEMENT_FAILED_REQUEST,!0,e)},Tracker.prototype.reportEngagmentImpression=function(e){null!==e.engagement_uid&&this.sendRow(ClassId.CLIENT_ENGAGEMENT_IMPRESSION_REQUEST,!0,e)},Tracker.prototype.tagRecording=function(e){},Tracker.prototype.setLoginPayload=function(e){void 0===e&&(e={}),null===this.ext_user_id&&this.error("SMARTICO: cannot call _smartico.login before _smartico.identify"),LStorage().setItem(this.__lsDelayedLoginPayload,JSON.stringify(e)),this.login()},Tracker.prototype.login=function(){null===this.ext_user_id&&this.error("SMARTICO: cannot call _smartico.login before _smartico.identify"),this.loginPostponed()},Tracker.prototype.loginPostponed=function(){var e;this.loginIsSent||(e=LStorage().getItem(this.__lsDelayedLoginPayload),this.hadSuccessIdentify&&(this.sendAnalytics(ClientActivityRequestId.LOGIN,"other"),this.loginIsSent=!0,e?this.sendRow(ClassId.LOGIN,!0,{payload:JSON.parse(e)}):this.sendRow(ClassId.LOGIN,!0)))},Tracker.prototype.logout=function(e){void 0===e&&(e={}),null===this.ext_user_id&&this.error("SMARTICO: cannot call _smartico.logout before _smartico.identify"),LStorage().removeItem(this.__lsLoginTracker),this.executeManualDP("dp:"+DpType$1.GfClose),this.sendAnalytics(ClientActivityRequestId.LOGOUT,"other"),this.forgetUser(),this.sendRow(ClassId.LOGOUT,!0,e)},Tracker.prototype.sendRow=function(t,e,n){if(void 0===n&&(n={}),this.params.simulation_mode&&CLASS_ID_IGNORE_FOR_SIMULATION.includes(t))return this.log("Simulation mode, skipping "+t,n),guid();if(this.params.gamification_wrapper_mode&&CLASS_ID_IGNORE_FOR_GAMIFICATION_WRAPPER.includes(t))return this.log("Gamification wrapper mode, skipping "+t,n),guid();if((t===ClassId.PING||t===ClassId.PONG)&&this.queue&&this.queue.find(function(e){return e.cid===t}))return guid();n=__assign(__assign({cid:t,toIdentified:e},n),{ts:(new Date).getTime(),uuid:guid()});return this.queue.push(n),n.uuid},Tracker.prototype.requestPushPermissions=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return Tracker.fcmMessaging?this.hadSuccessIdentify?[4,Tracker.fcmMessaging.getPermissionAndToken()]:[3,3]:[3,5];case 1:return e.sent(),[4,Tracker.fcmMessaging.getPushState()];case 2:return t=e.sent(),this.sendRow(ClassId.REGISTER_PUSH_NOTIFICATIONS_TOKEN_REQ,!0,t),[3,4];case 3:throw new Error("User not identified, you should call .identify first");case 4:return[3,6];case 5:throw new Error("FCM is not initialized, either call done before .init or label is missing push notification settings");case 6:return[2]}})})},Tracker.prototype.registerNativePushToken=function(n,r){return void 0===r&&(r=PushClientPlatform.OTHER),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t={token:n,platform:r,pushNotificationUserStatus:PushNotificationUserStatus.ALLOWED},this.sendRow(ClassId.REGISTER_PUSH_NOTIFICATIONS_TOKEN_REQ,!0,t),[2]})})},Tracker.prototype.executeLocationBasedDP=function(){return __awaiter(this,void 0,Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return window.sessionStorage&&window.sessionStorage.getItem(DP_SESSION_STORAGE_KEY)?(this.triggerExternalCallBack(EXTERNAL_CALLBACK_KEY.SESSION_BASED_DP_DETECTED),[4,wait(1e3)]):[3,2];case 1:e.sent(),this.inPageUnloadPhase||(this.executeManualDP(window.sessionStorage.getItem(DP_SESSION_STORAGE_KEY)),window.sessionStorage.removeItem(DP_SESSION_STORAGE_KEY)),e.label=2;case 2:return[2]}})})},Tracker.prototype.saveLocationBasedDP=function(){var e,t,n,r=parseUrlHash(),i=parseUrl();r[DP_URL_IN_HASH]?(t=(e=window.location.hash.substr(1)).indexOf(DP_URL_IN_HASH)+DP_URL_IN_HASH.length+1,n=decodeURIComponent(e.substr(t)),window.sessionStorage&&window.sessionStorage.setItem(DP_SESSION_STORAGE_KEY,n)):i[DP_URL_IN_HASH]&&(t=(e=window.location.search.substr(1)).indexOf(DP_URL_IN_HASH)+DP_URL_IN_HASH.length+1,n=decodeURIComponent(e.substr(t)),window.sessionStorage&&window.sessionStorage.setItem(DP_SESSION_STORAGE_KEY,n))},Tracker.prototype.sendServerError=function(e){e={msg:e,error:!0};this.sendRow(ClassId.CLIENT_DEBUG_REQUEST,!1,e)},Tracker.prototype.sendServerDebug=function(e){e={msg:e,error:!1};this.sendRow(ClassId.CLIENT_DEBUG_REQUEST,!1,e)},Tracker.prototype.executeManualDP=function(e,t,n){var r=this;if(void 0===t&&(t=null),void 0===n&&(n=null),this.hadSuccessIdentify)return DeepLinks.actionHandler(this,e,t,n);var i=setInterval(function(){r.hadSuccessIdentify&&(clearInterval(i),DeepLinks.actionHandler(r,e,t,n))},10)},Tracker.prototype.registerHandler=function(e,t){this.handlers.push({cid:e,handler:t})},Tracker.prototype.getLabelSetting=function(e){return this.labelSettings[e]},Tracker.prototype.triggerExternalCallBack=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];Tracker.externalCallbacks.filter(function(e){return e.callBackKey===t}).map(function(e){return setTimeout(function(){return e.handler.apply(e,n)},0)})},Tracker.prototype.setAvatar=function(e){this.sendRow(ClassId.CLIENT_SET_AVATAR_REQUEST,!0,{avatar_id:e})},Tracker.on=function(t,e,n){null===e?Tracker.externalCallbacks=Tracker.externalCallbacks.filter(function(e){return e.callBackKey!==t}):Tracker.externalCallbacks.push({callBackKey:t,handler:e,params:n})},Tracker.prototype.suspendPopups=function(e){this.bSuspendPopups=e},Tracker.prototype.logPrefix=function(){return this.trackerInstanceType===TrackerInstanceType.Master?"SM:":"SM-SHADOW"},Tracker.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.params.debug&&console.log.apply(console,__spreadArrays([this.logPrefix()],e))},Tracker.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,__spreadArrays([this.logPrefix()],e))},Tracker.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,__spreadArrays([this.logPrefix()],e))},Tracker.prototype.processQueue=function(){for(var e=0<this.queue.length;this.ws.readyState===ReconnectingWebSocket.OPEN&&e;){for(var t=null,n=-1,r=0;r<this.queue.length;r++)if(!(t=this.queue[r]).toIdentified||this.hadSuccessIdentify){n=r;break}e=null!==t&&-1!==n&&(delete t.toIdentified,t.cid!==ClassId.PONG&&t.cid!==ClassId.PING&&this.log("OUT",t),this.ws.send(JSON.stringify(t)),this.queue.splice(n,1),!0)}},Tracker.externalCallbacks=[],Tracker.fcmMessaging=null,Tracker}();Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,i=arguments[1],o=0;o<r;o++)if(o in n&&(t=n[o],e.call(i,t,o,n)))return t}});var GamificationEngine=(QS.instance=function(e){return this._instance||(this._instance=new this(e))},QS);function QS(e){var i=this;this._socketPromises=new typescriptMap_1,this._socketListeners=new typescriptMap_1,this.doGetLevels=function(){return i.socketRequest({cid:ClassId.GET_LEVEL_MAP_REQUEST},ClassId.GET_LEVEL_MAP_RESPONSE)},this.doGetTournaments=function(){return i.socketRequest({cid:ClassId.GET_TOURNAMENT_LOBBY_REQUEST},ClassId.GET_TOURNAMENT_LOBBY_RESPONSE)},this.doGetTournamentLobby=function(e){return i.socketRequest({cid:ClassId.GET_TOURNAMENT_INFO_REQUEST,tournamentInstanceId:e},ClassId.GET_TOURNAMENT_INFO_RESPONSE)},this.doTournamentRegister=function(e){return i.socketRequest({cid:ClassId.TOURNAMENT_REGISTER_REQUEST,tournamentInstanceId:e},ClassId.TOURNAMENT_REGISTER_RESPONSE)},this.socketRequest=function(n,r){return Util.checkNotNull(n.cid),Util.isNotNull(r)?new Promise(function(e){var t=i._socketPromises.get(r);Util.isArrayEmpty(t)&&i._socketPromises.set(r,t=[]),t.push(e),i._tracker.sendRow(n.cid,!0,n)}):new Promise(function(e){i._tracker.sendRow(n.cid,!0,n),e(null)})},this.socketResponse=function(e,t){var n,r=i._socketPromises.get(e.cid);Util.isArrayNotEmpty(r)&&(n=t(),r.forEach(function(e){return e(n)}),i._socketPromises.set(e.cid,[]))},this.listen=function(e,t){var n=i._socketListeners.get(t);Util.isArrayEmpty(n)&&i._socketListeners.set(t,n=[]),n.push(e)},this.notify=function(e,t){var n,e=i._socketListeners.get(e.cid);Util.isArrayNotEmpty(e)&&(n=t(),e.forEach(function(e){return e(n)}))},Util.checkNotNull(e),this._tracker=e,this._tracker.registerHandler(ClassId.GET_LEVEL_MAP_RESPONSE,function(e){i.socketResponse(e,function(){return e})}),this._tracker.registerHandler(ClassId.GET_TOURNAMENT_LOBBY_RESPONSE,function(e){i.socketResponse(e,function(){return e})}),this._tracker.registerHandler(ClassId.GET_TOURNAMENT_INFO_RESPONSE,function(e){i.socketResponse(e,function(){return e})}),this._tracker.registerHandler(ClassId.TOURNAMENT_REGISTER_RESPONSE,function(e){i.socketResponse(e,function(){return e})})}var IGNORE_ACTIONS=["openModalForm","setForm","cashierSubmitClicked","gameClicked","openChat","openModalIFrame","openModalPopupForm"],BTG=(qT.checkInit=function(){if(!qT.tracker)throw new Error("SMARTICO: should call _smartico.init first")},qT.initShadowLabel=function(e){var t=e.label_api_key,e=__rest(e,["label_api_key"]);qT.trackerShadow||(qT.trackerShadow=new Tracker(t,__assign(__assign({},qT.initParams),e),TrackerInstanceType.Shadow),this.shadowInterval=setInterval(function(){var e;0<qT.shadowQueue.length&&(e=qT.shadowQueue[0],qT.shadowQueue.splice(0,1),e(qT.trackerShadow))},10))},qT.init=function(e,t){qT.tracker?qT.tracker.log("Init was alrady called"):(qT.initParams=__assign(__assign({},TrackerParams),t),qT.tracker=new Tracker(e,qT.initParams,TrackerInstanceType.Master,this.initShadowLabel),qT.gf=GamificationEngine.instance(qT.tracker))},qT.clear=function(e){qT.initParams=void 0,qT.tracker&&(qT.tracker.clear(e),qT.tracker=void 0),qT.trackerShadow&&(qT.trackerShadow.clear(e),qT.trackerShadow=void 0,qT.shadowInterval&&clearInterval(qT.shadowInterval))},qT.sendServerError=function(e){qT.checkInit(),qT.tracker.sendServerError(e)},qT.sendServerDebug=function(e){qT.checkInit(),qT.tracker.sendServerDebug(e)},qT.requestPushPermissions=function(){qT.checkInit(),qT.tracker.requestPushPermissions(),qT.trackerShadow&&qT.trackerShadow.requestPushPermissions()},qT.registerNativePushToken=function(e,t){void 0===t&&(t=PushClientPlatform.OTHER),qT.checkInit(),qT.tracker.registerNativePushToken(e,t)},qT.identify=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(qT.checkInit(),null==t||t.trim&&""===t.trim())throw new Error("SMARTICO: call to online with empty ext_user_id");return qT.shadowQueue.push(function(e){return e.identify(t,n,r)}),[4,qT.tracker.identify(t,n,r)];case 1:return e.sent(),[2]}})})},qT.online=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(qT.checkInit(),null==t||t.trim&&""===t.trim())throw new Error("SMARTICO: call to online with empty ext_user_id");return qT.shadowQueue.push(function(e){return e.identify(t,null)}),[4,qT.tracker.identify(t,null)];case 1:return e.sent(),n&&qT.changeLanguage(n),[2]}})})},qT.login=function(e,t){void 0===e&&(e=null),void 0===t&&(t={}),qT.checkInit(),qT.shadowQueue.push(function(e){return e.setLoginPayload(t)}),qT.tracker.setLoginPayload(t),e&&qT.changeLanguage(e)},qT.logout=function(t){void 0===t&&(t={}),qT.checkInit(),qT.shadowQueue.push(function(e){return e.logout(t)}),qT.tracker.logout(t)},qT.tagRecording=function(e){qT.tracker.tagRecording(e)},qT.changeLanguage=function(e){if(qT.checkInit(),null==e)throw new Error("SMARTICO: missing language in the call to changeLanguage");var t=[(e=1<e.split("-").length?e.split("-")[0]:e).toLowerCase()],n=qT.tracker.getLabelSetting(PublicLabelSettings.FRONT_END_ALLOWED_LANGUAGES);0===(t=n&&""!==n.trim()?n.toLowerCase().trim().split(","):t).length||t.includes(e.toLowerCase())?(qT.tracker.changeLanguage(e),qT.trackerShadow&&qT.trackerShadow.changeLanguage(e)):qT.tracker.sendServerDebug("\n\t\t\t\tAttempt to change language that is not allowed by label setting FRONT_END_ALLOWED_LANGUAGES.\n\t\t\t\tLanguage: "+e+".\n\t\t\t\tStack trace: "+Util.getStackTrace()+"\n\t\t\t")},qT.event=function(t,n){void 0===n&&(n={}),qT.checkInit(),t===ClientEventTypes.client_action&&n&&n.action&&IGNORE_ACTIONS.includes(n.action)||(qT.shadowQueue.push(function(e){return e.sendRow(ClassId.EVENT,!0,{eventType:t,payload:__assign({},n)})}),qT.tracker.sendRow(ClassId.EVENT,!0,{eventType:t,payload:__assign({},n)}))},qT.sendRow=function(t,n){void 0===n&&(n={}),qT.checkInit(),qT.shadowQueue.push(function(e){return e.sendRow(t,!1,n)}),qT.tracker.sendRow(t,!1,n)},qT.action=function(e){qT.checkInit(),e&&IGNORE_ACTIONS.includes(e)||qT.tracker.sendRow(ClassId.EVENT,!0,{eventType:ClientEventTypes.client_action,payload:{action:e}})},qT.setAvatar=function(e){qT.checkInit(),qT.tracker.setAvatar(e),qT.trackerShadow&&qT.trackerShadow.setAvatar(e)},qT.dp=function(e){qT.checkInit(),qT.tracker.executeManualDP(e)},qT.miniGame=function(e){qT.tracker.miniGame(e)},qT.sendAnalytics=function(e,t){void 0===t&&(t=0),qT.checkInit(),qT.tracker.sendAnalytics(e,"other",t)},qT.on=function(e,t,n){Tracker.on(e,t,n)},qT.suspendPopups=function(e){qT.checkInit(),qT.tracker.suspendPopups(e)},qT.parseUrl=function(){return parseUrl()},qT.parseUrlHash=function(){return parseUrlHash()},qT.isMobile=function(){return WebUtil.isMobile()},qT.shadowQueue=[],qT);function qT(){}return BTG});
